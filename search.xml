<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Activity-（九）查看流程图片</title>
    <url>/2020/03/14/Activity-%EF%BC%88%E4%B9%9D%EF%BC%89%E6%9F%A5%E7%9C%8B%E6%B5%81%E7%A8%8B%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<p>在开发中可能需要查看某个流程的流程图片。</p>
<p>对应操作的数据库表是act_ge_bytearray的Bytes_字段：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu131.png" width="60%">

<p>Activiti提供了操作接口，可以查询返回一个资源文件输入流，</p>
<p>然后就可以得到这张流程图片保存到本地服务器，然后图片多在自己的服务器上，</p>
<p>你想干什么多行。</p>
<p>先在pom.xml中添加IO的Jar架包：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后就是代码实现： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过流程部署ID获取流程图图片</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getImageById</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="comment">//        ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery()</span></span><br><span class="line"><span class="comment">//        		.processDefinitionId("myProcess.png")</span></span><br><span class="line"><span class="comment">//        		.singleResult();</span></span><br><span class="line">        InputStream inputStream=processEngine.getRepositoryService()</span><br><span class="line">            .getResourceAsStream(<span class="string">"40001"</span>, <span class="string">"myProcess.png"</span>); <span class="comment">// 根据流程部署ID和资源名称获取输入流</span></span><br><span class="line">        FileUtils.copyInputStreamToFile(inputStream, <span class="keyword">new</span> File(<span class="string">"F:/myProcess.png"</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实际开发的时候，一般会把图片存到项目路径下，然后名字的话，可以根据当前日期年月日时分秒来命名，</p>
<p>然后得到路径后，在新的页面，或者是模态窗口里显示图片；</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>Activity-（八）流程定义删除</title>
    <url>/2020/03/14/Activity-%EF%BC%88%E5%85%AB%EF%BC%89%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E5%88%A0%E9%99%A4/</url>
    <content><![CDATA[<p>在开发中肯定会有一些流程不需要了，要删除，Activiti中也是存在删除操作的，</p>
<p>通过流程定义部署ID来执行删除流程定义。</p>
<p>不说那么多直接上代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    processEngine.getRepositoryService()</span><br><span class="line">        .deleteDeployment(<span class="string">"12501"</span>); <span class="comment">// 流程部署ID</span></span><br><span class="line">    System.out.println(<span class="string">"刪除流程定义！"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是有一种情况下比如： 这个流程定义的流程实例在运行中，尚未结束。</p>
<p>这时候如果你执行删除肯定会报错的。（这个就不用我多讲了吧，表与表之间的主外键关系）</p>
<p>当然在某种情况下必须要删除就要使用级联删除：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    processEngine.getRepositoryService()</span><br><span class="line">        .deleteDeployment(<span class="string">"12501"</span>); <span class="comment">// 流程部署ID</span></span><br><span class="line">    System.out.println(<span class="string">"刪除流程定义！"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式在属于在任何情况下多能直接删除流程定义，在实际开发中一般都是使用这种方式。 </p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>Activity-（七）流程定义查询</title>
    <url>/2020/03/14/Activity-%EF%BC%88%E4%B8%83%EF%BC%89%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<p>流程定义查询本质上就是通过<code>Activiti</code>框架提供的API对<code>act_re_procdef</code>表进行查询操作。 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu130.png" width="90%">

<p>通过Activiti提供的API 把act_re_procdef表的所有列的数据全部查询出来，</p>
<p>在开发系统的时候管理员、用户可以通过用户界面来维护这些数据。</p>
<p>Activiti提供非常丰富的API，可以做SQL查询、对某些字段查询、模糊查询、分页查询和排序等。</p>
<h3 id="流程定义参数列表："><a href="#流程定义参数列表：" class="headerlink" title="流程定义参数列表："></a>流程定义参数列表：</h3><table>
<thead>
<tr>
<th>id</th>
<th>仅返回具有给定id的模型。</th>
</tr>
</thead>
<tbody><tr>
<td>category</td>
<td>只返回给定类别的模型。</td>
</tr>
<tr>
<td>categoryLike</td>
<td>仅返回类别类似于给定值的模型。使用<code>%</code>字符作为通配符。</td>
</tr>
<tr>
<td>categoryNotEquals</td>
<td>仅返回没有给定类别的模型。</td>
</tr>
<tr>
<td>name</td>
<td>仅返回具有给定名称的模型。</td>
</tr>
<tr>
<td>nameLike</td>
<td>仅返回名称类似于给定值的模型。使用<code>%</code>字符作为通配符。</td>
</tr>
<tr>
<td>key</td>
<td>仅返回具有给定密钥的模型</td>
</tr>
<tr>
<td>deploymentId</td>
<td>仅返回在给定部署中部署的模型。</td>
</tr>
<tr>
<td>version</td>
<td>只返回给定版本的模型。</td>
</tr>
<tr>
<td>latestVersion</td>
<td>如果为<code>true</code>，则仅返回最新版本的模型。最好与结合使用<code>key</code>。如果<code>false</code>以值形式传递，则将其忽略并返回所有版本。</td>
</tr>
<tr>
<td>deployed</td>
<td>如果为<code>true</code>，则仅返回已部署的模型。如果为<code>false</code>，则仅返回未部署的模型（deploymentId为null）。</td>
</tr>
<tr>
<td>tenantId</td>
<td>仅返回具有给定tenantId的模型。</td>
</tr>
<tr>
<td>tenantIdLike</td>
<td>仅返回具有给定值的tenantId的模型。</td>
</tr>
<tr>
<td>withoutTenantId</td>
<td>如果为<code>true</code>，则仅返回未设置tenantId的模型。如果为<code>false</code>，<code>withoutTenantId</code>则忽略该参数。</td>
</tr>
<tr>
<td>sort</td>
<td>要排序的属性，与<em>order</em>一起使用。</td>
</tr>
</tbody></table>
<h3 id="查询流程定义-返回流程定义集合"><a href="#查询流程定义-返回流程定义集合" class="headerlink" title="查询流程定义 返回流程定义集合"></a>查询流程定义 返回流程定义集合</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询流程定义 返回流程定义集合 ---对应act_re_procdef</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;ProcessDefinition&gt; pdList=processEngine.getRepositoryService() <span class="comment">// 获取service类</span></span><br><span class="line">        .createProcessDefinitionQuery() <span class="comment">// 创建流程定义查询</span></span><br><span class="line">        .processDefinitionKey(<span class="string">"myProcess"</span>) <span class="comment">// 通过key查询</span></span><br><span class="line">        .list(); <span class="comment">// 返回一个集合</span></span><br><span class="line">    <span class="keyword">for</span>(ProcessDefinition pd:pdList)&#123;</span><br><span class="line">    	System.out.println(<span class="string">"流程定义ID:"</span>+pd.getId());<span class="comment">//流程定义的key+版本+随机生成数</span></span><br><span class="line">        System.out.println(<span class="string">"流程定义名称:"</span>+pd.getName());<span class="comment">//对应HelloWorld.bpmn文件中的name属性值</span></span><br><span class="line">        System.out.println(<span class="string">"流程定义的key:"</span>+pd.getKey());<span class="comment">//对应HelloWorld.bpmn文件中的id属性值</span></span><br><span class="line">        System.out.println(<span class="string">"流程定义的版本:"</span>+pd.getVersion());<span class="comment">//当流程定义的key值相同的情况下，版本升级，默认从1开始</span></span><br><span class="line">        System.out.println(<span class="string">"资源名称bpmn文件:"</span>+pd.getResourceName());</span><br><span class="line">        System.out.println(<span class="string">"资源名称png文件:"</span>+pd.getDiagramResourceName());</span><br><span class="line">        System.out.println(<span class="string">"部署对象ID:"</span>+pd.getDeploymentId());</span><br><span class="line">        System.out.println(<span class="string">"################################"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行输入如下：</strong>  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">流程定义ID:myProcess:<span class="number">10</span>:<span class="number">50004</span></span><br><span class="line">流程定义名称:My process</span><br><span class="line">流程定义的key:myProcess</span><br><span class="line">流程定义的版本:<span class="number">10</span></span><br><span class="line">资源名称bpmn文件:diagrams/MyProcess.bpmn</span><br><span class="line">资源名称png文件:diagrams/MyProcess.myProcess.png</span><br><span class="line">部署对象ID:<span class="number">50001</span></span><br><span class="line">################################</span><br><span class="line">流程定义ID:myProcess:<span class="number">1</span>:<span class="number">22504</span></span><br><span class="line">流程定义名称:My process</span><br><span class="line">流程定义的key:myProcess</span><br><span class="line">流程定义的版本:<span class="number">1</span></span><br><span class="line">资源名称bpmn文件:diagrams/MyProcess.bpmn</span><br><span class="line">资源名称png文件:diagrams/MyProcess.myProcess.png</span><br><span class="line">部署对象ID:<span class="number">22501</span></span><br><span class="line">################################</span><br><span class="line">……省略其他的</span><br></pre></td></tr></table></figure>



<p>也可以根据某个流程定义ID来查询流程定义信息，返回单个结果（说通俗点就是根据ID查询）： </p>
<h3 id="通过ID查询当个流程定义"><a href="#通过ID查询当个流程定义" class="headerlink" title="通过ID查询当个流程定义"></a>通过ID查询当个流程定义</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过ID查询当个流程定义</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getById</span><span class="params">()</span></span>&#123;</span><br><span class="line">   ProcessDefinition pd=processEngine.getRepositoryService() <span class="comment">// 获取service类</span></span><br><span class="line">            .createProcessDefinitionQuery() <span class="comment">// 创建流程定义查询</span></span><br><span class="line">            .processDefinitionId(<span class="string">"myProcess:10:50004"</span>) <span class="comment">// 通过id查询</span></span><br><span class="line">            .singleResult(); <span class="comment">// 查询返回当个结果</span></span><br><span class="line">	   System.out.println(<span class="string">"流程定义ID:"</span>+pd.getId());<span class="comment">//流程定义的key+版本+随机生成数</span></span><br><span class="line">       System.out.println(<span class="string">"流程定义名称:"</span>+pd.getName());<span class="comment">//对应HelloWorld.bpmn文件中的name属性值</span></span><br><span class="line">       System.out.println(<span class="string">"流程定义的key:"</span>+pd.getKey());<span class="comment">//对应HelloWorld.bpmn文件中的id属性值</span></span><br><span class="line">       System.out.println(<span class="string">"流程定义的版本:"</span>+pd.getVersion());<span class="comment">//当流程定义的key值相同的情况下，版本升级，默认从1开始</span></span><br><span class="line">       System.out.println(<span class="string">"资源名称bpmn文件:"</span>+pd.getResourceName());</span><br><span class="line">       System.out.println(<span class="string">"资源名称png文件:"</span>+pd.getDiagramResourceName());</span><br><span class="line">       System.out.println(<span class="string">"部署对象ID:"</span>+pd.getDeploymentId());</span><br><span class="line">       System.out.println(<span class="string">"################################"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果如下：</strong>  </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">流程定义ID:myProcess:<span class="number">10</span>:<span class="number">50004</span></span><br><span class="line">流程定义名称:My process</span><br><span class="line">流程定义的key:myProcess</span><br><span class="line">流程定义的版本:<span class="number">10</span></span><br><span class="line">资源名称bpmn文件:diagrams/MyProcess.bpmn</span><br><span class="line">资源名称png文件:diagrams/MyProcess.myProcess.png</span><br><span class="line">部署对象ID:<span class="number">50001</span></span><br><span class="line">################################</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu124.png" width="60%">

<p>可以模糊查询，根据某些字段查询，以及分页查询等等。</p>
<p>整体来说这些操作API的使用就跟Hibernate框架的使用差不多，它内部多封装好了你只需要调用即可。</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>EasyUI笔记（三）案例:后台管理页面-框架与需求确立</title>
    <url>/2020/03/14/EasyUI%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89%E6%A1%88%E4%BE%8B-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2-%E6%A1%86%E6%9E%B6%E4%B8%8E%E9%9C%80%E6%B1%82%E7%A1%AE%E7%AB%8B/</url>
    <content><![CDATA[<h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><p><code>模拟实现一个电商项目中子模块后台管理模块的增删改查。</code></p>
<p>粗粒度：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>细功能</th>
</tr>
</thead>
<tbody><tr>
<td>后台管理模块</td>
<td>对商品菜单的增删改查</td>
</tr>
</tbody></table>
<p>细粒度</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>细功能</th>
</tr>
</thead>
<tbody><tr>
<td>查</td>
<td>列表分三级，一级查一级</td>
</tr>
<tr>
<td>增</td>
<td>商品有spu、sku属性，都需要进行相应的添加，做两级添加操作</td>
</tr>
<tr>
<td>改</td>
<td>初步实现对商品的信息进行修改，其次实现对三级分类属性的修改</td>
</tr>
<tr>
<td>删</td>
<td>具体商品信息可以删除，三级分类菜单的次一级菜单为空也可以</td>
</tr>
</tbody></table>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a><strong>技术选型</strong></h3><p>前端：</p>
<p>​    使用Freemarkr，分模块，每个模块add、update、delete、分页都是单独页面。</p>
<p>​    后端：</p>
<p>​        基础框架：SpringBoot、Mybatis 、SpringMVC、Log4j、Lombok、Swagger</p>
<p>​        数据库：MySQL</p>
<p>前后端交互：</p>
<p>​    Json</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu129.png" width="60%">

<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p> ]]></content>
      <categories>
        <category>EasyUI前端框架</category>
      </categories>
  </entry>
  <entry>
    <title>EasyUI笔记（二）--EasyUI下载及引入项目、示例</title>
    <url>/2020/03/14/EasyUI%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89-EasyUI%E4%B8%8B%E8%BD%BD%E5%8F%8A%E5%BC%95%E5%85%A5%E9%A1%B9%E7%9B%AE%E3%80%81%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h3 id="EasyUI下载"><a href="#EasyUI下载" class="headerlink" title="EasyUI下载"></a>EasyUI下载</h3><hr>
<p>　EasyUI官方下载地址：<a href="http://www.jeasyui.com/download/index.php，目前最新的版本是：jQuery" target="_blank" rel="noopener">http://www.jeasyui.com/download/index.php，目前最新的版本是：jQuery</a> EasyUI 1.6.1 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu125.png" width="60%">

<p>下载完成之后，将压缩包进行解压后，得到一个【jquery-easyui-1.6.1】文件夹，里面有如下图所示的文件： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu126.png" width="60%">



<h3 id="EasyUI引入项目及范例："><a href="#EasyUI引入项目及范例：" class="headerlink" title="EasyUI引入项目及范例："></a>EasyUI引入项目及范例：</h3><hr>
<h4 id="引入相关js和css样式文件："><a href="#引入相关js和css样式文件：" class="headerlink" title="引入相关js和css样式文件："></a>引入相关js和css样式文件：</h4><p>要想在页面中使用EasyUI，那么首先要做的就是在页面中引入必要js和css样式文件，以在jsp文件中使用EasyUI为例，文件引入的顺序如下所示 </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入JQuery --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/jquery-easyui-1.4.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入EasyUI --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/jquery-easyui-1.4.1/jquery.easyui.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入EasyUI的中文国际化js，让EasyUI支持中文 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/jquery-easyui-1.4.1/locale/easyui-lang-zh_CN.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入EasyUI的样式文件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/jquery-easyui-1.4.1/themes/default/easyui.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入EasyUI的图标样式文件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/jquery-easyui-1.4.1/themes/icon.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>　在jsp文件中引用了这些文件之后，就可以使用EasyUI了。 </p>
<h4 id="EasyUI使用范例"><a href="#EasyUI使用范例" class="headerlink" title="EasyUI使用范例"></a>EasyUI使用范例</h4><p>将jquery-easyui-1.9.1加入到SpringBoot工程中，将jquery-easyui-1.9.1文件夹中一些不必要的文件删掉，只保留必要的就可以了，如下图所示： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu127.png" width="60%">

<p>　新创建一个01.html页面，在01.jsp页面中使用EasyUI，代码如下： </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery-1.11.3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 引入JQuery --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/easyui/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 引入EasyUI --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/easyui/jquery.easyui.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 引入EasyUI的中文国际化js，让EasyUI支持中文 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/easyui/locale/easyui-lang-zh_CN.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 引入EasyUI的样式文件--&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/easyui/themes/default/easyui.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 引入EasyUI的图标样式文件--&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/easyui/themes/icon.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">      $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">//console.info($('#dd2'));</span></span></span><br><span class="line">          /*使用JavaScript动态创建EasyUI的Dialog的步骤：</span><br><span class="line">          1、定义一个div，并给div指定一个id</span><br><span class="line">          2、使用Jquery选择器选中该div，然后调用dialog()方法就可以创建EasyUI的Dialog</span><br><span class="line">          */</span><br><span class="line"><span class="javascript">          $(<span class="string">'#dd2'</span>).dialog();<span class="comment">//使用默认的参数创建EasyUI的Dialog</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">//使用自定义参数创建EasyUI的Dialog</span></span></span><br><span class="line"><span class="javascript">          $(<span class="string">'#dd3'</span>).dialog(&#123;</span></span><br><span class="line"><span class="actionscript">              title: <span class="string">'使用JavaScript创建的Dialog'</span>,</span></span><br><span class="line">              width: 400,</span><br><span class="line">              height: 200,</span><br><span class="line"><span class="actionscript">              closed: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">              cache: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">              modal: <span class="literal">true</span></span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"easyui-dialog"</span> <span class="attr">id</span>=<span class="string">"dd1"</span> <span class="attr">title</span>=<span class="string">"EasyUI Dialog"</span> <span class="attr">style</span>=<span class="string">"width: 500px;height: 300px;"</span>&gt;</span></span><br><span class="line">        Hello World!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dd2"</span>&gt;</span>Dialog Content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dd3"</span>&gt;</span>Dialog Content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>accordion.html 运行结果如下：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu129.png" width="60%">

<p>这里的两种EasyUI 的Dialog展现UI正是 <a href="">EasyUI笔记（一）EasyUI入门</a>中提到的声明UI组件的两种方法的实现。</p>
<p>以上便是关于EasyUI的简单入门，接下来将使用EasyUI做一个稍微复杂点的后台管理页面。</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p> ]]></content>
      <categories>
        <category>EasyUI前端框架</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot基础（六）实现热部署</title>
    <url>/2020/03/14/SpringBoot%E5%9F%BA%E7%A1%80%EF%BC%88%E5%85%AD%EF%BC%89%E5%AE%9E%E7%8E%B0%E7%83%AD%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h3 id="devtools的原理"><a href="#devtools的原理" class="headerlink" title="devtools的原理"></a>devtools的原理</h3><hr>
<p>​     深层原理是使用了两个ClassLoader，一个Classloader加载那些不会改变的类（第三方Jar包），另一个ClassLoader加载会更改的类，称为restart  ClassLoader,这样在有代码更改的时候，原来的restart ClassLoader 被丢弃，重新创建一个restart  ClassLoader，由于需要加载的类相比较少，所以实现了较快的重启时间。</p>
<h4 id="使用需要添加以下的配置："><a href="#使用需要添加以下的配置：" class="headerlink" title="使用需要添加以下的配置："></a>使用需要添加以下的配置：</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 必须设置以下内容：</p>
<p>​     <strong>eclipse –&gt; Project –&gt; Build Automatically 要选中，不选中的话不起作用。</strong></p>
<p> <strong>说明：</strong></p>
<p>（1） devtools可以实现页面热部署（即页面修改后会立即生效，这个可以直接在application.properties文件中配置spring.thymeleaf.cache=false来实现），<br> 实现类文件热部署（类文件修改后不会立即生效），实现对属性文件的热部署。<br> 即devtools会监听classpath下的文件变动，并且会立即重启应用（发生在保存时机），注意：因为其采用的虚拟机机制，该项重启是很快的<br> （2）配置了后在修改java文件后也就支持了热启动，不过这种方式是属于项目重启（速度比较快的项目重启），会清空session中的值，也就是如果有用户登陆的话，项目重启后需要重新登陆。</p>
<p> 默认情况下，<code>/META-INF/maven，/META-INF/resources，/resources，/static，/templates，</code></p>
<p><code>/public</code>这些文件夹下的文件修改不会使应用重启，但是会重新加载（devtools内嵌了一个LiveReload  server，当资源发生改变时，浏览器刷新）。</p>
<h4 id="devtools的配置"><a href="#devtools的配置" class="headerlink" title="devtools的配置"></a><strong>devtools的配置</strong></h4><p> 在application.properties中配置spring.devtools.restart.enabled=false，此时restart类加载器还会初始化，但不会监视文件更新。<br> 在SprintApplication.run之前调用System.setProperty(“spring.devtools.restart.enabled”, “false”);可以完全关闭重启支持，配置内容：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#热部署生效</span></span><br><span class="line"><span class="meta">spring.devtools.restart.enabled</span>: <span class="string">true</span></span><br><span class="line"><span class="comment">#设置重启的目录</span></span><br><span class="line"><span class="comment">#spring.devtools.restart.additional-paths: src/main/java</span></span><br><span class="line"><span class="comment">#classpath目录下的WEB-INF文件夹内容修改不重启</span></span><br><span class="line"><span class="meta">spring.devtools.restart.exclude</span>: <span class="string">WEB-INF/**</span></span><br></pre></td></tr></table></figure>

<p> 测试</p>
<ul>
<li>修改类–&gt;保存：应用会重启</li>
<li>修改配置文件–&gt;保存：应用会重启</li>
<li>修改页面–&gt;保存：应用不会重启，但会重新加载，页面会刷新（原理是将spring.thymeleaf.cache设为false，参考:Spring Boot配置模板引擎）</li>
</ul>
<p>转载自： <a href="https://blog.csdn.net/liben0429/article/details/79011775" target="_blank" rel="noopener">https://blog.csdn.net/liben0429/article/details/79011775</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot入门</category>
      </categories>
  </entry>
  <entry>
    <title>EasyUI笔记（一）EasyUI入门</title>
    <url>/2020/03/14/EasyUI%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89-EasyUI%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="EasyUI-入门概述"><a href="#EasyUI-入门概述" class="headerlink" title="EasyUI 入门概述"></a>EasyUI 入门概述</h3><p>​    <strong>easyui</strong>为Web开发人员提供了易于使用的组件，它构建在流行的<strong>jquery</strong>核心和<strong>html5</strong>之上。这些使您能够轻松的做出符合<strong>html5</strong>标准的<strong>web</strong>应用程序。</p>
<p>​    </p>
<h3 id="声明UI组件有两种方法："><a href="#声明UI组件有两种方法：" class="headerlink" title="声明UI组件有两种方法："></a>声明UI组件有两种方法：</h3><h4 id="直接在HTML中声明组件"><a href="#直接在HTML中声明组件" class="headerlink" title="直接在HTML中声明组件"></a>直接在HTML中声明组件</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"easyui-dialog"</span> style=<span class="string">"width:400px;height:200px"</span></span><br><span class="line">    data-options=<span class="string">"</span></span><br><span class="line"><span class="string">        title:'My Dialog',</span></span><br><span class="line"><span class="string">        iconCls:'icon-ok',</span></span><br><span class="line"><span class="string">        onOpen:function()&#123;&#125;"</span>&gt;</span><br><span class="line">    dialog content.</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="编写JavaScript代码来创建组件"><a href="#编写JavaScript代码来创建组件" class="headerlink" title="编写JavaScript代码来创建组件"></a>编写JavaScript代码来创建组件</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;input id=<span class="string">"cc"</span> style=<span class="string">"width:200px"</span> /&gt;</span><br><span class="line"></span><br><span class="line">$(<span class="string">'#cc'</span>).combobox(&#123;</span><br><span class="line">	url: ...,</span><br><span class="line">	required: <span class="keyword">true</span>,</span><br><span class="line">	valueField: <span class="string">'id'</span>,</span><br><span class="line">	textField: <span class="string">'text'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用技巧"><a href="#使用技巧" class="headerlink" title="使用技巧"></a>使用技巧</h3><p>遵循： <code>控件 - 属性 - 方法 - 事件</code></p>
<h4 id="控件："><a href="#控件：" class="headerlink" title="控件："></a>控件：</h4><p>​    所有的属性都定义在jQuery.fn.<strong>{plugin}</strong>.defaults里面。例如，对话框属性定义在jQuery.fn.<strong>dialog</strong>.defaults里面。</p>
<h4 id="属性："><a href="#属性：" class="headerlink" title="属性："></a>属性：</h4><p>​    所有的事件（回调函数）也都定义在jQuery.fn.<strong>{plugin}</strong>.defaults里面。</p>
<h4 id="事件："><a href="#事件：" class="headerlink" title="事件："></a>事件：</h4><p>​    所有的事件（回调函数）也都定义在jQuery.fn.<strong>{plugin}</strong>.defaults里面。</p>
<h4 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h4><p>​    调用方法的语法：$(‘selector’).plugin(‘method’, parameter); </p>
<p><strong>解释：</strong>  </p>
<ul>
<li>selector 是jQery对象选择器。</li>
<li>plugin 是插件的名称。</li>
<li>method 是相应插件现有的方法。</li>
<li>parameter  是参数对象，可以是一个对象、字符串等。</li>
</ul>
<p>所有方法都定义在jQuery.fn.<strong>{plugin}</strong>.methods。每个方法都有2个参数：jq和param。第一个参数’jq’是必须的，这是指的jQuery对象。第二个参数’param’是指传入方法的实际参数。例如，为dialog组件扩展一个方法名为’mymove’，代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">$.extend($.fn.dialog.methods, &#123;    </span><br><span class="line">    mymove: function(jq, newposition)&#123;    </span><br><span class="line">        return jq.each(function()&#123;    </span><br><span class="line">            $(this).dialog('move', newposition);    </span><br><span class="line">        &#125;);    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>现在你可以调用’mymove’方法将对话框移动到指定位置：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">$('#dd').dialog('mymove', &#123;    </span><br><span class="line">    left: 200,    </span><br><span class="line">    top: 100    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p> ]]></content>
      <categories>
        <category>EasyUI前端框架</category>
      </categories>
  </entry>
  <entry>
    <title>重写一个对象的时候为什么要同时重写hashcode()和equals（）方法</title>
    <url>/2020/03/13/%E9%87%8D%E5%86%99%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%97%B6%E5%80%99%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%90%8C%E6%97%B6%E9%87%8D%E5%86%99hashcode-%E5%92%8Cequals%EF%BC%88%EF%BC%89%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>​    在新创建的类不重写<strong>hashCode()</strong>和<strong>equals()</strong> 方法时，默认使用 <strong>java</strong> 提供的 <strong>java.lang.Object</strong> 下的 <strong>hashCode</strong>()和<strong>equals</strong>() 方法。 </p>
<blockquote>
<p>注意：Object 的public boolean equals(Object obj)方法主要是对非空对象的引用地址的判断相同才返回true，而非对象本身的字符串内容或数值是否相同。 </p>
</blockquote>
<p>​    简而言之，当且仅当 值A 和 值B 都是引用自同一个对象时，此方法才会返回true;</p>
<p>​    所以，当我们重写一个对象，重写了equals（）方法后，通常必须重写 hashCode（）方法，以维护 hashCode 方法的常规协定，该协定声明了相等对象必须具有相等的哈希码。</p>
<blockquote>
<p>说白了，就是equals 返回true的两个值，在hashCode（） 中结果也必然是true。 </p>
</blockquote>
<p>例子：**</p>
<p>​    (1)当<strong>obj1.equals(obj2)</strong>为<strong>true</strong>时，<strong>obj1.hashCode() == obj2.hashCode()</strong>必须为<strong>true</strong><br>    (2)当<strong>obj1.hashCode() == obj2.hashCode()</strong>为<strong>false</strong>时，<strong>obj1.equals(obj2)</strong>必须为<strong>false</strong></p>
<p>这里引出一个问题，<strong>为什么要重写equals（）方法</strong>呢？难道原生的不能用吗？</p>
<p>​    答案: 是<strong>必须重写</strong>，从前面的注意事项中可以知道，如果不重写<strong>equals</strong> 方法，那么比较的将是对象的引用是否<strong>指向同一块内存地址</strong>，而我们<strong>重写的目的</strong>是为了能够比较<strong>两个对象的value值</strong>是否相等。</p>
<p>​    在高级类的<strong>八个包装类</strong>与<strong>引用类型的String类型</strong>（该类对euqals和hashcode方法进行了重写）中都 是使用重写后的 <strong>equals</strong> 方法来比较对象的，<strong>默认比较的是值</strong>，在比较其它自定义对象时都是<strong>比较的引用地址。</strong></p>
<p>​    后面会对<strong>equals</strong> 和 <strong>hashcode</strong> 的关系进行关联解释。</p>
<p>​    <strong>hashcode</strong>是用于<strong>散列数据的快速存取</strong>，如利用<code>HashSet/HashMap/Hashtable</code>类来存储数据时，都是根据存储对象的<code>hashcode</code>值来进行判断是否相同的。</p>
<p>​    那么，如果我们值重  写<code>equals</code> ，而不重写 <code>hashcode</code> 会怎么样？</p>
<p>​    如果我们对一个对象重写了   <code>equals</code> 方法，意味着只要对象的成员变量值都相等那么 <code>equals</code> 就返回true ,但在不重写 <code>hashcode</code> 方法的情况下，当我们重新 <strong>new</strong> 了一个新对象。<br>此时，当原对象<strong>.equals</strong>（新对象）等于<strong>true</strong>时，两者的 <strong>hashcode</strong> 却是不一样的，由此会产生了理解的不一致，也违反了<strong>equals</strong> 与 <strong>hashcode</strong>的约定规则。</p>
<p><strong>不重写导致的结果案例：</strong></p>
<p>​    在不重写<strong>hashcode</strong>的情况下，如果 <code>hashset</code>存储两个引用不同但值相同的对象，此时hashcode返回false，认为后者与前者不重复，则会重新 newNode() 创建一个新节点将重复的值添加到集合中，意味着不可重复的单列集合中出现了两个值一样的对象，导致混淆。（假设没有重写）</p>
<p>所以，需要重写 hashcode()方法。</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>JavaSE</category>
      </categories>
  </entry>
  <entry>
    <title>集合扩容机制(二)Collection-Map</title>
    <url>/2020/03/13/%E9%9B%86%E5%90%88%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6(%E4%BA%8C)Collection-Map/</url>
    <content><![CDATA[<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><hr>
<p>获取Map集合容量大小的方法： </p>
<p><strong>思路</strong>：利用反射获取<strong>hashmap</strong>里的<strong>threshold</strong>（扩容上限）除以 负载因子 就得到容器大小了。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getHashMapCapacity</span><span class="params">(HashMap&lt;?,?&gt; hashMap)</span> </span>&#123;</span><br><span class="line">		Class&lt;HashMap&gt; hashMapClass = HashMap<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// threshold是hashmap对象里的一个私有变量，若hashmap的size超过该数值，则扩容。这是通过反射获取该值</span></span><br><span class="line">			Field field = hashMapClass.getDeclaredField(<span class="string">"threshold"</span>);</span><br><span class="line">			<span class="comment">//setAccessible设置为true可以开启对似有变量的访问</span></span><br><span class="line">			field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">			<span class="keyword">int</span> threshold = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span> ((<span class="keyword">int</span>) field.get(hashMap) != threshold) &#123;</span><br><span class="line">				threshold = (<span class="keyword">int</span>) field.get(hashMap);</span><br><span class="line">				<span class="comment">// 默认的负载因子是0.75,也就是说实际容量是/0.75</span></span><br><span class="line">				<span class="keyword">double</span> v = (<span class="keyword">int</span>) field.get(hashMap) / <span class="number">0.75</span>;</span><br><span class="line"><span class="comment">//				System.out.println((int) field.get(hashMap) / 0.75);</span></span><br><span class="line">				System.out.println(<span class="string">"扩张容量： "</span> + threshold + <span class="string">" 实际容量： "</span>+ (<span class="keyword">int</span>)v);</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			<span class="keyword">return</span> threshold;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HashMap-的扩容机制："><a href="#HashMap-的扩容机制：" class="headerlink" title="HashMap 的扩容机制："></a><strong>HashMap 的扩容机制：</strong></h3><hr>
<p><strong>在HashMap 中，与容量有关的构造器有三个：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h4 id="这里先对-public-HashMap-）做单元测试，并进行分析"><a href="#这里先对-public-HashMap-）做单元测试，并进行分析" class="headerlink" title="这里先对  public HashMap( ）做单元测试，并进行分析"></a><strong>这里先对  public HashMap( ）做单元测试，并进行分析</strong></h4><hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mapCapacity</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	getHashMapCapacity(map);</span><br><span class="line">	System.out.println( <span class="string">"   已占用容量"</span> + map.size());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里添加是个元素</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i= <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">		map.put(String.valueOf(i),i);</span><br><span class="line">	&#125;</span><br><span class="line">	getHashMapCapacity(map);</span><br><span class="line">	System.out.println( <span class="string">"   已占用容量"</span> + map.size());</span><br><span class="line">	<span class="comment">// 这里添加2个元素</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i= <span class="number">11</span>; i &lt; <span class="number">13</span>; i++)&#123;</span><br><span class="line">		map.put(String.valueOf(i),i);</span><br><span class="line">	&#125;</span><br><span class="line">	getHashMapCapacity(map);</span><br><span class="line">	System.out.println( <span class="string">"   已占用容量"</span> + map.size());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里添加30个元素</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i= <span class="number">31</span>; i &lt; <span class="number">60</span>; i++)&#123;</span><br><span class="line">		map.put(String.valueOf(i),i);</span><br><span class="line">	&#125;</span><br><span class="line">	getHashMapCapacity(map);</span><br><span class="line">	System.out.println( <span class="string">"   已占用容量"</span> + map.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单元测试结果：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DemoApplicationTests      : Started DemoApplicationTests in <span class="number">3.717</span> seconds (JVM running <span class="keyword">for</span> <span class="number">4.477</span>)</span><br><span class="line">   已占用容量<span class="number">0</span></span><br><span class="line">扩张容量： <span class="number">12</span> 实际容量： <span class="number">16</span>    已占用容量<span class="number">11</span></span><br><span class="line">扩张容量： <span class="number">24</span> 实际容量： <span class="number">32</span>    已占用容量<span class="number">13</span></span><br><span class="line">扩张容量： <span class="number">48</span> 实际容量： <span class="number">64</span>    已占用容量<span class="number">42</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">01</span>-<span class="number">29</span> <span class="number">13</span>:<span class="number">08</span>:<span class="number">05.433</span>  INFO <span class="number">29660</span> --- [       Thread-<span class="number">2</span>] o.s.w.c.s.GenericWebApplicationContext   : Closing org.springframework.web.context.support.GenericWebApplicationContext<span class="meta">@ffaa</span>6af: startup date [Wed Jan <span class="number">29</span> <span class="number">13</span>:<span class="number">08</span>:<span class="number">02</span> CST <span class="number">2020</span>]; root of context hierarchy</span><br></pre></td></tr></table></figure>

<p>​    在这里先对单元测试结果进行<strong>分析</strong>：</p>
<p>​    首先我们先看一下，单元测试中，创建了一个默认无参的HashMap，此时第一次打印 集合实例的 容量值，得到的结果是 “已占用容量 0”，这里对代码进行分析：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">            <span class="keyword">if</span> ((<span class="keyword">int</span>) field.get(hashMap) != threshold) &#123;</span><br><span class="line">				threshold = (<span class="keyword">int</span>) field.get(hashMap);</span><br><span class="line">				<span class="comment">// 默认的负载因子是0.75,也就是说实际容量是/0.75</span></span><br><span class="line">				<span class="keyword">double</span> v = (<span class="keyword">int</span>) field.get(hashMap) / <span class="number">0.75</span>;</span><br><span class="line"><span class="comment">//				System.out.println((int) field.get(hashMap) / 0.75);</span></span><br><span class="line">				System.out.println(<span class="string">"扩张容量： "</span> + threshold + <span class="string">" 实际容量： "</span>+ (<span class="keyword">int</span>)v);</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<p>​    这里是通过反射获取 <strong>HashMap</strong> 字节码对象从而得到运行时的构造器或方法实例及相应的属性的值， </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Field field = hashMapClass.getDeclaredField(<span class="string">"threshold"</span>);</span><br></pre></td></tr></table></figure>

<p>​    以上的一条代码便是获取 <strong>“threshold ”</strong> 私有属性的方法，这里看一看该变量在 <strong>HashMap</strong>   中的含义： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The next size value at which to resize (capacity * load factor).</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">   */</span> </span><br><span class="line">  <span class="comment">// (The javadoc description is true upon serialization.   (序列化时，javadoc描述为真。</span></span><br><span class="line">  <span class="comment">// Additionally, if the table array has not been allocated, this  此外，如果还没有分配表数组，则执行此操作</span></span><br><span class="line">  <span class="comment">// field holds the initial array capacity, or zero signifying  字段持有初始数组容量，或表示为零</span></span><br><span class="line">  <span class="comment">// DEFAULT_INITIAL_CAPACITY.)  DEFAULT_INITIAL_CAPACITY)。</span></span><br><span class="line">  <span class="keyword">int</span> threshold;</span><br></pre></td></tr></table></figure>

<p>​    由注释我们可以知道，当前字段在 HashMap 用于存储 <strong>key</strong> 字段元素的长度，当初始化一个无参构造时，在没有对其进行分配元素的情况下，该字段是不会被分配值的，默认值表示值为 <strong>0</strong> 或 为<strong>初始化</strong>长度   <strong>DEFAULT_INITIAL_CAPACITY 。</strong>  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The default initial capacity - MUST be a power of two.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br></pre></td></tr></table></figure>

<p>以上是HashMap中的源码部分对 默认初始容量的定义： 默认长度为 16 。</p>
<p>以上是为了说明一个问题，在默认定义HashMap 集合容量且没有添加元素到容器中的情况下， 其容量值 可能是0 ，也可能是初始容量16.</p>
<p><strong>第一条打印结果分析完毕。</strong></p>
<p><strong>以下对HashMap 的 扩容机制进行一番分析，这里会基于单元测试后面的三条打印结果进行分析：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">扩张容量： 12 实际容量： 16    已占用容量11</span><br><span class="line">扩张容量： 24 实际容量： 32    已占用容量13</span><br><span class="line">扩张容量： 48 实际容量： 64    已占用容量42</span><br></pre></td></tr></table></figure>

<p>从打印的结果，我们可以看到，第一次打印结果中，集合的实际容量为  <strong>16</strong> ，而根据 <strong>HashMap</strong> 的加载因子来计算，当添加的元素达到长度 <strong>0.75</strong> 时会进行一次扩容。这里从<strong>源码方面</strong>进行分析： </p>
<h4 id="此处要搞清楚为什么加载因子是0-75？"><a href="#此处要搞清楚为什么加载因子是0-75？" class="headerlink" title="此处要搞清楚为什么加载因子是0.75？"></a><strong>此处要搞清楚为什么加载因子是0.75？</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the default initial capacity</span></span><br><span class="line"><span class="comment">    * (16) and the default load factor (0.75).</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>在以上源码中，空参构造中，不会对容量大小进行自定义声明，而是使用默认值 <strong>16</strong> ，方法中的成员变量 <strong>this.loadFactor</strong> 代表当前集合的加载因子，即满足一定条件进行容量扩张。其中的 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DEFAULT_LOAD_FACTOR 在源码中的位置：</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The load factor used when none specified in constructor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br></pre></td></tr></table></figure>

<p>这里解决了<strong>加载因子为什么是 0.75</strong> 的问题，不过，在<strong>HashMap</strong>提供的构造器中，<strong>加载因子也是可以自定义</strong>的，就在这里给分析一下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial</span></span><br><span class="line"><span class="comment">     * capacity and load factor.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  loadFactor      the load factor</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment">     *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> +</span><br><span class="line">                                               initialCapacity);</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">            initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">        <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> +</span><br><span class="line">                                               loadFactor);</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">        <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>有上述源码可以知道， map的容量与加载因子可以同时被自定义声明，在<strong>构造函数</strong>中会对<strong>容量</strong>的<strong>合法性</strong>进行校验.</p>
<h4 id="在这里我们提出一个问题：HashMap中容量的最大值是什么？"><a href="#在这里我们提出一个问题：HashMap中容量的最大值是什么？" class="headerlink" title="在这里我们提出一个问题：HashMap中容量的最大值是什么？"></a><strong>在这里我们提出一个问题：HashMap中容量的最大值是什么？</strong></h4><p>我们看看源码中的这一句， </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">initialCapacity = MAXIMUM_CAPACITY;</span><br></pre></td></tr></table></figure>

<p>当容量大于<strong>HashMap</strong> 定义的私有变量 <strong>MAXIMUM_CAPACITY</strong> 时， </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将  MAXIMUM_CAPACITY  赋值给  initialCapacity</span><br></pre></td></tr></table></figure>

<p>在HashMap 中对 <strong>MAXIMUM_CAPACITY</strong> 的值定义的大小是： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The maximum capacity, used if a higher value is implicitly specified</span></span><br><span class="line"><span class="comment"> * by either of the constructors with arguments.</span></span><br><span class="line"><span class="comment"> * MUST be a power of two &lt;= 1&lt;&lt;30.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<p>从这里可以知道，<strong>hashmap</strong>的最大容量是 <strong>2的30次方。</strong> </p>
<h4 id="Hashmap-的-扩容机制"><a href="#Hashmap-的-扩容机制" class="headerlink" title="Hashmap 的 扩容机制"></a><strong>Hashmap 的 扩容机制</strong></h4><p>在 HashMap 在扩容的过程中有几个问题要注意：</p>
<ol>
<li><strong>key 值不可重复与 value 值不可重复的问题？</strong></li>
<li><strong>容量长度的扩容机制？</strong></li>
</ol>
<p>在这里就不对第一个问题进行过多赘述，可以参考 笔者的另一篇博文，</p>
<p><strong>从源码看： hashset如何保证值不会被重复的</strong>  在该博文中对key值和value值不可重复做了详尽的分析。</p>
<p>添加元素到HashMap 集合中，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">      <span class="comment">// 这里添加是个元素</span></span><br><span class="line">  	<span class="keyword">for</span> (<span class="keyword">int</span> i= <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">	map.put(String.valueOf(i),i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入 <strong>put ()</strong>方法中，进行新元素的添加： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment"> * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment"> * value is replaced.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment"> *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment"> *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上述源码中，会对传入的<strong>key</strong> 进行值重复的校验，具体使用 <strong>key</strong> 进行<strong>hash</strong>运算获取在 当前 集合中的 <strong>hash</strong> 值，如下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <strong>put</strong>  方法中，对元素 <code>key-value</code> 添加到集合容器的操作是在 <code>putVal（）</code> 方法中实现的，并且在该方法中调用 <code>resize</code> () 方法对集合容量长度进行扩容。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<strong>DEBUG分析</strong>查看 putVal方法中的 参数，当前 map 集合的长度为 8 ，有八个key ，每个 key 对应一个value </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu122.png" width="60%">

<p>根据源码我们可以知道，hashmap的底层是由数组和链表构成的，如上图中，<code>Node&lt;K，V&gt;[] ta</code> 代表当前map集合的底层结构，该结构由一个<code>Node</code> （链表）类型的数组构成。每个新添加的 <code>key-value</code> 会以一个  <code>Node&lt;K，V&gt;</code> 的链表节点的形式被添加到 集合 tab 中 。</p>
<p>在添加元素的时候会调用 <code>resize（）</code>方法，并在<code>resize（）</code> 方法中将新的集合数据存储到 <code>table</code> 私有变量中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The table, initialized on first use, and resized as</span></span><br><span class="line"><span class="comment"> * necessary. When allocated, length is always a power of two.</span></span><br><span class="line"><span class="comment"> * (We also tolerate length zero in some operations to allow</span></span><br><span class="line"><span class="comment"> * bootstrapping mechanics that are currently not needed.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br></pre></td></tr></table></figure>

<p>以下是<strong>resize（）</strong> 的代码： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initializes or doubles table size.  If null, allocates in</span></span><br><span class="line"><span class="comment">     * accord with initial capacity target held in field threshold.</span></span><br><span class="line"><span class="comment">     * Otherwise, because we are using power-of-two expansion, the</span></span><br><span class="line"><span class="comment">     * elements from each bin must either stay at same index, or move</span></span><br><span class="line"><span class="comment">     * with a power of two offset in the new table.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the table</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">        <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">        <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">        <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">                threshold = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span> oldTab;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">                newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">            newCap = oldThr;</span><br><span class="line">        <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">            newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">            newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                      (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">        threshold = newThr;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">            Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">        table = newTab;</span><br><span class="line">        <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">                Node&lt;K,V&gt; e;</span><br><span class="line">                <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                        newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                        ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                    <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                        Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; next;</span><br><span class="line">                        <span class="keyword">do</span> &#123;</span><br><span class="line">                            next = e.next;</span><br><span class="line">                            <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                    loHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = e;</span><br><span class="line">                                loTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                    hiHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = e;</span><br><span class="line">                                hiTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j] = loHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j + oldCap] = hiHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newTab;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在以上源码中，关于扩容部分的代码是： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">               oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">          newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br></pre></td></tr></table></figure>

<p><strong>HashMap</strong> 中对当前的容量值使用左位移的方式， <strong>oldCap &lt;&lt; 1</strong> ，将<strong>集合容量扩张</strong>为当前的<strong>2</strong> 的<strong>N次幂。此时，我们可以知道HashMap</strong> 的扩容是新容量为当前的  2的N次方.</p>
<h4 id="HashMap-集合进行扩容的时机是？"><a href="#HashMap-集合进行扩容的时机是？" class="headerlink" title="HashMap 集合进行扩容的时机是？"></a><strong>HashMap 集合进行扩容的时机是？</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">    newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">              (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>前提：</strong> 当前集合集合的链表数组中必须有值的情况下，才会触发扩容机制。</p>
<p>当前的集合元素长度达到了 当前给定集合的容量的<code>0.75</code>倍时，该链表数组进行自增左位移，默认为<code>2的N次幂</code>。</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>容器-集合</category>
      </categories>
  </entry>
  <entry>
    <title>集合扩容机制(一)Collection-List</title>
    <url>/2020/03/13/%E9%9B%86%E5%90%88%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6(%E4%B8%80)Collection-List/</url>
    <content><![CDATA[<p>​    Java 中提供了很多的集合类，包括，collection的子接口list、set，以及map等。由于它们的底层构成不同，以及数据的构造为单列、多列、可重复、不可重复，导致其扩容机制也不尽相同。 </p>
<h1 id="List"><a href="#List" class="headerlink" title="List"></a>List</h1><h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a><strong>ArrayList</strong></h2><p>案例： 获取ArrayList 容量大小的方法： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getArrayListCapacity</span><span class="params">(ArrayList&lt;?&gt; arrayList)</span> </span>&#123;</span><br><span class="line">	Class&lt;ArrayList&gt; arrayListClass = ArrayList<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Field field = arrayListClass.getDeclaredField(<span class="string">"elementData"</span>);</span><br><span class="line">		field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		Object[] objects = (Object[])field.get(arrayList);</span><br><span class="line">		<span class="keyword">return</span> objects.length;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArrayList以数组的形式存储。ArrayList中与容量有关的构造器有两个，<strong>代码如下：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty list with an initial capacity of ten.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由以上代码可知，ArrayList 的容量扩容包含有 ArrayList(int initialCapacity) ，另一个则是 ArrayList() ；</p>
<p>第一个构造器在初始创建时以形参将容量大小进行定义，由外部自定义；第二个构造器没有传入参数，使用默认初始化的容量大小；<strong>详细解析如下：</strong></p>
<p><strong>第一个有参构造器：自定长度在后面，这里先看无参有默认容量长度的构造器怎么实现的扩容？</strong></p>
<p><strong>第二个无参构造器：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty list with an initial capacity of ten.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>代码测试：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">catapicity</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ArrayList&lt;Object&gt; objects = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	objects.add(<span class="string">"a"</span>);</span><br><span class="line">	objects.add(<span class="string">"b"</span>);</span><br><span class="line">	objects.add(<span class="string">"c"</span>);</span><br><span class="line">	System.out.println(objects.size() + <span class="string">" "</span> + getArrayListCapacity(objects));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 增加一个值</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">9</span> ; i ++ )&#123;</span><br><span class="line">		objects.add(i);</span><br><span class="line">	&#125;</span><br><span class="line">	System.out.println(objects.size() + <span class="string">" "</span> + getArrayListCapacity(objects));</span><br><span class="line">	<span class="comment">// 增加一个值</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span> ; i &lt;<span class="number">15</span> ; i ++ )&#123;</span><br><span class="line">		objects.add(i);</span><br><span class="line">	&#125;</span><br><span class="line">	System.out.println(objects.size() + <span class="string">" "</span> + getArrayListCapacity(objects));</span><br><span class="line">	<span class="comment">// 增加一个值</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">15</span> ; i &lt; <span class="number">20</span> ; i ++ )&#123;</span><br><span class="line">		objects.add(i);</span><br><span class="line">	&#125;</span><br><span class="line">	System.out.println(objects.size() + <span class="string">" "</span> + getArrayListCapacity(objects));</span><br><span class="line"></span><br><span class="line">	objects.add(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">	System.out.println(objects.size() + <span class="string">" "</span> + getArrayListCapacity(objects));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    在上述单元测试中，创建了一个无参构造的ArrayList 集合，并对其进行元素的添加，以满足对元素添加过程中容量大小的扩张规则。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">长度:  <span class="number">3</span> 容量： <span class="number">10</span></span><br><span class="line">长度:  <span class="number">12</span> 容量： <span class="number">15</span></span><br><span class="line">长度:  <span class="number">17</span> 容量： <span class="number">22</span></span><br><span class="line">长度:  <span class="number">22</span> 容量： <span class="number">22</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">01</span>-<span class="number">29</span> <span class="number">11</span>:<span class="number">42</span>:<span class="number">35.260</span>  INFO <span class="number">28488</span> --- [       Thread-<span class="number">2</span>] o.s.w.c.s</span><br></pre></td></tr></table></figure>

<p><strong>上述是单元测试结果，在这里做一番分析：</strong></p>
<p>在以上的代码中，默认使用ArrayList的初始化容量长度，在ArrayList中，默认初始化容量是 10 ,</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Default initial capacity.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>从测试结果可以看到，当元素的长度为3时，其容量为默认的值 10 ； 当添加的元素超过初始容量后，即 12 &gt; 10  时，集合进行了自动扩容，添加每一个元素都会调用  ensureCapacityInternal(int minCapacity)  方法，在该方法中比较长度是否达到当前容量的边缘，将比较的结果 覆盖原来的 minCapacity 参数，该值用于保存当前的容器元素长度；如单元测试中，当元素个数超过默认的 值 10 时，会调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br></pre></td></tr></table></figure>

<p>方法，并接着调用  <code>ensureExplicitCapacity(minCapacity);</code>方法，该方法会对当前集合长度与最大容量值进行比较，并调用 <code>grow(minCapacity)</code> 方法进行位移扩容： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现ArrayList 集合扩容的代码如下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Increases the capacity to ensure that it can hold at least the</span></span><br><span class="line"><span class="comment">  * number of elements specified by the minimum capacity argument.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> minCapacity the desired minimum capacity</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// overflow-conscious code</span></span><br><span class="line">     <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">     <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">     <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">         newCapacity = minCapacity;</span><br><span class="line">     <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">         newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">     <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">     elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>在集合长度超过初始值或当前最大值时，在   <strong>grow(int minCapacity)</strong> 方法中，进行了扩容，该扩容如代码所示， 声明当前集合的最大容量为 <strong>oldCapacity</strong> ， 新增的长度为 <strong>oldCapacity</strong> 右位移一位数，当容量为 10 时，二进制为  “<strong>8020</strong>” &gt;&gt; 1 右移后为 “<strong>0401</strong>” ，十进制值为 <strong>5</strong> ，此时将 <strong>oldCapacity</strong> + 位移后的值 即   <strong>10 + 5 = 15</strong> 。 </p>
<p>此时完成扩容，<strong>newCapacity  = 15</strong> 就是 ArrayList 扩容后的最新容量大小。</p>
<p>根据扩容规则可知，容量的递增可预计为  <strong>0 、10、15、22、33、49</strong>，以此类推。</p>
<p>注意： <strong>这里对新的容量 newCapacity 和 当前元素长度进行比较，如果元素添加的比较多，超过当次位移扩容的容量大小，则会 直接使用  hugeCapacity 方法进行扩容，</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">      <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">          Integer.MAX_VALUE :</span><br><span class="line">          MAX_ARRAY_SIZE;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>第一个有参构造器：</strong> </p>
<p><strong>单元测试：</strong></p>
<p><strong>① 当声明的容量小于默认初始值10 时，会在超过初始容量10 后进行扩容，</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">catapicity</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ArrayList&lt;Object&gt; objects = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">		objects.add(<span class="string">"a"</span>);</span><br><span class="line">		objects.add(<span class="string">"b"</span>);</span><br><span class="line">		objects.add(<span class="string">"c"</span>);</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 增加一个值</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">2</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="comment">// 增加一个值</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">3</span>; i &lt;<span class="number">5</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="comment">// 增加一个值</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">6</span> ; i &lt; <span class="number">10</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">11</span> ; i &lt; <span class="number">15</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">11</span> ; i &lt; <span class="number">15</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试结果：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">长度:  <span class="number">3</span> 容量： <span class="number">5</span></span><br><span class="line">长度:  <span class="number">5</span> 容量： <span class="number">5</span></span><br><span class="line">长度:  <span class="number">7</span> 容量： <span class="number">7</span></span><br><span class="line">长度:  <span class="number">11</span> 容量： <span class="number">15</span></span><br><span class="line">长度:  <span class="number">15</span> 容量： <span class="number">15</span></span><br><span class="line">长度:  <span class="number">19</span> 容量： <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><strong>②超过初始化容量的元素增加：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">catapicity</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ArrayList&lt;Object&gt; objects = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">13</span>);</span><br><span class="line"><span class="comment">//		objects.add("a");</span></span><br><span class="line"><span class="comment">//		objects.add("b");</span></span><br><span class="line"><span class="comment">//		objects.add("c");</span></span><br><span class="line"><span class="comment">//		System.out.println("长度:  "+objects.size() + " 容量： " + getArrayListCapacity(objects));</span></span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 增加一个值</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">15</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="comment">// 增加一个值</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">3</span>; i &lt;<span class="number">5</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="comment">// 增加一个值</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">6</span> ; i &lt; <span class="number">10</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">11</span> ; i &lt; <span class="number">15</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">11</span> ; i &lt; <span class="number">15</span> ; i ++ )&#123;</span><br><span class="line">			objects.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"长度:  "</span>+objects.size() + <span class="string">" 容量： "</span> + getArrayListCapacity(objects));</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">长度:  15 容量： 19</span><br><span class="line">长度:  17 容量： 19</span><br><span class="line">长度:  21 容量： 28</span><br><span class="line">长度:  25 容量： 28</span><br><span class="line">长度:  29 容量： 42</span><br></pre></td></tr></table></figure>

<p>超过初试容量后，<strong>第一次扩容</strong>会直接使用当前集合长度作为 <strong>oldCapacity</strong> 进行扩容</p>
<h2 id="2、LinkedList"><a href="#2、LinkedList" class="headerlink" title="2、LinkedList"></a><strong>2、LinkedList</strong></h2><p>链表结构，且是是双向链表， 不涉及扩容的问题。</p>
<h2 id="3、Vector"><a href="#3、Vector" class="headerlink" title="3、Vector"></a><strong>3、Vector</strong></h2><p>Vector与ArrayList一样，是存储在数组结构中。  与扩容机制相关的构造器有三个,分别是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Vector(<span class="keyword">int</span> initialCapacity, <span class="keyword">int</span> capacityIncrement)，</span><br><span class="line">Vector(<span class="keyword">int</span> initialCapacity)</span><br><span class="line">Vector()</span><br></pre></td></tr></table></figure>

<p>  其实这后两个最终都是调用了第一个构造器，不过是使用了不同的默认参数，initialCapacity是初始容量，默认是10，capacityIncrement 是每次扩容时候的递增数量，如果该数值不等于0则每次扩容的时候是原来的二倍，如果该数值大于0，则每次增长的数量等于该数值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> newCapacity = oldCapacity + ((capacityIncrement &gt; <span class="number">0</span>) ?</span><br><span class="line">                                 capacityIncrement : oldCapacity);</span><br><span class="line">）。</span><br></pre></td></tr></table></figure>

<p><strong>比如：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Vector&lt;String&gt; v = <span class="keyword">new</span> Vector&lt;String&gt;(); <span class="comment">// 10 20 ,40 80 ，160，320 的速度递增</span></span><br><span class="line"></span><br><span class="line">Vector&lt;String&gt; v2 = <span class="keyword">new</span> Vector&lt;&gt;(<span class="number">5</span>,<span class="number">3</span>);<span class="comment">// 5 8 11 14 17 ，20，23 的速度递增。</span></span><br></pre></td></tr></table></figure>

<p>他的加载因子也是10</p>
<h2 id="4、Stack"><a href="#4、Stack" class="headerlink" title="4、Stack"></a><strong>4、Stack</strong></h2><p>  继承于Vector，所以他的扩容机制等同于Vector的默认情况，也就是2倍速度扩容，加载因子为1</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>容器-集合</category>
      </categories>
      <tags>
        <tag>集合 扩容机制 List</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot原理（二）自动配置原理</title>
    <url>/2020/03/13/SpringBoot%E5%8E%9F%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="Spring-Boot-的自动配置原理"><a href="#Spring-Boot-的自动配置原理" class="headerlink" title="Spring Boot 的自动配置原理"></a><strong>Spring Boot</strong> 的自动配置原理</h2><p>本节主要分析Spring Boot 的自动配置原理，主要通过源码进行分析。首先引入一段代码，来开始我们的<strong>原理解析步骤：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(DemoApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述是主启动类的代码，我们从中可以看到在类名前面添加了一个注解<strong>@SpringBootApplication</strong>；在前面的<strong>SpringBoot</strong> 的自启动配置一文中，我们可以得知，在主启动类中，<strong>main</strong>方法中的 <strong>SpringApplication.run(DemoApplication.class,args)；</strong>是对主启动类进行初始化并启动<strong>IOC</strong>容器进行配置bean的管理。</p>
<p>在这里，我们可以发现，<strong>SpringBoot</strong> 中比 <strong>Spring</strong> 要优秀的一点 <strong>自动配置</strong> 的特性并没有表现在main方法中，从代码中，我们可以看出，也许 <strong>@SpringBootApplication</strong> 这一个注解会与<strong>SpringBoot</strong> 的自动配置有关，本文将从这方面下手，根据源码进行分析。</p>
<p>使用过<strong>Spring Boot</strong> 的我们都知道，<strong>SpringBoot</strong> 中有一个全局配置文件： application.properties 或 <strong>application.yml</strong>。</p>
<p>我们在项目开发过程中对程序配置的 端口、数据库等属性都可以在这个文件中进行配置，最常见的配置有： server.port 、logging.level.* 等等，然而我们实际用到的往往只是很少的一部分，那么这些属性是否有据可依呢？答案是肯定的，这些属性都可以在官方文档中查找到：</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#common-application-properties" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#common-application-properties</a></p>
<p>在<strong>Appendix A. Common application properties</strong>小节下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># ===================================================================</span><br><span class="line"># COMMON SPRING BOOT PROPERTIES</span><br><span class="line">#</span><br><span class="line"># This sample file is provided as a guideline. Do NOT copy it in its</span><br><span class="line"># entirety to your own application.               ^^^</span><br><span class="line"># ===================================================================</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># ----------------------------------------</span><br><span class="line"># CORE PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line">debug=false # Enable debug logs.</span><br><span class="line">trace=false # Enable trace logs.</span><br><span class="line"> </span><br><span class="line"># LOGGING</span><br><span class="line">logging.config= # Location of the logging configuration file. For instance, `classpath:logback.xml` for Logback.</span><br><span class="line">logging.exception-conversion-word=%wEx # Conversion word used when logging exceptions.</span><br><span class="line">logging.file= # Log file name (for instance, `myapp.log`). Names can be an exact location or relative to the current directory.</span><br><span class="line">logging.file.max-history=0 # Maximum of archive log files to keep. Only supported with the default logback setup.</span><br><span class="line">logging.file.max-size=10MB # Maximum log file size. Only supported with the default logback setup.</span><br><span class="line">logging.group.*= # Log groups to quickly change multiple loggers at the same time. For instance, `logging.level.db=org.hibernate,org.springframework.jdbc`.</span><br><span class="line">logging.level.*= # Log levels severity mapping. For instance, `logging.level.org.springframework=DEBUG`.</span><br><span class="line">logging.path= # Location of the log file. For instance, `/var/log`.</span><br><span class="line">logging.pattern.console= # Appender pattern for output to the console. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.dateformat=yyyy-MM-dd HH:mm:ss.SSS # Appender pattern for log date format. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.file= # Appender pattern for output to a file. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.level=%5p # Appender pattern for log level. Supported only with the default Logback setup.</span><br><span class="line">logging.register-shutdown-hook=false # Register a shutdown hook for the logging system when it is initialized.</span><br><span class="line"> </span><br><span class="line"># AOP</span><br><span class="line">spring.aop.auto=true # Add @EnableAspectJAutoProxy.</span><br><span class="line">spring.aop.proxy-target-class=true # Whether subclass-based (CGLIB) proxies are to be created (true), as opposed to standard Java interface-based proxies (false).</span><br></pre></td></tr></table></figure>

<p>我们对自动配置大胆做个猜测，在<strong>Spring Boot</strong> 中有个机制，它将通过<strong>pom</strong>.<strong>xml</strong> 依赖加载到的诸如 <strong>mybatis</strong>、<strong>mysql</strong>、<strong>activemq</strong>等的jar 包创建对应的 <strong>bean</strong>，然后将bean放到容器中，并通过在 <strong>application.properties</strong> 或 <strong>application.yml</strong> 文件中进行配置属性参数映射到对应的 <strong>bean</strong> 中的属性上，从而实现如mysql 的<font color=red>数据库链接地址、密码、用户名</font>的配置等操作。</p>
<p>那么，在这里我们针对猜测的自动配置过程提出三个关键性问题，分别是：</p>
<ol>
<li>SpringBoot 中怎么将引入的依赖包的类<font color=red>创建bean</bean>并加入到容器中的？</li>
<li>springboot 中怎么获取到配置文件 application.properties 或application.yml 中的属性参数？</li>
<li>springboot 怎么将获取到的配置文件参数映射到bean中的属性上？</li>
</ol>
<h3 id="配置加载依赖并创建bean加入到容器中："><a href="#配置加载依赖并创建bean加入到容器中：" class="headerlink" title="配置加载依赖并创建bean加入到容器中："></a><strong>配置加载依赖并创建bean加入到容器中：</strong></h3><h4 id="引入-jar"><a href="#引入-jar" class="headerlink" title="引入 jar"></a>引入 jar</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">    <span class="comment">&lt;!--mybatis 开发包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--springboot web模块支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--druid 的数据源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th align="right"><strong>spring-boot-starter-web</strong></th>
<th align="left">包自动帮我们引入了web模块开发需要的相关jar包，</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><strong>mybatis-spring-boot-starter</strong></td>
<td align="left">帮我们引入了dao开发相关的jar包。</td>
</tr>
<tr>
<td align="right"><strong>spring-boot-starter-xxx</strong></td>
<td align="left">是官方提供的starter，xxx-spring-boot-starter是第三方提供的starter。</td>
</tr>
</tbody></table>
<p><strong>如下图中：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu113.png" width="60%">

<p>从以下的截图可以看出在这个mybatis-spring-boot-starter 中，并没有任何源码，只有一个pom文件，它的作用就是帮我们引入了相关jar包。 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu114.png" width="60%">

<p>在这里我们看一下SpringBoot 中数据源的配置方案： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">     driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">     url: jdbc:mysql:<span class="comment">//localhost:3333/aiicp-gxzx?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;autoReconnect=true&amp;serverTimezone=UTC</span></span><br><span class="line">     username: root</span><br><span class="line">     password: root</span><br><span class="line">     type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">     dbcp2:</span><br><span class="line">       min-idle: <span class="number">5</span></span><br><span class="line">       initial-size: <span class="number">5</span></span><br><span class="line">       max-total: <span class="number">5</span></span><br><span class="line">       max-wait-millis: <span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>在这里，<strong>starter</strong>机制帮我们完成了项目起步所需要的相关jar包。我们知道，传统的<strong>spring</strong>应用中需要在 <strong>application.xml</strong> 中配置很多<strong>bean</strong>的，比如 <strong>dataSource</strong> 的配置，<strong>transactionManager</strong>的配置…… <strong>springboot</strong>是如何帮我们完成这些<strong>bean</strong>的配置的呢？</p>
<blockquote>
<p> —— 自动配置</p>
</blockquote>
<h4 id="基于java代码的bean的配置"><a href="#基于java代码的bean的配置" class="headerlink" title="基于java代码的bean的配置"></a>基于java代码的bean的配置</h4><p>​    以mybatis为例，引入的mybatis 包不只有一个pom.xml文件， 还有一个关键性的包：mybatis-spring-boot-autoconfigure这个包 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu115.png" width="60%">

<p>从mybatis-spring-boot-autoconfigure包下的文件名我们可以知道<strong>MybatisAutoConfiguration</strong>类是<strong>自动配置</strong>的核心文件;我们进入该文件看看， </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu116.png" width="60%">

<p>从截图中我们可以看到，类名和方法名前分别添加了<strong>@Configuration 、@Bean两个注解，了解Spring的都知道，这两个注解一起使用就可以创建一个基于java代码的配置类，可以用来替代相应的xml配置文件。</strong></p>
<p><strong>@Configuration注解的类可以看作是能生产让Spring IoC容器管理的Bean实例的工厂。</strong></p>
<p><strong>@Bean注解告诉Spring，一个带有@Bean的注解方法将返回一个对象，该对象应该被注册到spring容器中。</strong></p>
<h5 id="传统的基于xml的bean配置方法如下："><a href="#传统的基于xml的bean配置方法如下：" class="headerlink" title="传统的基于xml的bean配置方法如下："></a>传统的基于xml的bean配置方法如下：</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"com.mmall.Car"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"wheel"</span> <span class="attr">ref</span> = <span class="string">"wheel"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"wheel"</span> <span class="attr">class</span>=<span class="string">"com.mmall.Wheel"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="相当于用基于java代码的配置方式："><a href="#相当于用基于java代码的配置方式：" class="headerlink" title="相当于用基于java代码的配置方式："></a>相当于用基于java代码的配置方式：</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Conf</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Bean</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">car</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        Car car = <span class="keyword">new</span> Car();  </span><br><span class="line">        car.setWheel(wheel());  </span><br><span class="line">        <span class="keyword">return</span> car;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Bean</span>   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Wheel <span class="title">wheel</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Wheel();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由此，我们可以知道，上面的 <strong>MybatisAutoConfiguration</strong>这个类，自动帮我们生成了<strong>SqlSessionFactory</strong> 这些 <strong>Mybatis</strong> 的重要实例并叫个<strong>spring</strong>容器管理，从而完成<strong>bean</strong>的自动注册。 </p>
<h4 id="springboot-特有的常见条件依赖注解："><a href="#springboot-特有的常见条件依赖注解：" class="headerlink" title="springboot 特有的常见条件依赖注解："></a><strong>springboot</strong> 特有的常见条件依赖注解：</h4><table>
<thead>
<tr>
<th>@ConditionalOnBean</th>
<th>仅在当前上下文中存在某个bean时，才会实例化这个Bean</th>
</tr>
</thead>
<tbody><tr>
<td>@ConditionalOnClass</td>
<td>某个class位于类路径上，才会实例化这个Bean</td>
</tr>
<tr>
<td>@ConditionalOnExpression</td>
<td>当表达式为true的时候，才会实例化这个Bean</td>
</tr>
<tr>
<td>@ConditionalOnMissingBean</td>
<td>仅在当前上下文中不存在某个bean时，才会实例化这个Bean</td>
</tr>
<tr>
<td>@ConditionalOnMissingClass</td>
<td>某个class在类路径上不存在的时候，才会实例化这个Bean</td>
</tr>
<tr>
<td>@ConditionalOnNotWebApplication</td>
<td>不是web应用时才会实例化这个Bean</td>
</tr>
<tr>
<td>@AutoConfigureAfter</td>
<td>在某个bean完成自动配置后实例化这个bean</td>
</tr>
<tr>
<td>@AutoConfigureBefore</td>
<td>在某个bean完成自动配置前实例化这个bean</td>
</tr>
</tbody></table>
<p>​    到这里，我们知道了，要想完成Mybatis的自动配置，需要在类路径中存在 <code>SqlSessionFactory.class、SqlSessionFactoryBean.class</code> 这两个类，同时也需要有DataSource这个bean存在且已经自动注册到容器中。</p>
<p>​    根据 <em><code>MybatisAutoConfiguration</code></em> 的名称我们可以得知，在<code>Springboot</code> 中，引入自动配置的DataSource的包的名称应该是 <code>DataSourceAutoConfiguration</code>;</p>
<p>​    通过查看该包所在目录我们知道这个包又属于spring-boot-autoconfigure-2.0.4.RELEASE.jar这个包，自动配置这个包帮们引入了<code>jdbc、kafka、logging、mongo**、**quartz</code>等包。很多包需要我们引入相应jar后自动配置才生效。 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu117.png" width="60%">

<h3 id="获取到配置文件-application-properties-或application-yml-中的参数"><a href="#获取到配置文件-application-properties-或application-yml-中的参数" class="headerlink" title="获取到配置文件 application.properties 或application.yml 中的参数"></a><strong>获取到配置文件 application.properties 或application.yml 中的参数</strong></h3><h4 id="Bean-参数的获取"><a href="#Bean-参数的获取" class="headerlink" title="Bean 参数的获取"></a><strong>Bean 参数的获取</strong></h4><p>在这里，我们要解决的是怎么从 <code>.properties或yml</code>文件中获取参数，让<code>springboot</code>知道配置文件中有哪些参数？</p>
<p>在<code>DataSourceAutoConfiguration</code>类里面，我们注意到使用了<code>EnableConfigurationProperties</code>这个注解。在该注解中引入了 <code>DataSourceProperties.class</code> 这个字节码文件。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123;DataSource<span class="class">.<span class="keyword">class</span>, <span class="title">EmbeddedDatabaseType</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(</span>&#123;DataSourceProperties<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123;DataSourcePoolMetadataProvidersConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">DataSourceInitializationConfiguration</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">DataSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击进入查看，DataSourceProperties中封装了数据源的各个属性，且使用了注解ConfigurationProperties指定了配置文件的前缀。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">    prefix = <span class="string">"spring.datasource"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title">BeanClassLoaderAware</span>, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ClassLoader classLoader;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> generateUniqueName;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;? extends DataSource&gt; type;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String jndiName;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@EnableConfigurationProperties与@ConfigurationProperties这两个注解有什么用呢？我们先看一个例子： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo_started;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanClassLoaderAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> PropertiesBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/31 20:29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"spring.datasource"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//省略getter、setter...</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"PropertiesBean&#123;"</span> +</span><br><span class="line">                <span class="string">"url='"</span> + url + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo_started;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> SpringbootMybatisDemoApplication</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/31 20:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.example"</span>)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootMybatisDemoApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//SpringApplication.run(SpringbootMybatisDemoApplication.class, args);</span></span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(SpringbootMybatisDemoApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">        <span class="comment">//获取yml配置转换后的bean</span></span><br><span class="line">        System.out.println(<span class="string">"----------------------"</span>+context.getBean(PropertiesBean<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu118.png" width="60%">

<p>从运行结果可以看出<code>@ConfigurationProperties与@EnableConfigurationPropertie</code>的作用就是：</p>
<p><code>@ConfigurationProperties</code>注解的作用是把yml或者properties配置文件转化为bean。</p>
<p><code>@EnableConfigurationProperties</code>注解的作用是使<code>@ConfigurationProperties</code>注解生效。如果只配置<code>@ConfigurationProperties</code>注解，在spring容器中是获取不到<code>yml或者properties</code>配置文件转化的bean的。</p>
<p>通过这种方式，把<code>yml或者properties</code>配置参数转化为bean，这些bean又是如何被发现与加载的？</p>
<h4 id="发现bean-并进行加载"><a href="#发现bean-并进行加载" class="headerlink" title="发现bean 并进行加载"></a><strong>发现bean 并进行加载</strong></h4><p>到了这里，我们解决了两个问题，知道了通过pom.xml加载到程序中的jar包是怎么被Springboot进行自动配置，也知道了Springboot中是怎么读取并使用 .properties或 .yml 文件的参数的。接下来我们需要将两者进行关联，参数Bean是怎么被发现，并加载到容器中与自动配置的bean进行关联映射的？</p>
<h4 id="Bean的发现"><a href="#Bean的发现" class="headerlink" title="Bean的发现"></a>Bean的发现</h4><p>从前面<strong>Springboot</strong>的自启动机制中可以知道，<strong>Springboot</strong> 默认扫描启动类所在的包下的主类与子类的所有组件，但并没有包括依赖包中的类，那么依赖包中的<strong>bean</strong>是如何被发现和加载的？ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(DemoApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在前面说过，<strong>SpringBoot</strong> 的自动配置是由<strong>@SpringBootApplication</strong>这个注解起得作用，具体的实现原理我们点进去看一下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringBootConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.TypeExcludeFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.FilterType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan.Filter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.AliasFor;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    excludeFilters = &#123;<span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter<span class="class">.<span class="keyword">class</span>&#125;</span></span><br><span class="line"><span class="class">), @<span class="title">Filter</span>(</span></span><br><span class="line"><span class="class">    <span class="title">type</span> </span>= FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>&#125;</span></span><br><span class="line"><span class="class">)&#125;</span></span><br><span class="line"><span class="class">)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br><span class="line"> ........   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SpringBootApplication注解类中，实际上重要的只有三个Annotation：</p>
<blockquote>
<p>@Configuration（@SpringBootConfiguration里面还是应用了@Configuration）</p>
<p>@EnableAutoConfiguration</p>
<p>@ComponentScan</p>
</blockquote>
<table>
<thead>
<tr>
<th>@Configuration</th>
<th>作用上面我们已经知道了，被注解的类将成为一个bean配置类。</th>
</tr>
</thead>
<tbody><tr>
<td>@ComponentScan</td>
<td>的作用就是自动扫描并加载符合条件的组件，比如@Component和@Repository等，最终将这些bean定义加载到spring容器中。</td>
</tr>
<tr>
<td>@Repository等，</td>
<td>最终将这些bean定义加载到spring容器中。</td>
</tr>
<tr>
<td>@EnableAutoConfiguration</td>
<td>这个注解的功能很重要，借助@Import的支持，收集和注册依赖包中相关的bean定义。</td>
</tr>
</tbody></table>
<p>这里进入到 <code>@EnableAutoConfiguration</code> 注解中看看： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;AutoConfigurationImportSelector<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableAutoConfiguration</span> </span>&#123;</span><br><span class="line">    String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"> </span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"> </span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上源码，<code>@EnableAutoConfiguration</code>注解引入了<code>@AutoConfigurationPackage</code>和<code>@Import</code>这两个注解。<code>@AutoConfigurationPackage</code>的作用就是自动配置的包，<code>@Import</code>导入需要自动配置的组件。 </p>
<p>进入@<strong>AutoConfigurationPackage</strong>，发现也是引入了@<strong>Import</strong>注解 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;Registrar<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">AutoConfigurationPackage</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点进去 @<strong>Import</strong> 引用的 <strong>Registrar.class</strong> 的<strong>Registrar</strong>类去看看： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Order</span>(-<span class="number">2147483648</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Registrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">DeterminableImports</span> </span>&#123;</span><br><span class="line">        Registrar() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">            AutoConfigurationPackages.register(registry, (<span class="keyword">new</span> AutoConfigurationPackages.PackageImport(metadata)).getPackageName());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> AutoConfigurationPackages.PackageImport(metadata));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上述源码我们可以解决一个小困惑，如下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> AutoConfigurationPackages.PackageImport(metadata)).getPackageName()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">new</span> AutoConfigurationPackages.PackageImport(metadata)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AutoConfigurationPackages翻译成人话，就是 自动配置的包。PackageImport()方法代表配置的原数据</p>
</blockquote>
<p>​    这两句代码的作用是用来加载启动类所在的包下的主类与子类的所有组件注册到<strong>spring</strong> 容器，这就是前文所说的<strong>springboot</strong>默认扫描启动类所在的包下的主类与子类的所有组件。</p>
<p>​    这里进入<strong>AutoConfigurationPackages</strong> 包去看看，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotationMetadata</span> <span class="keyword">extends</span> <span class="title">ClassMetadata</span>, <span class="title">AnnotatedTypeMetadata</span> </span>&#123;</span><br><span class="line">    <span class="function">Set&lt;String&gt; <span class="title">getAnnotationTypes</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function">Set&lt;String&gt; <span class="title">getMetaAnnotationTypes</span><span class="params">(String var1)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasAnnotation</span><span class="params">(String var1)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasMetaAnnotation</span><span class="params">(String var1)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasAnnotatedMethods</span><span class="params">(String var1)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function">Set&lt;MethodMetadata&gt; <span class="title">getAnnotatedMethods</span><span class="params">(String var1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单介绍一下，AnnotationMetadata 有两种重要的实现方案，一种基于 Java 反射，另一种基于 ASM 框架。</p>
<p>两种实现方案适用于不同场景。StandardAnnotationMetadata基于 Java 反射，需要加载类文件。而 AnnotationMetadataReadingVisitor 基于 ASM 框架无需提前加载类，所以适用于 Spring 应用扫描指定范围内模式注解时使用。</p>
<p>下面是metadata 的相关接口和类的关系图：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu119.png" width="60%">

<p>获取并返回包名，PackageImport </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PackageImport</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String packageName;</span><br><span class="line"> </span><br><span class="line">        PackageImport(AnnotationMetadata metadata) &#123;</span><br><span class="line">            <span class="keyword">this</span>.packageName = ClassUtils.getPackageName(metadata.getClassName());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.packageName.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> obj != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.getClass() == obj.getClass() ? <span class="keyword">this</span>.packageName.equals(((AutoConfigurationPackages.PackageImport)obj).packageName) : <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPackageName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.packageName;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Package Import "</span> + <span class="keyword">this</span>.packageName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>根据元数据中返回的类名获取其所在的包目录，将该包目录返回给容器，用于自定义扫描包或默认配置扫描。 </p>
<p>回到原来的问题上，搜集并注册到spring 容器的那些bean来自哪里？</p>
<p>​    进入<code>@EnableAutoConfiguration</code>注解的<code>EnableAutoConfigurationImportSelector</code> 类中去看看，该类继承了A<code>utoConfigurationImportSelector</code> 类，进入该类进行看下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.AnnotationMetadata;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableAutoConfigurationImportSelector</span> <span class="keyword">extends</span> <span class="title">AutoConfigurationImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EnableAutoConfigurationImportSelector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">        return this.getClass().equals(EnableAutoConfigurationImportSelector.class) ? ((Boolean)this.getEnvironment().getProperty("spring.boot.enableautoconfiguration", Boolean.class, true)).booleanValue() : true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title">DeferredImportSelector</span>, <span class="title">BeanClassLoaderAware</span>, <span class="title">ResourceLoaderAware</span>, <span class="title">BeanFactoryAware</span>, <span class="title">EnvironmentAware</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] NO_IMPORTS = <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(AutoConfigurationImportSelector<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    ...............</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AutoConfigurationImportSelector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">            <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(<span class="keyword">this</span>.beanClassLoader);</span><br><span class="line">                AnnotationAttributes attributes = <span class="keyword">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">                List&lt;String&gt; configurations = <span class="keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">                configurations = <span class="keyword">this</span>.removeDuplicates(configurations);</span><br><span class="line">                configurations = <span class="keyword">this</span>.sort(configurations, autoConfigurationMetadata);</span><br><span class="line">                Set&lt;String&gt; exclusions = <span class="keyword">this</span>.getExclusions(annotationMetadata, attributes);</span><br><span class="line">                <span class="keyword">this</span>.checkExcludedClasses(configurations, exclusions);</span><br><span class="line">                configurations.removeAll(exclusions);</span><br><span class="line">                configurations = <span class="keyword">this</span>.filter(configurations, autoConfigurationMetadata);</span><br><span class="line">                <span class="keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">                <span class="keyword">return</span> (String[])configurations.toArray(<span class="keyword">new</span> String[configurations.size()]);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException var6) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var6);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">..............</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AnnotationAttributes <span class="title">getAttributes</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">        String name = <span class="keyword">this</span>.getAnnotationClass().getName();</span><br><span class="line">        AnnotationAttributes attributes = AnnotationAttributes.fromMap(metadata.getAnnotationAttributes(name, <span class="keyword">true</span>));</span><br><span class="line">        Assert.notNull(attributes, <span class="string">"No auto-configuration attributes found. Is "</span> + metadata.getClassName() + <span class="string">" annotated with "</span> + ClassUtils.getShortName(name) + <span class="string">"?"</span>);</span><br><span class="line">        <span class="keyword">return</span> attributes;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; getAnnotationClass() &#123;</span><br><span class="line">        <span class="keyword">return</span> EnableAutoConfiguration<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());</span><br><span class="line">        Assert.notEmpty(configurations, <span class="string">"No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct."</span>);</span><br><span class="line">        <span class="keyword">return</span> configurations;</span><br><span class="line">    &#125;</span><br><span class="line">.........</span><br></pre></td></tr></table></figure>

<p>​        在 <code>selectImports</code> 方法中，<code>SpringFactoriesLoader.loadFactoryNames</code> 方法扫描所有具有<code>META-INF/spring.factories</code>的jar包。spring-boot-autoconfigure-x.x.x.x.jar里就有一个这样的spring.factories文件。</p>
<p>​    注意：在启动 动<code>loadFactoryNames（）</code>方法前，<code>SpringFactoriesLoader.loadFactoryNames</code>方法调用<code>loadSpringFactories</code>方法从所有的jar包中读取<code>META-INF/spring.factories</code>文件信息。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">loadFactories</span><span class="params">(Class&lt;T&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(factoryClass, <span class="string">"'factoryClass' must not be null"</span>);</span><br><span class="line">        ClassLoader classLoaderToUse = classLoader;</span><br><span class="line">        <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            classLoaderToUse = SpringFactoriesLoader<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        List&lt;String&gt; factoryNames = loadFactoryNames(factoryClass, classLoaderToUse);</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">"Loaded ["</span> + factoryClass.getName() + <span class="string">"] names: "</span> + factoryNames);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        List&lt;T&gt; result = <span class="keyword">new</span> ArrayList(factoryNames.size());</span><br><span class="line">        Iterator var5 = factoryNames.iterator();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">while</span>(var5.hasNext()) &#123;</span><br><span class="line">            String factoryName = (String)var5.next();</span><br><span class="line">            result.add(instantiateFactory(factoryName, factoryClass, classLoaderToUse));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        AnnotationAwareOrderComparator.sort(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>loadFactories</strong>会将加载到的<strong>jar</strong>中的类加载并保存，以提供<strong>loadFactoryNames</strong>中进行配置添加到执行序列 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        String factoryClassName = factoryClass.getName();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Enumeration&lt;URL&gt; urls = classLoader != <span class="keyword">null</span> ? classLoader.getResources(<span class="string">"META-INF/spring.factories"</span>) : ClassLoader.getSystemResources(<span class="string">"META-INF/spring.factories"</span>);</span><br><span class="line">            ArrayList result = <span class="keyword">new</span> ArrayList();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span class="line">                URL url = (URL)urls.nextElement();</span><br><span class="line">                Properties properties = PropertiesLoaderUtils.loadProperties(<span class="keyword">new</span> UrlResource(url));</span><br><span class="line">                String factoryClassNames = properties.getProperty(factoryClassName);</span><br><span class="line">                result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var8) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to load ["</span> + factoryClass.getName() + <span class="string">"] factories from location ["</span> + <span class="string">"META-INF/spring.factories"</span> + <span class="string">"]"</span>, var8);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这个<code>spring.factories</code>文件也是一组一组的<code>key=value</code>的形式，其中一个<code>key</code>是<code>EnableAutoConfiguration</code>类的全类名，而它的<code>value</code>是一个<code>xxxxAutoConfiguration</code>的类名的列表，这些类名以逗号分隔，如下图所示： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu120.png" width="90%">

<p>​     这个      <code>@EnableAutoConfiguration</code>注解通过<code>@SpringBootApplication</code>被间接的标记在了Spring Boot的启动类上。在 <code>SpringApplication.run(...)</code>的内部就会执行<code>selectImports()</code>方法，找到所有JavaConfig自动配置类的全限定名对应的class，然后将所有自动配置类加载到Spring容器中。</p>
<p>​    其中有一个key为   <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>的值定义了需要自动配置的bean，通过读取这个配置获取一组 <code>@Configuration</code>类。</p>
<p>​    注意：每个xxxAutoConfiguration都是一个基于java的bean配置类。实际上，这些<code>xxxAutoConfiguratio</code>不是所有都会被加载，会根据  <code>xxxAutoConfiguration</code>上的<code>@ConditionalOnClass</code>等条件判断是否加载。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">instantiateFactory</span><span class="params">(String instanceClassName, Class&lt;T&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; instanceClass = ClassUtils.forName(instanceClassName, classLoader);</span><br><span class="line">            <span class="keyword">if</span> (!factoryClass.isAssignableFrom(instanceClass)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Class ["</span> + instanceClassName + <span class="string">"] is not assignable to ["</span> + factoryClass.getName() + <span class="string">"]"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Constructor&lt;?&gt; constructor = instanceClass.getDeclaredConstructor();</span><br><span class="line">                ReflectionUtils.makeAccessible(constructor);</span><br><span class="line">                <span class="keyword">return</span> constructor.newInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to instantiate factory class: "</span> + factoryClass.getName(), var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> 如上代码段，通过反射机制将<strong>spring.factories</strong>中<strong>@Configuration</strong>类实例化为对应的<strong>java</strong>实列。到此我们已经知道怎么发现要自动配置的<strong>bean</strong>了，最后一步就是怎么样将这些<strong>bean</strong>加载到<strong>spring</strong>容器。 </p>
<h4 id="bean的加载"><a href="#bean的加载" class="headerlink" title="bean的加载"></a>bean的加载</h4><p>如果要让一个普通类交给Spring容器管理，通常有以下方法：</p>
<ol>
<li>使用 @Configuration与@Bean 注解</li>
<li>使用@Controller @Service @Repository @Component 注解标注该类，然后启用@ComponentScan自动扫描</li>
<li>使用@Import 方法</li>
</ol>
<p><strong>springboot</strong>中使用了<strong>@Import</strong> 方法</p>
<p><strong>@EnableAutoConfiguration</strong>注解中使用<code>@Import({AutoConfigurationImportSelector.class})</code>注解，<strong>AutoConfigurationImportSelector</strong>实现了<strong>DeferredImportSelector</strong>接口，</p>
<p><strong>DeferredImportSelector</strong>接口继承了<strong>ImportSelector</strong>接口，<strong>ImportSelector</strong>接口只有一个<strong>selectImports</strong>方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title">DeferredImportSelector</span></span>&#123;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">            <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(<span class="keyword">this</span>.beanClassLoader);</span><br><span class="line">            AnnotationAttributes attributes = <span class="keyword">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">            List configurations = <span class="keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">            configurations = <span class="keyword">this</span>.removeDuplicates(configurations);</span><br><span class="line">            Set exclusions = <span class="keyword">this</span>.getExclusions(annotationMetadata, attributes);</span><br><span class="line">            <span class="keyword">this</span>.checkExcludedClasses(configurations, exclusions);</span><br><span class="line">            configurations.removeAll(exclusions);</span><br><span class="line">            configurations = <span class="keyword">this</span>.filter(configurations, autoConfigurationMetadata);</span><br><span class="line">            <span class="keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">            <span class="keyword">return</span> StringUtils.toStringArray(configurations);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeferredImportSelector</span> <span class="keyword">extends</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> Class&lt;? extends DeferredImportSelector.Group&gt; getImportGroup() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Group</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    String[] selectImports(AnnotationMetadata var1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 我们先通过一个简单例子看看<strong>@Import</strong>注解是如何将<strong>bean</strong>导入到<strong>spring</strong>容器的。 </p>
<h5 id="新建一个bean"><a href="#新建一个bean" class="headerlink" title="新建一个bean"></a>新建一个bean</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSelecter</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"com.mmall.demo.model.User"</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="创建一个UserSelecter类继承ImportSelector接口并实现selectImports方法"><a href="#创建一个UserSelecter类继承ImportSelector接口并实现selectImports方法" class="headerlink" title="创建一个UserSelecter类继承ImportSelector接口并实现selectImports方法"></a>创建一个<strong>UserSelecter</strong>类继承<strong>ImportSelector</strong>接口并实现<strong>selectImports</strong>方法</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSelecter</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"com.mmall.demo.model.User"</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="创建ImportConfig类，使用-Configuration、-Import-ItpscSelector-class-注解。"><a href="#创建ImportConfig类，使用-Configuration、-Import-ItpscSelector-class-注解。" class="headerlink" title="创建ImportConfig类，使用@Configuration、@Import(ItpscSelector.class)注解。"></a>创建ImportConfig类，使用@Configuration、@Import(ItpscSelector.class)注解。</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import</span>(UserSelecter<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ImportConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="从容器获取bean"><a href="#从容器获取bean" class="headerlink" title="从容器获取bean"></a>从容器获取bean</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectImport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(ImportConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		String[] beanDefinitionNames = ctx.getBeanDefinitionNames();</span><br><span class="line">		<span class="keyword">for</span> (String name : beanDefinitionNames) &#123;</span><br><span class="line">			System.out.println(name);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">02</span>-<span class="number">01</span> <span class="number">12</span>:<span class="number">31</span>:<span class="number">59.283</span>  INFO <span class="number">17128</span> --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@<span class="number">6240651f</span>: startup date [Sat Feb <span class="number">01</span> <span class="number">12</span>:<span class="number">31</span>:<span class="number">59</span> CST <span class="number">2020</span>]; root of context hierarchy</span><br><span class="line">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalRequiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class="line">org.springframework.context.event.internalEventListenerProcessor</span><br><span class="line">org.springframework.context.event.internalEventListenerFactory</span><br><span class="line">importConfig</span><br><span class="line">com.mmall.demo.model.User</span><br><span class="line"><span class="number">2020</span>-<span class="number">02</span>-<span class="number">01</span> <span class="number">12</span>:<span class="number">31</span>:<span class="number">59.309</span>  INFO <span class="number">17128</span> --- [       Thread-<span class="number">2</span>] o.s.w.c.s.GenericWebApplicationContext   : Closing org.springframework.web.context.support.GenericWebApplicationContext@<span class="number">53</span>ce1329: startup date [Sat Feb <span class="number">01</span> <span class="number">12</span>:<span class="number">31</span>:<span class="number">55</span> CST <span class="number">2020</span>]; root of context hierarchy</span><br></pre></td></tr></table></figure>

<p>从结果可以看出：<strong>selectImports</strong>方法返回一组<strong>bean</strong>，<strong>@EnableAutoConfiguration</strong>注解借助<strong>@Import</strong>注解将这组<strong>bean</strong>注入到<strong>spring</strong>容器中，<strong>springboot</strong>正式通过这种机制来完成<strong>bean</strong>的注入的。 </p>
<p><strong>总结：</strong> </p>
<blockquote>
<p>Spring Boot启动的时候会通过@EnableAutoConfiguration注解找到META-INF/spring.factories配置文件中的所有自动配置类，并对其进行加载，而这些自动配置类都是以AutoConfiguration结尾来命名的，它实际上就是一个JavaConfig形式的Spring容器配置类，它能通过以Properties结尾命名的类中取得在全局配置文件中配置的属性如：server.port，而XxxxProperties类是通过@ConfigurationProperties注解与全局配置文件中对应的属性进行绑定的。</p>
</blockquote>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu121.png" width="90%">

<p>图片来自于王福强老师的博客：<a href="https://afoo.me/posts/2015-07-09-how-spring-boot-works.html" target="_blank" rel="noopener">https://afoo.me/posts/2015-07-09-how-spring-boot-works.html</a>  </p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot原理篇</category>
      </categories>
  </entry>
  <entry>
    <title>Activity-（六）流程定义部署ZIP方式</title>
    <url>/2020/03/13/Activity-%EF%BC%88%E5%85%AD%EF%BC%89%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89%E9%83%A8%E7%BD%B2ZIP%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p>通过Classpath的方式加载资源文件来部署流程定义，这种方式始终有局限性，只能适合小项目固定流程写死的。</p>
<p>实际项目的话，需要使用动态导入流程定义文件，可以通过bpmn和png文件打包成zip压缩包，</p>
<p>然后用户界面直接导入到系统，然后在解析部署流程定义，Activiti插件是支持这种方式的。</p>
<p>把bpmn流程文件和png流程图文件打成zip压缩包，</p>
<p>放到diagrams文件下（ 在真实的项目中是通过文件上传实现的）：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu112.png" width="60%">

<p>创建一个新的测试类ActivitHelloWorldZIPTest 其中新建一个deployWithZip()方法用zip方式来实现： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 部署流程定义使用zip方式</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deployWithZip</span><span class="params">()</span></span>&#123;</span><br><span class="line">      InputStream inputStream=<span class="keyword">this</span>.getClass()  <span class="comment">// 获取当前class对象</span></span><br><span class="line">                          .getClassLoader()   <span class="comment">// 获取类加载器</span></span><br><span class="line">                          .getResourceAsStream(<span class="string">"diagrams/MyProcess.zip"</span>); <span class="comment">// 获取指定文件资源流</span></span><br><span class="line">      ZipInputStream zipInputStream=<span class="keyword">new</span> ZipInputStream(inputStream); <span class="comment">// 实例化zip输入流对象</span></span><br><span class="line">      <span class="comment">// 获取部署对象</span></span><br><span class="line">      Deployment deployment=processEngine.getRepositoryService() <span class="comment">// 部署Service</span></span><br><span class="line">                   .createDeployment()  <span class="comment">// 创建部署</span></span><br><span class="line">                   .name(<span class="string">"HelloWorld流程2"</span>)  <span class="comment">// 流程名称</span></span><br><span class="line">                   .addZipInputStream(zipInputStream)  <span class="comment">// 添加zip是输入流</span></span><br><span class="line">                   .deploy(); <span class="comment">// 部署</span></span><br><span class="line">      System.out.println(<span class="string">"流程部署ID:"</span>+deployment.getId());</span><br><span class="line">      System.out.println(<span class="string">"流程部署Name:"</span>+deployment.getName());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如下： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">09:37:20.775 [main] DEBUG org.activiti.engine.impl.interceptor.LogInterceptor - --- DeployCmd finished --------------------------------------------------------</span><br><span class="line">09:37:20.775 [main] DEBUG org.activiti.engine.impl.interceptor.LogInterceptor - </span><br><span class="line"></span><br><span class="line">流程部署ID:2501</span><br><span class="line">流程部署Name:HelloWorld流程2</span><br></pre></td></tr></table></figure>

<p>已经成功部署流程定义了。</p>
<p>查询定义流程 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询定义流程</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findProcessDefinition</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//流程定义和部署相关的service</span></span><br><span class="line">		RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">		<span class="comment">//创建一个流程定义的查询</span></span><br><span class="line">		ProcessDefinitionQuery createProcessDefinitionQuery = repositoryService.createProcessDefinitionQuery();</span><br><span class="line">		<span class="comment">//createProcessDefinitionQuery.deploymentId(deploymentId)使用对象部署id查询</span></span><br><span class="line">		<span class="comment">//createProcessDefinitionQuery.processDefinitionId(processDefinitionId);使用流程定义的id查询</span></span><br><span class="line">		<span class="comment">//createProcessDefinitionQuery.processDefinitionKey(processDefinitionKey);使用流程定义的key查询</span></span><br><span class="line">		<span class="comment">//createProcessDefinitionQuery.processDefinitionNameLike(processDefinitionNameLike);使用流程定义的名称模糊查询</span></span><br><span class="line">		<span class="comment">//createProcessDefinitionQuery.processDefinitionKey(processDefinitionKey).list();返回一个集合</span></span><br><span class="line">		<span class="comment">//createProcessDefinitionQuery.processDefinitionId(processDefinitionId).singleResult();返回唯一结果集</span></span><br><span class="line">		ProcessDefinitionQuery desc = createProcessDefinitionQuery.orderByProcessDefinitionVersion().desc();</span><br><span class="line">		List&lt;ProcessDefinition&gt; list = desc.list();</span><br><span class="line">		<span class="keyword">if</span>(list!=<span class="keyword">null</span>&amp;&amp;list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ProcessDefinition ProcessDefinition:list)&#123;</span><br><span class="line">				System.out.println(<span class="string">"流程定义id"</span>+ProcessDefinition.getId());</span><br><span class="line">				System.out.println(<span class="string">"流程定义名称"</span>+ProcessDefinition.getName());</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>删除定义流程 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteProcessDefinition</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 不带级联删除</span></span><br><span class="line"><span class="comment">		 *  只能删除没有启动的流程 ，流程启动无法删除</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line"><span class="comment">//		processEngine.getRepositoryService().deleteDeployment("1");</span></span><br><span class="line">		<span class="comment">//可以删除任何流程 ，Id 取自 act_ge_bytearry 表的DEPLOYMENT_ID</span></span><br><span class="line">		processEngine.getRepositoryService().deleteDeployment(<span class="string">"2501"</span>,<span class="keyword">true</span>); </span><br><span class="line">		System.out.println(<span class="string">"ok"</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<p>之后仔细观察Activiti25张表中的一些数据变化：</p>
<ol>
<li>act_re_deployment 流程定义部署表</li>
<li>act_re_procdef 流程定义表</li>
<li>act_ge_bytearry 资源文件表</li>
<li>act_ge_property 属性表</li>
</ol>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>Java8-Lambda指南（二）Lambda 表达式</title>
    <url>/2020/03/12/Java8-Lambda%E6%8C%87%E5%8D%97%EF%BC%88%E4%BA%8C%EF%BC%89Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="Lambda-expressions"><a href="#Lambda-expressions" class="headerlink" title="Lambda expressions"></a>Lambda expressions</h2><p>让我们从一个简单的例子开始，先了解下在以前的Java版本中，是 如何对字符串列表进行排序的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">"peter"</span>, <span class="string">"anna"</span>, <span class="string">"mike"</span>, <span class="string">"xenia"</span>);</span><br><span class="line"></span><br><span class="line">Collections.sort(names, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String a, String b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.compareTo(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通用的静态方法 <strong>Collections.sort</strong> 可以接收一个列表和一个比较器，以便对给定列表中的元素进行排序。您经常发现自己创建了匿名比较器，并将它们传递给sort方法。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collections.sort(names, (String a, String b) -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> b.compareTo(a);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如你所见，代码更短，更容易阅读。但它变得更短: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collections.sort(names, (String a, String b) -&gt; b.compareTo(a));</span><br></pre></td></tr></table></figure>

<p>在只针对一个方法主体时，可以跳过大括号{}和return关键字 。此时可以看到它变得更短了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">names.sort((a, b) -&gt; b.compareTo(a));</span><br></pre></td></tr></table></figure>

<p>List现在有一个排序方法。 java编译器也知道参数类型，所以您也可以跳过它们。让我们更深入地研究lambda表达式如何在外部使用。 </p>
<p><strong>问题： 作为匿名方法的 new Comparator 怎么被省去的？</strong></p>
<p>​             <strong>(String a, String b) -&gt; b.compareTo(a) 中的 “- &gt; ”代表什么？</strong></p>
<p>原文链接： <a href="https://github.com/winterbe/java8-tutorial" target="_blank" rel="noopener">Modern Java - A Guide to Java 8 </a> </p>
<p>翻译： <a href="http://wushaopei.com/">http://wushaopei.com/</a> - <a href="http://wushaopei.com/">吴少培</a></p>
<p>译文链接： <a href="http://www.wushaopei/8554.html" target="_blank" rel="noopener">http://www.wushaopei/8554.html</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>java 8 新特性</category>
      </categories>
  </entry>
  <entry>
    <title>Java8:Lambda指南（一）接口的默认方法</title>
    <url>/2020/03/12/Java8-Lambda%E6%8C%87%E5%8D%97%EF%BC%88%E4%B8%80%EF%BC%89%E6%8E%A5%E5%8F%A3%E7%9A%84%E9%BB%98%E8%AE%A4%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>Java 8允许我们利用<strong>default关键字向接口添加非抽象方法实现</strong>。这个特性也称为<strong>虚拟扩展方法</strong>（ <a href="http://stackoverflow.com/a/24102730" target="_blank" rel="noopener">virtual extension methods</a>）。 </p>
<p>这是我们的第一个例子：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Formula</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">double</span> <span class="title">sqrt</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.sqrt(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了抽象方法计算外，接口公式还定义了默认方法sqrt。 具体类只需实现抽象方法计算。 默认方法sqrt可以开箱即用。 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Formula formula = <span class="keyword">new</span> Formula() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqrt(a * <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">formula.calculate(<span class="number">100</span>);     <span class="comment">// 100.0</span></span><br><span class="line">formula.sqrt(<span class="number">16</span>);           <span class="comment">// 4.0</span></span><br></pre></td></tr></table></figure>

<p>该公式被实现为一个匿名object。它的代码是相当冗长的：这样简单的一个 sqrt(a * 100)计算需要 6行代码。我们将会在下一节看到，在Java 8中有一种更好的实现单个方法对象的方法。 </p>
<p>原文链接： <a href="https://github.com/winterbe/java8-tutorial" target="_blank" rel="noopener">Modern Java - A Guide to Java 8 </a> </p>
<p>翻译： <a href="http://wushaopei.com/">http://wushaopei.com/</a> - <a href="http://wushaopei.com/">吴少培</a></p>
<p>译文链接： <a href="http://www.wushaopei/8554.html" target="_blank" rel="noopener">http://www.wushaopei/8554.html</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>java 8 新特性</category>
      </categories>
  </entry>
  <entry>
    <title>mybatis-知识树目录</title>
    <url>/2020/03/12/mybatis-%E7%9F%A5%E8%AF%86%E6%A0%91%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<p>[TOC]</p>
<h2 id="MyBatis简介"><a href="#MyBatis简介" class="headerlink" title="MyBatis简介"></a>MyBatis简介</h2><h3 id="传统的JDBC编程"><a href="#传统的JDBC编程" class="headerlink" title="传统的JDBC编程"></a>传统的JDBC编程</h3><h3 id="ORM模型"><a href="#ORM模型" class="headerlink" title="ORM模型"></a>ORM模型</h3><h3 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h3><h3 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h3><h3 id="什么时候用MyBatis"><a href="#什么时候用MyBatis" class="headerlink" title="什么时候用MyBatis"></a>什么时候用MyBatis</h3><h2 id="MyBatis-入门"><a href="#MyBatis-入门" class="headerlink" title="MyBatis 入门"></a>MyBatis 入门</h2><h3 id="开发环境准备"><a href="#开发环境准备" class="headerlink" title="开发环境准备"></a>开发环境准备</h3><h4 id="下载MyBatis"><a href="#下载MyBatis" class="headerlink" title="下载MyBatis"></a>下载MyBatis</h4><h4 id="搭建开发环境"><a href="#搭建开发环境" class="headerlink" title="搭建开发环境"></a>搭建开发环境</h4><h3 id="MyBatis的基本构成"><a href="#MyBatis的基本构成" class="headerlink" title="MyBatis的基本构成"></a>MyBatis的基本构成</h3><h4 id="构建SqlSessionFactory"><a href="#构建SqlSessionFactory" class="headerlink" title="构建SqlSessionFactory"></a>构建SqlSessionFactory</h4><h4 id="创建SqlSession"><a href="#创建SqlSession" class="headerlink" title="创建SqlSession"></a>创建SqlSession</h4><h4 id="映射器"><a href="#映射器" class="headerlink" title="映射器"></a>映射器</h4><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><h4 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h4><h4 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h4><h4 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h4><h4 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h4><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><h4 id="property子元素"><a href="#property子元素" class="headerlink" title="property子元素"></a>property子元素</h4><h4 id="properties配置文件"><a href="#properties配置文件" class="headerlink" title="properties配置文件"></a>properties配置文件</h4><h4 id="程序参数传递"><a href="#程序参数传递" class="headerlink" title="程序参数传递"></a>程序参数传递</h4><h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><h4 id="系统定义别名"><a href="#系统定义别名" class="headerlink" title="系统定义别名"></a>系统定义别名</h4><h4 id="自定义别名"><a href="#自定义别名" class="headerlink" title="自定义别名"></a>自定义别名</h4><h3 id="typeHandler类型处理器"><a href="#typeHandler类型处理器" class="headerlink" title="typeHandler类型处理器"></a>typeHandler类型处理器</h3><h4 id="系统定义的typeHandler"><a href="#系统定义的typeHandler" class="headerlink" title="系统定义的typeHandler"></a>系统定义的typeHandler</h4><h4 id="自定义typeHandler"><a href="#自定义typeHandler" class="headerlink" title="自定义typeHandler"></a>自定义typeHandler</h4><h4 id="枚举类型typeHandler"><a href="#枚举类型typeHandler" class="headerlink" title="枚举类型typeHandler"></a>枚举类型typeHandler</h4><h3 id="ObjectFactory"><a href="#ObjectFactory" class="headerlink" title="ObjectFactory"></a>ObjectFactory</h3><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><h3 id="environments-配置环境"><a href="#environments-配置环境" class="headerlink" title="environments 配置环境"></a>environments 配置环境</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><h4 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h4><h4 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h4><h3 id="databaseIdProvider数据库厂商标识"><a href="#databaseIdProvider数据库厂商标识" class="headerlink" title="databaseIdProvider数据库厂商标识"></a>databaseIdProvider数据库厂商标识</h3><h4 id="使用系统默认规则"><a href="#使用系统默认规则" class="headerlink" title="使用系统默认规则"></a>使用系统默认规则</h4><h4 id="不使用系统默认规则"><a href="#不使用系统默认规则" class="headerlink" title="不使用系统默认规则"></a>不使用系统默认规则</h4><h3 id="引入映射器的方法"><a href="#引入映射器的方法" class="headerlink" title="引入映射器的方法"></a>引入映射器的方法</h3><h2 id="映射器-1"><a href="#映射器-1" class="headerlink" title="映射器"></a>映射器</h2><h3 id="映射器的主要元素"><a href="#映射器的主要元素" class="headerlink" title="映射器的主要元素"></a>映射器的主要元素</h3><h3 id="select-元素"><a href="#select-元素" class="headerlink" title="select 元素"></a>select 元素</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><h4 id="简易数据类型的例子"><a href="#简易数据类型的例子" class="headerlink" title="简易数据类型的例子"></a>简易数据类型的例子</h4><h4 id="自动映射"><a href="#自动映射" class="headerlink" title="自动映射"></a>自动映射</h4><h4 id="传递多个参数"><a href="#传递多个参数" class="headerlink" title="传递多个参数"></a>传递多个参数</h4><h4 id="使用resultMap映射结果集"><a href="#使用resultMap映射结果集" class="headerlink" title="使用resultMap映射结果集"></a>使用resultMap映射结果集</h4><h3 id="insert元素"><a href="#insert元素" class="headerlink" title="insert元素"></a>insert元素</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><h4 id="主键回填和自定义"><a href="#主键回填和自定义" class="headerlink" title="主键回填和自定义"></a>主键回填和自定义</h4><h3 id="update元素和-delete元素"><a href="#update元素和-delete元素" class="headerlink" title="update元素和 delete元素"></a>update元素和 delete元素</h3><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><h4 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h4><h4 id="存储过程支持"><a href="#存储过程支持" class="headerlink" title="存储过程支持"></a>存储过程支持</h4><h4 id="特殊字符串替换和处理"><a href="#特殊字符串替换和处理" class="headerlink" title="特殊字符串替换和处理"></a>特殊字符串替换和处理</h4><h3 id="sql元素"><a href="#sql元素" class="headerlink" title="sql元素"></a>sql元素</h3><h3 id="resultMap结果映射集"><a href="#resultMap结果映射集" class="headerlink" title="resultMap结果映射集"></a>resultMap结果映射集</h3><h4 id="resultMap元素的构成"><a href="#resultMap元素的构成" class="headerlink" title="resultMap元素的构成"></a>resultMap元素的构成</h4><h4 id="使用map存储结果集"><a href="#使用map存储结果集" class="headerlink" title="使用map存储结果集"></a>使用map存储结果集</h4><h4 id="使用POJO存储结果集"><a href="#使用POJO存储结果集" class="headerlink" title="使用POJO存储结果集"></a>使用POJO存储结果集</h4><h4 id="级联"><a href="#级联" class="headerlink" title="级联"></a>级联</h4><h3 id="缓存cache"><a href="#缓存cache" class="headerlink" title="缓存cache"></a>缓存cache</h3><h4 id="系统缓存（一级缓存和二级缓存）"><a href="#系统缓存（一级缓存和二级缓存）" class="headerlink" title="系统缓存（一级缓存和二级缓存）"></a>系统缓存（一级缓存和二级缓存）</h4><h4 id="自定义缓存"><a href="#自定义缓存" class="headerlink" title="自定义缓存"></a>自定义缓存</h4>]]></content>
      <categories>
        <category>mybatis</category>
      </categories>
  </entry>
  <entry>
    <title>mybatis 简介（一）传统的JDBC编程的不足</title>
    <url>/2020/03/12/mybatis%20%E7%AE%80%E4%BB%8B%EF%BC%88%E4%B8%80%EF%BC%89%E4%BC%A0%E7%BB%9F%E7%9A%84JDBC%E7%BC%96%E7%A8%8B%E7%9A%84%E4%B8%8D%E8%B6%B3/</url>
    <content><![CDATA[<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>mybatis</category>
      </categories>
      <tags>
        <tag>简介 mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>Activity-（五）HelloWorld实现</title>
    <url>/2020/03/11/Activity-%EF%BC%88%E4%BA%94%EF%BC%89HelloWorld%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h3 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h3><p>做一个最简单的HellWorld流程用代码的方式实现并且走完流程。 </p>
<h3 id="以下是涉及到的比较重要的八张表"><a href="#以下是涉及到的比较重要的八张表" class="headerlink" title="以下是涉及到的比较重要的八张表"></a>以下是涉及到的比较重要的八张表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_re_deployment;   <span class="comment">-- 一 流程部署表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_ge_bytearray;    <span class="comment">-- 二 流程二进制表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_re_procdef;      <span class="comment">-- 三 流程定义表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_ru_execution;    <span class="comment">-- 四 流程正在运行表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_hi_procinst;     <span class="comment">-- 五 流程实例历史表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_ru_task;         <span class="comment">-- 六 流程当前任务表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_hi_taskinst;     <span class="comment">-- 七 流程历史任务表</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> act_hi_actinst;      <span class="comment">-- 八 流程历史活动节点表</span></span><br></pre></td></tr></table></figure>

<h3 id="相关步骤如下："><a href="#相关步骤如下：" class="headerlink" title="相关步骤如下："></a>相关步骤如下：</h3><blockquote>
<p>1.首先是需要部署流程定义。</p>
<p>2.启动流程实例。</p>
<p>3.查看流程任务以及完成流程任务。</p>
</blockquote>
<h3 id="先决工作，成员变量定义"><a href="#先决工作，成员变量定义" class="headerlink" title="先决工作，成员变量定义"></a>先决工作，成员变量定义</h3><ol>
<li>获取流程实例引擎<strong>ProcessEngines</strong>；</li>
<li>获取<strong>RepositoryService</strong>;</li>
<li>获取<strong>RuntimeService</strong>;</li>
<li>获取<strong>TaskService</strong>;</li>
<li>获取<strong>HistoryService</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取默认的流程引擎实例 会自动读取activiti.cfg.xml文件 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个成员变量</span></span><br><span class="line">   RepositoryService repositoryService;</span><br><span class="line">   </span><br><span class="line">   RuntimeService runtimeService;</span><br><span class="line">   </span><br><span class="line">   TaskService taskService;</span><br><span class="line">   </span><br><span class="line">   HistoryService historyService;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取流程引擎</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">       repositoryService = processEngine.getRepositoryService();</span><br><span class="line">       runtimeService = processEngine.getRuntimeService();</span><br><span class="line">       taskService = processEngine.getTaskService();</span><br><span class="line">       historyService = processEngine.getHistoryService();</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="部署流程定义图："><a href="#部署流程定义图：" class="headerlink" title="部署流程定义图："></a>部署流程定义图：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 部署流程定义</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deploy</span><span class="params">()</span></span>&#123;</span><br><span class="line">	    <span class="comment">// 获取部署对象</span></span><br><span class="line">	    Deployment deployment=processEngine.getRepositoryService() <span class="comment">// 部署Service</span></span><br><span class="line">	                 .createDeployment()  <span class="comment">// 创建部署</span></span><br><span class="line">	                 .addClasspathResource(<span class="string">"diagrams/MyProcess.bpmn"</span>)  <span class="comment">// 加载资源文件</span></span><br><span class="line"><span class="comment">//	                 .addClasspathResource("diagrams/helloWorld.png")   // 加载资源文件</span></span><br><span class="line"><span class="comment">//	                 .name("HelloWorld流程")  // 流程名称</span></span><br><span class="line">	                 .deploy(); <span class="comment">// 部署</span></span><br><span class="line">	    System.out.println(<span class="string">"流程部署ID:"</span>+deployment.getId());</span><br><span class="line">	    System.out.println(<span class="string">"流程部署Name:"</span>+deployment.getName());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">流程部署ID:17501</span><br><span class="line">流程部署Name:null</span><br></pre></td></tr></table></figure>



<h3 id="接着启动流程实例，这样一个流程才开始："><a href="#接着启动流程实例，这样一个流程才开始：" class="headerlink" title="接着启动流程实例，这样一个流程才开始："></a>接着启动流程实例，这样一个流程才开始：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 启动流程</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startProcess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class="string">"myProcess"</span>);</span><br><span class="line">       String processInstanceId = processInstance.getId();</span><br><span class="line">       String activityId = processInstance.getActivityId();</span><br><span class="line">       String definitionId = processInstance.getProcessDefinitionId();</span><br><span class="line">       </span><br><span class="line">       System.out.println(<span class="string">"流程实例ID："</span>+processInstanceId);</span><br><span class="line">       System.out.println(<span class="string">"正在活动的节点ID："</span>+activityId);</span><br><span class="line">       System.out.println(<span class="string">"流程定义ID："</span>+definitionId);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">流程实例ID：20001</span><br><span class="line">正在活动的节点ID：usertask1</span><br><span class="line">流程定义ID：myProcess:2:17504</span><br></pre></td></tr></table></figure>



<h3 id="查询正在运行的实例："><a href="#查询正在运行的实例：" class="headerlink" title="查询正在运行的实例："></a>查询正在运行的实例：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询正在运行的实例</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryExecution</span><span class="params">()</span></span>&#123;</span><br><span class="line">       List&lt;Execution&gt; executionList = runtimeService.createExecutionQuery()  <span class="comment">//创建正在执行的流程查询对象</span></span><br><span class="line">                     .processDefinitionKey(<span class="string">"myProcess"</span>)   <span class="comment">//根据流程定义的key查询</span></span><br><span class="line">                     .orderByProcessInstanceId()  <span class="comment">//根据流程实例id排序</span></span><br><span class="line">                     .desc()  <span class="comment">//倒序</span></span><br><span class="line">                     .list();  <span class="comment">//查询出集合</span></span><br><span class="line">       <span class="keyword">for</span>(Execution execution: executionList)&#123;</span><br><span class="line">           System.out.println(<span class="string">"正在执行的流程对象的id: "</span>+execution.getId());</span><br><span class="line">           System.out.println(<span class="string">"所属流程实例的id:"</span>+execution.getProcessInstanceId());</span><br><span class="line">           System.out.println(<span class="string">"正在活动的节点的id: "</span>+execution.getActivityId());</span><br><span class="line">           System.out.println(<span class="string">"任务名称: "</span>+execution.getName());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">正在执行的流程对象的id: 20001</span><br><span class="line">所属流程实例的id:20001</span><br><span class="line">正在活动的节点的id: usertask1</span><br><span class="line">任务名称: null</span><br></pre></td></tr></table></figure>



<h3 id="查看一下白夜行这个用户的任务信息："><a href="#查看一下白夜行这个用户的任务信息：" class="headerlink" title="查看一下白夜行这个用户的任务信息："></a>查看一下白夜行这个用户的任务信息：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据办理人查询任务</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryTaskByAssignee</span><span class="params">()</span></span>&#123;</span><br><span class="line">       String assignee = <span class="string">"白夜行"</span>;    <span class="comment">// assignee 要与流程图上的 Assignee 相同才会被查询到，否则就不返回该任务对象</span></span><br><span class="line">       <span class="comment">// 查询并且返回任务即可</span></span><br><span class="line">       List&lt;Task&gt; taskList = taskService.createTaskQuery()  <span class="comment">// 任务相关Service // 创建任务查询</span></span><br><span class="line">                                    .processDefinitionKey(<span class="string">"myProcess"</span>)</span><br><span class="line">                                    .taskAssignee(assignee)<span class="comment">// 指定某个人</span></span><br><span class="line">                                    .orderByTaskCreateTime()</span><br><span class="line">                                    .desc()</span><br><span class="line">                                    .list();</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span>(Task task: taskList)&#123;</span><br><span class="line">        System.out.println(<span class="string">"任务ID:"</span>+task.getId());</span><br><span class="line">        System.out.println(<span class="string">"任务名称："</span>+task.getName());</span><br><span class="line">        System.out.println(<span class="string">"任务创建时间："</span>+task.getCreateTime());</span><br><span class="line">        System.out.println(<span class="string">"任务委派人："</span>+task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">"流程实例ID:"</span>+task.getProcessInstanceId());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">任务ID:20004</span><br><span class="line">任务名称：myprocess</span><br><span class="line">任务创建时间：Thu Mar 12 10:02:57 CST 2020</span><br><span class="line">任务委派人：白夜行</span><br><span class="line">流程实例ID:20001</span><br></pre></td></tr></table></figure>

<h3 id="查询当前流程实例状态"><a href="#查询当前流程实例状态" class="headerlink" title="查询当前流程实例状态"></a>查询当前流程实例状态</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询当前流程实例状态</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryProInstanceStateByProInstanceId</span><span class="params">()</span></span>&#123;</span><br><span class="line">       ProcessInstance processInstance = runtimeService.createProcessInstanceQuery().processInstanceId(<span class="string">"12501"</span>).singleResult();</span><br><span class="line">       <span class="keyword">if</span>(processInstance == <span class="keyword">null</span>)&#123;</span><br><span class="line">           System.out.println(<span class="string">"当前流程已经完成"</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           System.out.println(<span class="string">"当前流程实例ID："</span>+processInstance.getId());</span><br><span class="line">           System.out.println(<span class="string">"当前流程所处的位置："</span>+processInstance.getActivityId());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当前流程实例ID：20001</span><br><span class="line">当前流程所处的位置：usertask1</span><br></pre></td></tr></table></figure>

<h3 id="最后完成HelloWorld节点任务，把流程走完："><a href="#最后完成HelloWorld节点任务，把流程走完：" class="headerlink" title="最后完成HelloWorld节点任务，把流程走完："></a>最后完成HelloWorld节点任务，把流程走完：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completeTask</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	TaskQuery query = taskService.createTaskQuery();			<span class="comment">//创建任务查询对象</span></span><br><span class="line">	List&lt;Task&gt; list = query.processDefinitionKey(<span class="string">"myProcess"</span>)	<span class="comment">//指定流程定义</span></span><br><span class="line">						   .taskAssignee(<span class="string">"白夜行"</span>)				<span class="comment">//指定委托人</span></span><br><span class="line">						   .list();								<span class="comment">//执行查询</span></span><br><span class="line">	<span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">		System.out.println(task);</span><br><span class="line">		<span class="comment">//taskService某些框架下需要使用@Autowired注解装配</span></span><br><span class="line">		taskService.complete(task.getId());						<span class="comment">//完成任务，使任务进入下一步</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询流程实例历史"><a href="#查询流程实例历史" class="headerlink" title="查询流程实例历史"></a>查询流程实例历史</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询流程实例历史</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryHistory</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//1.创建流程实例的历史查询对象，historyService使用@Autowired注解注入</span></span><br><span class="line">	HistoricProcessInstanceQuery query = historyService.createHistoricProcessInstanceQuery();</span><br><span class="line">	HistoricProcessInstance instance = </span><br><span class="line">			query</span><br><span class="line">				.processInstanceId(<span class="string">"12501"</span>)	<span class="comment">//流程实例的id</span></span><br><span class="line">				.finished()					<span class="comment">//调用这个方法后未完成的流程实例会返回null</span></span><br><span class="line">				.singleResult();</span><br><span class="line">	System.out.println(instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    这里引出一个概念，流程定义和流程实例的关系，可以把这两种关系理解成是类和对象的关系。 </p>
<p>​    流程定义是一个模板，而流程实例就是通过模板演变出来的具体的可用的东西。</p>
<p>首先当运行：deploy()部署流程定义方法，在数据库中流程定义表会发生一些变化新增了一条数据，</p>
<p><strong>act_re_deployment</strong>流程定义部署表：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu106.png" width="60%">

<p>然后<strong>act_re_prodef</strong>流程定义表也会有一条数据插入： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu107.png" width="60%">

<p>以及在<strong>act_ge_bytearray</strong>表中用来存储资源信息： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu108.png" width="60%">

<p>接着来运行<strong>start()</strong>启动流程实例：</p>
<p><strong>act_ru_task</strong>运行时流程任务表新增了一条数据：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu109.png" width="60%">

<p><strong>act_ru_execution</strong> 运行时流程执行表： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu111.png" width="60%">

<p><strong>act_ru_identitulink</strong>是用于执行主体相关信息表： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu110.png" width="60%">

<p>可以查看刚刚”<strong>白夜行</strong>”这个用户的任务：</p>
<p>运行findTask()查看用户任务，控制台输出如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">任务ID:<span class="number">20004</span></span><br><span class="line">任务名称：myprocess</span><br><span class="line">任务创建时间：Thu Mar <span class="number">12</span> <span class="number">10</span>:<span class="number">02</span>:<span class="number">57</span> CST <span class="number">2020</span></span><br><span class="line">任务委派人：白夜行</span><br><span class="line">流程实例ID:<span class="number">20001</span></span><br></pre></td></tr></table></figure>

<p><strong>completeTask()</strong>方法完成任务：</p>
<p>然后数据库中<strong>ru</strong>开头的运行时候所有表的数据都没了，因为现在流程结束，不需要这些数据了。</p>
<p>在hi开头的表里，会新增不少数据，这些数据主要是用来归档查询用的，也就是历史数据。</p>
<p><strong>act_hi_taskinst</strong> 历史流程实例任务表加了一条任务数据；</p>
<p><strong>act_hi_procinst</strong> 历史流程实例实例表加了一条流程实例相关信息的数据（包括开始时间，结束时间等等信息）；</p>
<p><strong>act_hi_identitylink</strong> 历史流程实例参数者的表加了一条数据；</p>
<p><strong>act_hi_actinst</strong> 历史活动节点表加了三条流程活动节点信息的数据（每个流程实例具体的执行活动节点的信息）；</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>jdbc(三)预编译-Statement、PreparedStatement</title>
    <url>/2020/03/10/jdbc(%E4%B8%89)%E9%A2%84%E7%BC%96%E8%AF%91-Statement%E3%80%81PreparedStatement/</url>
    <content><![CDATA[<h2 id="预编译：statement-与-PreparedStatement"><a href="#预编译：statement-与-PreparedStatement" class="headerlink" title="预编译：statement 与 PreparedStatement"></a>预编译：statement 与 PreparedStatement</h2><h3 id="sql提供访问的接口："><a href="#sql提供访问的接口：" class="headerlink" title="sql提供访问的接口："></a><strong>sql提供访问的接口：</strong></h3><ul>
<li>数据库连接被用于向数据库服务器发送命令和 SQL 语句，在连接建立后，需要对数据库进行访问，执行 sql 语句</li>
<li>在 java.sql 包中有 3 个接口分别定义了对数据库的调用的不同方式：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">|-----   Statement</span><br><span class="line"> </span><br><span class="line">       |------PreparedStatement</span><br><span class="line"> </span><br><span class="line">              |------CallableStatement</span><br></pre></td></tr></table></figure>

<p>使用<span style="color:red;">statement</span>进行预编译可能会导致SQL注入的发生 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu92.png" width="60%">

<h3 id="SQL-注入攻击"><a href="#SQL-注入攻击" class="headerlink" title="SQL 注入攻击"></a><strong>SQL 注入攻击</strong></h3><ul>
<li>SQL 注入是利用某些系统没有对用户输入的数据进行充分的检查，而在用户输入数据中注入非法的 SQL 语句段或命令(如：SELECT user, password FROM user_table WHERE user=’a’ OR 1 = ‘ AND password = ‘ OR ‘1’ = ‘1’) ，从而利用系统的 SQL 引擎完成恶意行为的做法</li>
<li>对于 Java 而言，要防范 SQL 注入，只要用 PreparedStatement(从Statement扩展而来) 取代 Statement 就可以了</li>
</ul>
<h3 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a><strong>PreparedStatement</strong></h3><ul>
<li>可以通过调用 Connection 对象的 preparedStatement() 方法获取 PreparedStatement 对象</li>
<li>PreparedStatement 接口是 Statement 的子接口，它表示一条预编译过的 SQL 语句</li>
<li>PreparedStatement 对象所代表的 SQL 语句中的参数用问号(?)来表示，调用 PreparedStatement 对象的 setXxx() 方法来设置这些参数. setXxx() 方法有两个参数，第一个参数是要设置的 SQL 语句中的参数的索引(从 1 开始)，第二个是设置的 SQL 语句中的参数的值</li>
</ul>
<h3 id="PreparedStatement-vs-Statement"><a href="#PreparedStatement-vs-Statement" class="headerlink" title="PreparedStatement vs Statement"></a><strong>PreparedStatement vs Statement</strong></h3><ul>
<li>代码的可读性和可维护性.</li>
<li>PreparedStatement 能最大可能提高性能：</li>
</ul>
<blockquote>
<ol>
<li>DBServer会对预编译语句提供性能优化。因为预编译语句有可能被重复调用，所以语句在被DBServer的编译器编译后的执行代码被缓存下来，那么下次调用时只要是相同的预编译语句就不需要编译，只要将参数直接传入编译过的语句执行代码中就会得到执行。</li>
<li>在statement语句中,即使是相同操作但因为数据内容不一样,所以整个语句本身不能匹配,没有缓存语句的意义.事实是没有数据库会对普通语句编译后的执行代码缓存.这样每执行一次都要对传入的语句编译一次.  </li>
<li>(语法检查，语义检查，翻译成二进制命令，缓存)</li>
</ol>
</blockquote>
<ul>
<li>PreparedStatement 可以防止 SQL 注入防止 SQL 注入 </li>
</ul>
<h3 id="数据类型转换表"><a href="#数据类型转换表" class="headerlink" title="数据类型转换表"></a><strong>数据类型转换表</strong></h3><table>
<thead>
<tr>
<th>java类型</th>
<th>SQL类型</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>BIT</td>
</tr>
<tr>
<td>byte</td>
<td>TINYINT</td>
</tr>
<tr>
<td>short</td>
<td>SMALLINT</td>
</tr>
<tr>
<td>int</td>
<td>INTEGER</td>
</tr>
<tr>
<td>long</td>
<td>BIGINT</td>
</tr>
<tr>
<td>String</td>
<td>CHAR,VARCHAR,LONGVARCHAR</td>
</tr>
<tr>
<td>byte array</td>
<td>BINARY , VAR  BINARY</td>
</tr>
<tr>
<td>java.sql.Date</td>
<td>DATE</td>
</tr>
<tr>
<td>java.sql.Time</td>
<td>TIME</td>
</tr>
<tr>
<td>java.sql.Timestamp</td>
<td>TIMESTAMP</td>
</tr>
</tbody></table>
<h3 id="连接数据库、操作表的步骤："><a href="#连接数据库、操作表的步骤：" class="headerlink" title="连接数据库、操作表的步骤："></a><strong>连接数据库、操作表的步骤：</strong></h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu93.png" width="60%">

<p><strong>注意：</strong></p>
<ul>
<li>释放ResultSet, Statement,Connection。</li>
<li>数据库连接（Connection）是非常稀有的资源，用完后必须马上释放，如果Connection不能及时正确的关闭将导致系统宕机。Connection的使用原则是<span style="color:red;">尽量晚创建，尽量早的释放。</span></li>
</ul>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>jdbc</category>
      </categories>
      <tags>
        <tag>数据库连接</tag>
      </tags>
  </entry>
  <entry>
    <title>jdbc(五)普通增删改查、通用增删改查</title>
    <url>/2020/03/10/jdbc(%E4%BA%94)%E6%99%AE%E9%80%9A%E5%A2%9E%E5%88%A0%E6%94%B9%E3%80%81%E9%80%9A%E7%94%A8%E5%A2%9E%E5%88%A0%E6%94%B9/</url>
    <content><![CDATA[<h3 id="普通的增删查改"><a href="#普通的增删查改" class="headerlink" title="普通的增删查改"></a>普通的增删查改</h3><h4 id="创建一个类customer"><a href="#创建一个类customer" class="headerlink" title="创建一个类customer"></a>创建一个类customer</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(<span class="keyword">int</span> id, String name, String email, Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建jdbc连接，并封装为方法"><a href="#创建jdbc连接，并封装为方法" class="headerlink" title="创建jdbc连接，并封装为方法"></a><strong>创建jdbc连接，并封装为方法</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*	 * 获取数据库的连接</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 数据库的连接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		InputStream is = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			is = JDBCUtils.class.getClassLoader().getResourceAsStream("sqlDriver.properties");</span><br><span class="line">			Properties ps = <span class="keyword">new</span> Properties();</span><br><span class="line">			ps.load(is);</span><br><span class="line">			String user = ps.getProperty(<span class="string">"user"</span>);</span><br><span class="line">			String password = ps.getProperty(<span class="string">"password"</span>);</span><br><span class="line">			String driverClass = ps.getProperty(<span class="string">"driverClass"</span>);</span><br><span class="line">			String url = ps.getProperty(<span class="string">"url"</span>);</span><br><span class="line"> </span><br><span class="line">			<span class="comment">// 创建Driver对象</span></span><br><span class="line">			Class clazz = Class.forName(driverClass);</span><br><span class="line">			Object obj = clazz.newInstance();</span><br><span class="line">			Driver driver = (Driver) obj;</span><br><span class="line">			<span class="comment">// 注册驱动</span></span><br><span class="line">			DriverManager.registerDriver(driver);</span><br><span class="line">			connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					is.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">return</span> connection;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在操作完成后要进行连接的关闭"><a href="#在操作完成后要进行连接的关闭" class="headerlink" title="在操作完成后要进行连接的关闭"></a><strong>在操作完成后要进行连接的关闭</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection connection, PreparedStatement ps)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			connection.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (ps != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ps.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection connection, PreparedStatement ps, ResultSet rs)</span> </span>&#123;</span><br><span class="line">	close(connection,ps);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(rs != <span class="keyword">null</span>)&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			rs.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="增删查改操作"><a href="#增删查改操作" class="headerlink" title="增删查改操作"></a><strong>增删查改操作</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 对数据库的  增 ，删，改，查</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CRUDTest</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 从数据库中查找一条数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> </span><br><span class="line">		Customer customer = getCustomerById();</span><br><span class="line">		System.out.println(customer);</span><br><span class="line">		</span><br><span class="line">		List&lt;Customer&gt; customers = getCustomers();</span><br><span class="line">		<span class="keyword">for</span> (Customer customer2 : customers) &#123;</span><br><span class="line">			System.out.println(customer2);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 查询多条数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">getCustomers</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 1.获取数据库的连接</span></span><br><span class="line">		Connection connection = JDBCUtils.getConnection();</span><br><span class="line"> </span><br><span class="line">		String sql = <span class="string">"select * from customers"</span>;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 2.预编译  -- 如果没有占位符可以不填充数据</span></span><br><span class="line">		PreparedStatement ps = connection.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 4.执行sql语句</span></span><br><span class="line">		ResultSet rs = ps.executeQuery(); <span class="comment">// 查找的结果都已经放到ResultSet中了</span></span><br><span class="line"> </span><br><span class="line">		List&lt;Customer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">			<span class="comment">//获取数据</span></span><br><span class="line">			<span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">			String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">			String email = rs.getString(<span class="string">"email"</span>);</span><br><span class="line">			Date birth = rs.getDate(<span class="string">"birth"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//将每条数据放入集合中</span></span><br><span class="line">			list.add(<span class="keyword">new</span> Customer(id, name, email, birth));</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 6.关闭资源</span></span><br><span class="line">		JDBCUtils.close(connection, ps, rs);</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 查询一条数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomerById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 1.获取数据库的连接</span></span><br><span class="line">		Connection connection = JDBCUtils.getConnection();</span><br><span class="line"> </span><br><span class="line">		String sql = <span class="string">"select * from customers where id = ?"</span>;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 2.预编译</span></span><br><span class="line">		PreparedStatement ps = connection.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 3.填充数据</span></span><br><span class="line">		ps.setInt(<span class="number">1</span>, <span class="number">20</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 4.执行sql语句</span></span><br><span class="line">		ResultSet rs = ps.executeQuery(); <span class="comment">// 查找的结果都已经放到ResultSet中了</span></span><br><span class="line"> </span><br><span class="line">		Customer customer = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 5.取数据</span></span><br><span class="line">		<span class="keyword">if</span> (rs.next()) &#123; <span class="comment">// 如果有数据就返回true,否则返回false</span></span><br><span class="line">			<span class="comment">// 获取列上值的第一种方式</span></span><br><span class="line">			<span class="comment">// int id = rs.getInt(1); //根据列的索引获取对应的列上的值</span></span><br><span class="line">			<span class="comment">// String name = rs.getString(2);</span></span><br><span class="line">			<span class="comment">// String email = rs.getString(3);</span></span><br><span class="line">			<span class="comment">// Date date = rs.getDate(4);</span></span><br><span class="line"> </span><br><span class="line">			<span class="comment">// 获取列上值的第二种方式</span></span><br><span class="line">			<span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">			String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">			String email = rs.getString(<span class="string">"email"</span>);</span><br><span class="line">			Date birth = rs.getDate(<span class="string">"birth"</span>);</span><br><span class="line"> </span><br><span class="line">			<span class="comment">// 考虑将数据进行封装</span></span><br><span class="line">			customer = <span class="keyword">new</span> Customer(id, name, email, birth);</span><br><span class="line"> </span><br><span class="line">			<span class="comment">// 输出获取到的内容</span></span><br><span class="line">			System.out.println(id + <span class="string">" "</span> + name + <span class="string">" "</span> + email + <span class="string">" "</span> + birth);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 6.关闭资源</span></span><br><span class="line">		JDBCUtils.close(connection, ps, rs);</span><br><span class="line">		<span class="keyword">return</span> customer;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 向数据库中插入一条数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 1 ： 连接数据库</span></span><br><span class="line">			connection = JDBCUtils.getConnection();</span><br><span class="line">			<span class="comment">// sql语句</span></span><br><span class="line">			String sql = <span class="string">"INSERT INTO customers(NAME,email,birth) "</span> + <span class="string">"VALUES(?,?,?);"</span>;</span><br><span class="line">			<span class="comment">// 2.预编译</span></span><br><span class="line">			ps = connection.prepareStatement(sql);</span><br><span class="line">			<span class="comment">// 3.设置内容</span></span><br><span class="line">			ps.setString(<span class="number">1</span>, <span class="string">"强哥"</span>); <span class="comment">// 第一个参数：第几个问号 第二个参数：内容</span></span><br><span class="line">			ps.setString(<span class="number">2</span>, <span class="string">"qiangge@qq.com"</span>);</span><br><span class="line">			<span class="comment">// 获取一个sql下的Date</span></span><br><span class="line">			Date date = <span class="keyword">new</span> Date(<span class="keyword">new</span> java.util.Date().getTime());</span><br><span class="line">			ps.setDate(<span class="number">3</span>, date);</span><br><span class="line">			<span class="comment">// 4.执行sql语句</span></span><br><span class="line">			ps.execute(); <span class="comment">// 如果是查询语句返回true</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 5.关闭资源</span></span><br><span class="line">			JDBCUtils.close(connection, ps);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 删除一条件数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 1. 获取数据库的连接</span></span><br><span class="line">		Connection connection = JDBCUtils.getConnection();</span><br><span class="line"> </span><br><span class="line">		String sql = <span class="string">"DELETE FROM customers WHERE id = ?"</span>;</span><br><span class="line">		<span class="comment">// 2. 预编译</span></span><br><span class="line">		PreparedStatement ps = connection.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 3.填充数据</span></span><br><span class="line">		ps.setInt(<span class="number">1</span>, <span class="number">19</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 4.执行sql语句</span></span><br><span class="line">		<span class="keyword">int</span> executeUpdate = ps.executeUpdate();</span><br><span class="line">		System.out.println(executeUpdate + <span class="string">"条受到影响"</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 5.关闭资源</span></span><br><span class="line">		JDBCUtils.close(connection, ps);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 修改一条件数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> </span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			connection = JDBCUtils.getConnection();</span><br><span class="line"> </span><br><span class="line">			String sql = <span class="string">"UPDATE customers SET NAME = ? WHERE id = ?"</span>;</span><br><span class="line">			ps = connection.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">			ps.setString(<span class="number">1</span>, <span class="string">"成哥"</span>);</span><br><span class="line">			ps.setInt(<span class="number">2</span>, <span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">			<span class="keyword">int</span> executeUpdate = ps.executeUpdate();</span><br><span class="line">			System.out.println(executeUpdate + <span class="string">"条数据受到影响"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			JDBCUtils.close(connection, ps);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通用增删查改"><a href="#通用增删查改" class="headerlink" title="通用增删查改"></a><strong>通用增删查改</strong></h3><h4 id="创建类-User-java"><a href="#创建类-User-java" class="headerlink" title="创建类 User.java"></a><strong>创建类 User.java</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br></pre></td></tr></table></figure>

<p><strong>创建通用连接方案 - 通用增删改</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 通用的增删改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">UID</span><span class="params">(String sql,Object ...objects)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 1. 获取数据库的连接</span></span><br><span class="line">	Connection connection = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">// 2. 预编译</span></span><br><span class="line">	PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">// 4.执行sql语句</span></span><br><span class="line">	<span class="keyword">int</span> executeUpdate = -<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		connection = JDBCUtils.getConnection();</span><br><span class="line">		ps = connection.prepareStatement(sql);</span><br><span class="line">		<span class="comment">// 3.填充数据</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.length; i++) &#123; <span class="comment">// i 表示索引</span></span><br><span class="line">			ps.setObject(i + <span class="number">1</span>, objects[i]); <span class="comment">// i + 1表示的是第几个占位符</span></span><br><span class="line">		&#125;</span><br><span class="line">		executeUpdate = ps.executeUpdate();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">		<span class="comment">// 5.关闭资源</span></span><br><span class="line">		JDBCUtils.close(connection, ps);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> executeUpdate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试代码："><a href="#测试代码：" class="headerlink" title="测试代码："></a><strong>测试代码：</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 测试通用的增删改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">	String sql = <span class="string">"INSERT INTO customers(NAME,email,birth) VALUES(?,?,?)"</span>;</span><br><span class="line">	Date date = <span class="keyword">new</span> java.sql.Date(<span class="keyword">new</span> java.util.Date().getTime());</span><br><span class="line">	<span class="keyword">int</span> uid = JDBCUtils.UID(sql, <span class="string">"强哥"</span>,<span class="string">"qiangge@qq.com"</span>,date);</span><br><span class="line">	System.out.println(uid + <span class="string">"条数据受到影响"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通用查找（一条或多条）"><a href="#通用查找（一条或多条）" class="headerlink" title="通用查找（一条或多条）"></a><strong>通用查找（一条或多条）</strong></h4><h5 id="只查一条数据："><a href="#只查一条数据：" class="headerlink" title="只查一条数据："></a><strong>只查一条数据：</strong></h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 通用的查找 （只有一条数据）</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * Class&lt;T&gt; clazz : 运行时类的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getObject</span><span class="params">(Class&lt;T&gt; clazz,String sql,Object ...objects)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1.获取数据库的连接</span></span><br><span class="line">		Connection connection = JDBCUtils.getConnection();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.预编译</span></span><br><span class="line">		PreparedStatement ps = connection.prepareStatement(sql);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.填充数据</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.length; i++) &#123;</span><br><span class="line">			ps.setObject(i + <span class="number">1</span>, objects[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4.执行sql语句</span></span><br><span class="line">		ResultSet rs = ps.executeQuery();</span><br><span class="line">		</span><br><span class="line">		ResultSetMetaData md = rs.getMetaData(); <span class="comment">//获取元数据。</span></span><br><span class="line">		<span class="comment">//获取列的数量</span></span><br><span class="line">		<span class="keyword">int</span> columnCount = md.getColumnCount();</span><br><span class="line">		<span class="comment">//创建对象</span></span><br><span class="line">		T t = clazz.newInstance();</span><br><span class="line">		<span class="keyword">while</span>(rs.next())&#123; <span class="comment">//遍历每一条数据</span></span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * 第一个问题 ： 如何获取到表的列数</span></span><br><span class="line"><span class="comment">			 * 第二个问题 ： 需要知道类中的属性</span></span><br><span class="line"><span class="comment">			 * 第三个问题 ： 对象中属性的名字怎么来</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++) &#123;</span><br><span class="line">				<span class="comment">//获取某列的列名（如果有别名获取的是别名）</span></span><br><span class="line">				String columnLabel = md.getColumnLabel(i + <span class="number">1</span>); </span><br><span class="line">				 <span class="comment">//通过列名获取列中的数据。</span></span><br><span class="line">				Object value = rs.getObject(columnLabel);</span><br><span class="line"> </span><br><span class="line">				<span class="comment">//封装</span></span><br><span class="line">				<span class="comment">//通过反射 - 给对象中的属性进行赋值</span></span><br><span class="line">				<span class="comment">//将表中的列名当作类中的属性名。如果列名和属性名不一样，可以通过别名的方式（别名 = 属性名）</span></span><br><span class="line">				<span class="comment">//通过列名就获取到了类中的对应的属性</span></span><br><span class="line">				Field declaredField = clazz.getDeclaredField(columnLabel);</span><br><span class="line">				declaredField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">				<span class="comment">/*</span></span><br><span class="line"><span class="comment">				 * 第一个参数 ： 是给哪个对象进行赋值</span></span><br><span class="line"><span class="comment">				 * 第二个参数 ： 属性值</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">				declaredField.set(t, value);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//关闭资源</span></span><br><span class="line">		JDBCUtils.close(connection, ps, rs);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> t;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查多条数据："><a href="#查多条数据：" class="headerlink" title="查多条数据："></a><strong>查多条数据：</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 通用的查找 （返回多条数据）</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">getObjects</span><span class="params">(Class&lt;T&gt; clazz,String sql,Object ...objects)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1.获取数据库的连接</span></span><br><span class="line">		Connection connection = JDBCUtils.getConnection();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.预编译</span></span><br><span class="line">		PreparedStatement ps = connection.prepareStatement(sql);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.填充数据</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.length; i++) &#123;</span><br><span class="line">			ps.setObject(i + <span class="number">1</span>, objects[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4.执行sql语句</span></span><br><span class="line">		ResultSet rs = ps.executeQuery();</span><br><span class="line">		</span><br><span class="line">		ResultSetMetaData md = rs.getMetaData(); <span class="comment">//获取元数据。</span></span><br><span class="line">		<span class="comment">//获取列的数量</span></span><br><span class="line">		<span class="keyword">int</span> columnCount = md.getColumnCount();</span><br><span class="line">		<span class="comment">//创建一个集合</span></span><br><span class="line">		List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">while</span>(rs.next())&#123; <span class="comment">//遍历每一条数据</span></span><br><span class="line">			<span class="comment">//创建对象</span></span><br><span class="line">			T t = clazz.newInstance();</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * 第一个问题 ： 如何获取到表的列数</span></span><br><span class="line"><span class="comment">			 * 第二个问题 ： 需要知道类中的属性</span></span><br><span class="line"><span class="comment">			 * 第三个问题 ： 对象中属性的名字怎么来</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++) &#123;</span><br><span class="line">				<span class="comment">//获取某列的列名（如果有别名获取的是别名）</span></span><br><span class="line">				String columnLabel = md.getColumnLabel(i + <span class="number">1</span>); </span><br><span class="line">				 <span class="comment">//通过列名获取列中的数据。</span></span><br><span class="line">				Object value = rs.getObject(columnLabel);</span><br><span class="line"> </span><br><span class="line">				<span class="comment">//封装</span></span><br><span class="line">				<span class="comment">//通过反射 - 给对象中的属性进行赋值</span></span><br><span class="line">				<span class="comment">//将表中的列名当作类中的属性名。如果列名和属性名不一样，可以通过别名的方式（别名 = 属性名）</span></span><br><span class="line">				<span class="comment">//通过列名就获取到了类中的对应的属性</span></span><br><span class="line">				Field declaredField = clazz.getDeclaredField(columnLabel);</span><br><span class="line">				declaredField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">				<span class="comment">/*</span></span><br><span class="line"><span class="comment">				 * 第一个参数 ： 是给哪个对象进行赋值</span></span><br><span class="line"><span class="comment">				 * 第二个参数 ： 属性值</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">				declaredField.set(t, value);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//将对象放入到集合中</span></span><br><span class="line">			list.add(t);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//关闭资源</span></span><br><span class="line">		JDBCUtils.close(connection, ps, rs);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试代码：-1"><a href="#测试代码：-1" class="headerlink" title="测试代码："></a><strong>测试代码：</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">       String sql = <span class="string">"select id,name,email,birth from customers where id = ?"</span>;</span><br><span class="line">Customer customer = getObject(Customer<span class="class">.<span class="keyword">class</span>, <span class="title">sql</span>, 5)</span>;</span><br><span class="line">System.out.println(customer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql = <span class="string">"select * from users where id = ?"</span>;</span><br><span class="line">User object = getObject(User<span class="class">.<span class="keyword">class</span>, <span class="title">sql</span>, 1)</span>;</span><br><span class="line">System.out.println(object);</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"select * from users"</span>;</span><br><span class="line">List&lt;User&gt; users = getObjects(User<span class="class">.<span class="keyword">class</span>, <span class="title">sql</span>)</span>;</span><br><span class="line"><span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">	System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>jdbc</category>
      </categories>
      <tags>
        <tag>jdbc增删改查</tag>
      </tags>
  </entry>
  <entry>
    <title>jdbc(二)获取数据库连接的五种方式</title>
    <url>/2020/03/10/jdbc(%E4%BA%8C)%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%9A%84%20%E4%BA%94%20%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="获取数据库连接"><a href="#获取数据库连接" class="headerlink" title="获取数据库连接"></a>获取数据库连接</h2><h3 id="连接参数与协议"><a href="#连接参数与协议" class="headerlink" title="连接参数与协议"></a>连接参数与协议</h3><p>（1）可以调用 DriverManager 类的 getConnection() 方法建立到数据库的连接</p>
<p>（2）User,password可以用“属性名=属性值”方式告诉数据库；</p>
<p>（3）JDBC URL 用于标识一个被注册的驱动程序，驱动程序管理器通过这个 URL 选择正确的驱动程序，从而建立到数据库的连接。</p>
<p>（4）JDBC URL的标准由三部分组成，各部分间用冒号分隔。</p>
<ul>
<li><span style="color:red;">jdbc:子协议:子名称</span></li>
<li>协议：JDBC URL中的协议总是jdbc</li>
<li>子协议：子协议用于标识一个数据库驱动程序</li>
<li>子名称：一种标识数据库的方法。子名称可以依不同的子协议而变化，用子名称的目的是为了定位数据库提供足够的信息。包含主机名(对应服务端的ip地址)，端口号，数据库名</li>
</ul>
<h3 id="几种常用数据库的JDBC-URL"><a href="#几种常用数据库的JDBC-URL" class="headerlink" title="几种常用数据库的JDBC URL"></a>几种常用数据库的JDBC URL</h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu92.png" width="60%">

<ul>
<li><p>对于Oracle 数据库连接，采用如下形式：</p>
<p><span style="color:red;">jdbc:oracle:thin:@localhost:1521:webcode</span></p>
</li>
<li><p>对于SQLServer数据库连接，采用如下形式：</p>
<p> <span style="color:red;">jdbc:microsoft:sqlserver//localhost:1433;DatabaseName=sid</span></p>
</li>
<li><p>对于MYSQL 数据库连接，采用如下形式：</p>
<p> <span style="color:red;">jdbc:mysql://localhost:3306/webcode</span></p>
</li>
</ul>
<h3 id="JDBC连接数据库的5种方式"><a href="#JDBC连接数据库的5种方式" class="headerlink" title="JDBC连接数据库的5种方式"></a>JDBC连接数据库的5种方式</h3><p><strong>注意：</strong></p>
<ol>
<li>安装数据库 - 服务必须开启</li>
<li>需要导入数据库的驱动</li>
</ol>
<p>连接数据库的<strong>五种方式</strong>： </p>
<p><strong>代码：</strong> </p>
<h4 id="方式1-："><a href="#方式1-：" class="headerlink" title="方式1 ："></a><strong>方式1 ：</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 数据库的连接：</span></span><br><span class="line"><span class="comment"> * 1.必须保证数据库是安装好的，服务是启动的</span></span><br><span class="line"><span class="comment"> * 2.必须将驱动添加到项目中</span></span><br><span class="line"><span class="comment"> * 3.必须保证数据库的账号和密码是对的</span></span><br><span class="line"><span class="comment"> * 4.必须保证数据库的版本和驱动的一样。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 连接方式一  ：通过多态的方式获取连接驱动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	<span class="comment">//多态 ： 左边是接口的类型，右边是接口的实现</span></span><br><span class="line">	Driver driver = <span class="keyword">new</span> com.mysql.jdbc.Driver();</span><br><span class="line">	<span class="comment">//数据库连接的url</span></span><br><span class="line">	String url = <span class="string">"jdbc:mysql://localhost:3306/test"</span>;</span><br><span class="line">	<span class="comment">//设置数据库的账号和密码</span></span><br><span class="line">	Properties info = <span class="keyword">new</span> Properties();</span><br><span class="line">	info.setProperty(<span class="string">"user"</span>, <span class="string">"root"</span>);</span><br><span class="line">	info.setProperty(<span class="string">"password"</span>, <span class="string">"root"</span>);</span><br><span class="line">	<span class="comment">//数据库的连接</span></span><br><span class="line">	Connection connect = driver.connect(url, info);</span><br><span class="line">	</span><br><span class="line">	System.out.println(connect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方式2-：通过反射获取对象"><a href="#方式2-：通过反射获取对象" class="headerlink" title="方式2   ：通过反射获取对象"></a><strong>方式2   ：</strong>通过反射获取对象</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 连接方式二：通过反射获取对象</span></span><br><span class="line"><span class="comment"> * 体会面向接口的编程思想</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	Class clazz = Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">	Object obj = clazz.newInstance();</span><br><span class="line">	<span class="comment">//多态 ： 左边是接口的类型，右边是接口的实现</span></span><br><span class="line">	Driver driver = (Driver) obj;</span><br><span class="line">	<span class="comment">//数据库连接的url</span></span><br><span class="line">	String url = <span class="string">"jdbc:mysql://localhost:3306/test"</span>;</span><br><span class="line">	<span class="comment">//设置数据库的账号和密码</span></span><br><span class="line">	Properties info = <span class="keyword">new</span> Properties();</span><br><span class="line">	info.setProperty(<span class="string">"user"</span>, <span class="string">"root"</span>);</span><br><span class="line">	info.setProperty(<span class="string">"password"</span>, <span class="string">"root"</span>);</span><br><span class="line">	<span class="comment">//数据库的连接</span></span><br><span class="line">	Connection connect = driver.connect(url, info);</span><br><span class="line">	</span><br><span class="line">	System.out.println(connect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方式3-：-通过DriverMananger获取数据库的连接"><a href="#方式3-：-通过DriverMananger获取数据库的连接" class="headerlink" title="方式3 ： 通过DriverMananger获取数据库的连接"></a><strong>方式3 ： 通过DriverMananger获取数据库的连接</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 连接方式三：通过DriverMananger获取数据库的连接</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 使用DriverMananger有两个操作</span></span><br><span class="line"><span class="comment"> * 1.注册驱动</span></span><br><span class="line"><span class="comment"> * 2.获取连接</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	Class clazz = Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">	Object obj = clazz.newInstance();</span><br><span class="line">	<span class="comment">//多态 ： 左边是接口的类型，右边是接口的实现</span></span><br><span class="line">	Driver driver = (Driver) obj;</span><br><span class="line">	<span class="comment">//数据库连接的url</span></span><br><span class="line">	String url = <span class="string">"jdbc:mysql://localhost:3306/test"</span>;</span><br><span class="line">	String user = <span class="string">"root"</span>;</span><br><span class="line">	String password = <span class="string">"root"</span>;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * mysql可以不用注册，其它的数据库必须进行注册</span></span><br><span class="line"><span class="comment">	 * 这一步不要省。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//注册驱动</span></span><br><span class="line">	DriverManager.registerDriver(driver);</span><br><span class="line">	<span class="comment">//数据库的连接</span></span><br><span class="line">	Connection connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">	</span><br><span class="line">	System.out.println(connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方式4-：-mysql驱动默认会进行驱动的注册"><a href="#方式4-：-mysql驱动默认会进行驱动的注册" class="headerlink" title="方式4 ： mysql驱动默认会进行驱动的注册"></a><strong>方式4 ： mysql驱动默认会进行驱动的注册</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 连接方式四：mysql驱动默认会进行驱动的注册</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//数据库连接的url</span></span><br><span class="line">	String url = <span class="string">"jdbc:mysql://localhost:3306/test"</span>;</span><br><span class="line">	String user = <span class="string">"root"</span>;</span><br><span class="line">	String password = <span class="string">"root"</span>;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * mysql可以不用注册，其它的数据库必须进行注册</span></span><br><span class="line"><span class="comment">	 * 这一步不要省。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	Class clazz = Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">	<span class="comment">//数据库的连接</span></span><br><span class="line">	Connection connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">	</span><br><span class="line">	System.out.println(connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方式5-：-使用配置文件获取数据库的连接"><a href="#方式5-：-使用配置文件获取数据库的连接" class="headerlink" title="方式5 ： 使用配置文件获取数据库的连接"></a><strong>方式5 ： 使用配置文件获取数据库的连接</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 方式五：使用配置文件获取数据库的连接</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">//读取配置文件中的内容</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * 实际上是从bin目录下读取的配置文件</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		InputStream is = <span class="keyword">this</span>.getClass().getClassLoader()</span><br><span class="line">				.getResourceAsStream(<span class="string">"sqlDriver.properties"</span>);</span><br><span class="line">		Properties ps = <span class="keyword">new</span> Properties();</span><br><span class="line">		ps.load(is);</span><br><span class="line">		String user = ps.getProperty(<span class="string">"user"</span>);</span><br><span class="line">		String password = ps.getProperty(<span class="string">"password"</span>);</span><br><span class="line">		String driverClass = ps.getProperty(<span class="string">"driverClass"</span>);</span><br><span class="line">		String url = ps.getProperty(<span class="string">"url"</span>);</span><br><span class="line">		is.close();</span><br><span class="line">		</span><br><span class="line"><span class="comment">//		创建Driver对象</span></span><br><span class="line">		Class clazz = Class.forName(driverClass);</span><br><span class="line">		Object obj = clazz.newInstance();</span><br><span class="line">		Driver driver = (Driver) obj;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//注册驱动</span></span><br><span class="line">		DriverManager.registerDriver(driver);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//数据库的连接</span></span><br><span class="line">		Connection connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">		</span><br><span class="line">		System.out.println(connection);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>jdbc</category>
      </categories>
      <tags>
        <tag>数据库连接</tag>
      </tags>
  </entry>
  <entry>
    <title>jdbc(四)ResultSet</title>
    <url>/2020/03/10/jdbc(%E5%9B%9B)ResultSet/</url>
    <content><![CDATA[<h2 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a><strong>ResultSet</strong></h2><h3 id="ResultSet-的作用："><a href="#ResultSet-的作用：" class="headerlink" title="ResultSet 的作用："></a><strong>ResultSet 的作用：</strong></h3><ul>
<li>通过调用 PreparedStatement 对象的 excuteQuery() 方法创建该对象</li>
<li>ResultSet 对象以逻辑表格的形式封装了执行数据库操作的结果集，ResultSet 接口由数据库厂商实现</li>
<li>ResultSet 对象维护了一个指向当前数据行的游标，初始的时候，游标在第一行之前，可以通过 ResultSet 对象的 next() 方法移动到下一行</li>
</ul>
<h3 id="ResultSet-接口的常用方法："><a href="#ResultSet-接口的常用方法：" class="headerlink" title="ResultSet 接口的常用方法："></a><strong>ResultSet 接口的常用方法：</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">next</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">getString</span><span class="params">( )</span></span></span><br></pre></td></tr></table></figure>

<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a><strong>案例</strong></h3><p><strong>（1）</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu94.png" width="60%">

<p><strong>（2）</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu95.png" width="60%">

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a><strong>说明</strong></h3><ol>
<li>查询需要调用Prepared Statement 的 executeQuery() 方法，查询结果是一个 ResultSet 对象 </li>
<li>关于 ResultSet：代表结果集 </li>
</ol>
<blockquote>
<ul>
<li>ResultSet: 结果集. 封装了使用 JDBC 进行查询的结果.</li>
<li>调用 PreparedStatement 对象的 executeQuery() 可以得到结果集.</li>
<li>ResultSet 返回的实际上就是一张数据表. 有一个指针指向数据表的第一条记录的前面.</li>
</ul>
</blockquote>
<ol start="3">
<li><p>可以调用 next() 方法检测下一行是否有效. 若有效该方法返回 true, 且指针下移. 相当于Iterator 对象的 hasNext() 和 next() 方法的结合体 </p>
</li>
<li><p>当指针指向一行时, 可以通过调用 getXxx(int index) 或 getXxx(int columnName) 获取每一列的值. </p>
<blockquote>
<p>   例如: getInt(1), getString(“name”) </p>
</blockquote>
</li>
<li><p>ResultSet 当然也需要进行关闭. </p>
</li>
</ol>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>jdbc</category>
      </categories>
      <tags>
        <tag>resultSet</tag>
      </tags>
  </entry>
  <entry>
    <title>jdbc(一)概述</title>
    <url>/2020/03/10/jdbc(%E4%B8%80)%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<h3 id="1、JDBC-的概述"><a href="#1、JDBC-的概述" class="headerlink" title="1、JDBC 的概述"></a>1、JDBC 的概述</h3><p><strong>1.1 jdbc 是什么</strong> </p>
<p><strong>JDBC(Java Database Connectivity)</strong>是一个独立于特定数据库管理系统、通用的SQL数据库存取和操作的公共接口（一组<strong>API</strong>），定义了用来访问数据库的标准<strong>Java</strong>类库，（<strong>java.sql,javax.sql</strong>）使用这个类库可以以一种标准的方法、方便地访问数据库资源</p>
<ul>
<li><strong>JDBC</strong>为访问不同的数据库提供了一种统一的途径，为开发者屏蔽了一些细节问题。</li>
<li><strong>JDBC</strong>的目标是使Java程序员使用<strong>JDBC</strong>可以连接任何提供了<strong>JDBC</strong>驱动程序的数据库系统，这样就使得程序员无需对特定的数据库系统的特点有过多的了解，从而大大简化和加快了开发过程。</li>
</ul>
<p><strong>1.2 jdbc 与 数据库的连接方式：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu89.png" width="60%">

<p><strong>规范化的jdbc</strong> 连接数据库方式： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu90.png" width="60%">

<p><strong>1.3 JDBC 体系结构</strong></p>
<p>JDBC接口（API）包括两个层次：</p>
<ul>
<li><strong>面向应用的API</strong>：Java API，抽象接口，供应用程序开发人员使用（连接数据库，执行SQL语句，获得结果）。</li>
<li><strong>面向数据库的API：</strong>Java Driver API，供开发商开发数据库驱动程序用。</li>
</ul>
<p><strong>JDBC是sun公司提供一套用于数据库操作的接口，java程序员只需要面向这套接 口编程即可。</strong>不同的数据库厂商，需要针对这套接口，提供不同实现。不同的实现的集合，即为不同数据库的驱动。这种方式是<strong>面向接口编程</strong>。</p>
<p><strong>1.4 JDBC API</strong></p>
<p><strong>JDBC API</strong> 是一系列的接口，它使得应用程序能够进行数据库联接，执行<strong>SQL</strong>语句，并且得到返回结果。</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu91.png" width="60%">

<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>jdbc</category>
      </categories>
  </entry>
  <entry>
    <title>最新idea2020注册码永久激活(激活到2100年)</title>
    <url>/2020/03/10/%E6%9C%80%E6%96%B0idea2020%E6%B3%A8%E5%86%8C%E7%A0%81%E6%B0%B8%E4%B9%85%E6%BF%80%E6%B4%BB-%E6%BF%80%E6%B4%BB%E5%88%B02100%E5%B9%B4/</url>
    <content><![CDATA[<p>这篇文章主要介绍了idea2020注册码永久激活（激活到2100年）,文中给大家提到了2020年最新JetBrains授权服务器-IntelliJ IDEA激活，需要的朋友可以参考下 </p>
<p><strong>2020年最新JetBrains授权服务器-IntelliJ IDEA激活</strong></p>
<p>2020年最近可激活JetBrains授权服务器地址</p>
<p>1：<a href="https://idea.ouyanglol.com/" target="_blank" rel="noopener">https://idea.ouyanglol.com/</a></p>
<p>2：<a href="http://101.132.235.155:1017/" target="_blank" rel="noopener">http://101.132.235.155:1017/</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>激活码</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>Java对象的值传递问题：传值还是传引用？</title>
    <url>/2020/03/10/Java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%80%BC%E4%BC%A0%E9%80%92%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BC%A0%E5%80%BC%E8%BF%98%E6%98%AF%E4%BC%A0%E5%BC%95%E7%94%A8%EF%BC%9F/</url>
    <content><![CDATA[<h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><p>​    在使用<strong>Java</strong>语言进行开发过程中，涉及到<strong>局部变量</strong>与<strong>方法内部作用域</strong>的<strong>数据交换与解析</strong>的过程，而这一过程，一般都是通过<strong>方法形参</strong>的方式进行<strong>java</strong>对象的传递。</p>
<blockquote>
<p> 这里引出一个问题，<strong>当对象作为参数传递时，究竟传的是对象的值，还是对象的引用呢？–_–</strong></p>
</blockquote>
<p>这是一个保守争议的话题。</p>
<p>​    假设，传的是值，那么函数接收的只是一个<strong>副本</strong>，由于<strong>作用域</strong>的存在，函数对象形参的操作，并不会对实参产生影响；若传的是<strong>引用</strong>，那么此时<strong>对形参</strong>的操作则会影响到实参。</p>
<p>​    在这里引用一句代码来举例分析：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br></pre></td></tr></table></figure>

<p>这句代码的意思是：创建一个Object对象，并在堆内存开辟一个空间（new），同时创建一个名为obj 的引用，让这个引用指向这个对象，如下图所示：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu83.png" width="60%">

<p>在上面我们创建了一个对象以及其引用，下面我们通过例子来从代码层面进行分析。</p>
<h3 id="基本数据类型作为参数传递："><a href="#基本数据类型作为参数传递：" class="headerlink" title="基本数据类型作为参数传递："></a>基本数据类型作为参数传递：</h3><p>例1:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> test.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020年3月10日</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        System.out.println(<span class="string">"before change, i = "</span>+i);</span><br><span class="line">        change(i);</span><br><span class="line">        System.out.println(<span class="string">"after change, i = "</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">        i = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子中使用基本数据类型的 <strong>int</strong> 作为形参传递，执行结果如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">before change, i = <span class="number">1</span></span><br><span class="line">after change, i = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>从 int 类型作为形参的例子的执行结果可知，<strong>当基本数据类型（Boolean，byte，char，String，int，Long，float，double）作为参数传递时，传递的是实参值的副本，即传的是值，无论在函数中怎么操作这个副本，实参的值是不会被改变的</strong>。 </p>
<hr>
<h3 id="对象作为参数传递："><a href="#对象作为参数传递：" class="headerlink" title="对象作为参数传递："></a>对象作为参数传递：</h3><p>例2： 我们使用 StringBuffer对象作为参数传递到<strong>change</strong>函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">"Hello "</span>);</span><br><span class="line">        System.out.println(<span class="string">"before change, sb is "</span>+sb.toString());</span><br><span class="line">        change(sb);</span><br><span class="line">        System.out.println(<span class="string">"after change, sb is "</span>+sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(StringBuffer stringBuffer)</span></span>&#123;</span><br><span class="line">        stringBuffer.append(<span class="string">"world !"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>程序的<strong>运行结果</strong>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">before change, sb is Hello </span><br><span class="line">after change, sb is Hello world !</span><br></pre></td></tr></table></figure>

<p>从输出结果中我们可以发现，sb所指向的对象的值被改变了，那么是否我们可以推论出，在Java中，当对象作为参数传递时，传递的是该对象的引用呢？我们再来看下面这个例子：  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">"Hello "</span>);</span><br><span class="line">        System.out.println(<span class="string">"before change, sb is "</span>+sb.toString());</span><br><span class="line">        change(sb);</span><br><span class="line">        System.out.println(<span class="string">"after change, sb is "</span>+sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(StringBuffer stringBuffer)</span></span>&#123;</span><br><span class="line">        stringBuffer = <span class="keyword">new</span> StringBuffer(<span class="string">"Hi "</span>);</span><br><span class="line">        stringBuffer.append(<span class="string">"world !"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果上面的推论是正确的，即Java中对象作为参数传递，实际传递的是该对象的引用，那么在调用change函数之后，原对象的值应该是会改变的，变为“Hi world ！”，但是，当我们运行程序后，结果却是如下所示：  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">before change, sb is Hello </span><br><span class="line">after change, sb is Hello</span><br></pre></td></tr></table></figure>

<p>​    原对象的值并没有被改变，这与上面的推论相矛盾！为什么在Java中，当对象作为参数传递时，有的时候实参被改变了，而有的时候实参并未被改变呢？下面让我们来分析一下其中的原因：  　　从文章的开头我们知道，当执行<strong>StringBuffer sb = new StringBuffer(“Hello “)</strong>时，我们创建了一个指向新建对象“<strong>new StringBuffer(“Hello “)”</strong>的引用“<strong>sb</strong>”，如下图所示：  </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu84.png" width="60%">

<p>在例2中，当我们调用change函数后，实际上，形参stringBuffer也指向了实参sb所指向的对象，即： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu85.png" width="60%">

<p>那么当我们执行<strong>stringBuffer.append(“world !”)</strong>后，便通过对象的引用“stringBuffer”修改了对象的值，使之变成了<strong>“Hello world ！”</strong>，即：  </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu86.png" width="60%">

<p>但是，在例3中的change函数中，我们又新建了一个对象<strong>“new StringBuffer(“Hi  “)”</strong>（这实际上在内存中开辟了一块在原对象地址之外的新区域），这让形参stringBuffer实际指向了这个新建的对象，并将新对象的值设置为<strong>“Hi world ！”</strong>，例三中stringBuffer的值已经被改变为了Hi  world，但是因为值没有被<strong>return</strong>返回赋值给sb对象，所以sb对象并没有被改变，所以输出的任然是hello，即： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu87.png" width="60%">

<p>那么我们就不难理解，为何在执行完change函数之后，实参的值仍为“Hello”了。 </p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>　　<strong>综上所述，我们可以得出结论：在Java中，当对象作为参数传递时，实际上传递的是一份“引用的拷贝”。 （实际传递的是对象的引用）</strong></p>
<p><strong>转载自：<a href="https://blog.csdn.net/xiangwanpeng/article/details/52454479" target="_blank" rel="noopener">https://blog.csdn.net/xiangwanpeng/article/details/52454479</a></strong></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>JavaSE</category>
      </categories>
      <tags>
        <tag>值传递 引用 值</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络（二）当你在浏览器地址栏输入一个URL后回车，将会发生的事情？</title>
    <url>/2020/03/09/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%BD%93%E4%BD%A0%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAURL%E5%90%8E%E5%9B%9E%E8%BD%A6%EF%BC%8C%E5%B0%86%E4%BC%9A%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85%EF%BC%9F/</url>
    <content><![CDATA[<p>​    当我们在浏览器的地址栏输入<a href="https://www.cnblogs.com/，然后回车，回车到看到页面到底发生了什么呢？" target="_blank" rel="noopener">https://www.cnblogs.com/，然后回车，回车到看到页面到底发生了什么呢？</a></p>
<p>​    <strong>域名解析 –&gt; 发起TCP的3次握手 –&gt; 建立TCP连接后发起http请求 –&gt;  服务器响应http请求，浏览器得到html代码 –&gt; 浏览器解析html代码，并请求html代码中的资源（如js、css、图片等）  –&gt; 浏览器对页面进行渲染呈现给用户</strong></p>
<h2 id="一、域名解析"><a href="#一、域名解析" class="headerlink" title="一、域名解析"></a>一、域名解析</h2><p>​    首先Chrome浏览器会解析<a href="https://www.cnblogs.com/这个域名对应的IP地址。怎么解析到对应的IP地址？" target="_blank" rel="noopener">https://www.cnblogs.com/这个域名对应的IP地址。怎么解析到对应的IP地址？</a></p>
<ol>
<li><p>Chrome浏览器会首先搜索浏览器的DNS缓存（缓存时间比较短，TTL默认是1000，且只能容纳1000条缓存），看自身的缓存中是否有<a href="https://www.cnblogs.com/对应的条目，而且没有过期，如果有且没有过期则解析到此结束。" target="_blank" rel="noopener">https://www.cnblogs.com/对应的条目，而且没有过期，如果有且没有过期则解析到此结束。</a></p>
<p>注：我们怎么查看浏览器的DNS缓存？可以使用 chrome://net-internals/#dns 来进行查看</p>
</li>
<li><p>如果浏览器自身的缓存里面没有找到对应的条目，那么Chrome会搜索操作系统的DNS缓存,如果找到且没有过期则停止搜索解析到此结束。</p>
<p>注：怎么查看操作系统的DNS缓存，以Windows系统为例，可以在命令行下使用 ipconfig /displaydns 来进行查看</p>
</li>
<li><p>如果在Windows系统的DNS缓存也没有找到，那么尝试读取hosts文件（位于C:\Windows\System32\drivers\etc），看看这里面有没有该域名对应的IP地址，如果有则解析成功。</p>
</li>
<li><p>如果在hosts文件中也没有找到对应的条目，浏览器就会发起一个DNS的系统调用，就会向本地配置的首选DNS服务器（一般是电信运营商提供的，也可以使用像Google提供的DNS服务器）发起域名解析请求（通过的是UDP协议向DNS的53端口发起请求，这个请求是<strong>递归的请求</strong>，也就是运营商的DNS服务器必须得提供给我们该域名的IP地址），运营商的DNS服务器首先查找自身的缓存，找到对应的条目，且没有过期，则解析成功。如果没有找到对应的条目，则有运营商的DNS代我们的浏览器发起<strong>迭代DNS解析请求</strong>，它首先是会找根域的DNS的IP地址（这个DNS服务器都内置13台根域的DNS的IP地址），找打根域的DNS地址，就会向其发起请求（请问<a href="https://www.cnblogs.com/这个域名的IP地址是多少啊？），根域发现这是一个顶级域com域的一个域名，于是就告诉运营商的DNS我不知道这个域名的IP地址，但是我知道com域的IP地址，你去找它去，于是运营商的DNS就得到了com域的IP地址，又向com域的IP地址发起了请求（请问https://www.cnblogs.com/这个域名的IP地址是多少?）,com域这台服务器告诉运营商的DNS我不知道https://www.cnblogs.com/这个域名的IP地址，但是我知道https://www.cnblogs.com/这个域的DNS地址，你去找它去，于是运营商的DNS又向https://www.cnblogs.com/这个域名的DNS地址（这个一般就是由域名注册商提供的，像万网，新网等）发起请求（请问https://www.cnblogs.com/这个域名的IP地址是多少？），这个时候cnblogs.com域的DNS服务器一查，果真在我这里，于是就把找到的结果发送给运营商的DNS服务器，这个时候运营商的DNS服务器就拿到了https://www.cnblogs.com/这个域名对应的IP地址，并返回给Windows系统内核，内核又把结果返回给浏览器，终于浏览器拿到了https://www.cnblogs.com/对应的IP地址，该进行一步的动作了。" target="_blank" rel="noopener">https://www.cnblogs.com/这个域名的IP地址是多少啊？），根域发现这是一个顶级域com域的一个域名，于是就告诉运营商的DNS我不知道这个域名的IP地址，但是我知道com域的IP地址，你去找它去，于是运营商的DNS就得到了com域的IP地址，又向com域的IP地址发起了请求（请问https://www.cnblogs.com/这个域名的IP地址是多少?）,com域这台服务器告诉运营商的DNS我不知道https://www.cnblogs.com/这个域名的IP地址，但是我知道https://www.cnblogs.com/这个域的DNS地址，你去找它去，于是运营商的DNS又向https://www.cnblogs.com/这个域名的DNS地址（这个一般就是由域名注册商提供的，像万网，新网等）发起请求（请问https://www.cnblogs.com/这个域名的IP地址是多少？），这个时候cnblogs.com域的DNS服务器一查，果真在我这里，于是就把找到的结果发送给运营商的DNS服务器，这个时候运营商的DNS服务器就拿到了https://www.cnblogs.com/这个域名对应的IP地址，并返回给Windows系统内核，内核又把结果返回给浏览器，终于浏览器拿到了https://www.cnblogs.com/对应的IP地址，该进行一步的动作了。</a> </p>
<p>DNS递归解析图如下所示： </p>
</li>
</ol>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu96.png" width="60%">

<p>​    DNS迭代解析图如下所示： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu97.png" width="60%">

<p>注：一般情况下是不会进行以下步骤的，如果经过以上的4个步骤，还没有解析成功，那么会进行如下步骤：</p>
<ol>
<li>操作系统就会查找NetBIOS name  Cache（NetBIOS名称缓存，就存在客户端电脑中的），那这个缓存有什么东西呢？凡是最近一段时间内和我成功通讯的计算机的计算机名和Ip地址，就都会存在这个缓存里面。什么情况下该步能解析成功呢？就是该名称正好是几分钟前和我成功通信过，那么这一步就可以成功解析。</li>
<li>如果第5步也没有成功，那会查询WINS 服务器（是NETBIOS名称和IP地址对应的服务器）</li>
<li>如果第6步也没有查询成功，那么客户端就要进行广播查找</li>
<li>如果第7步也没有成功，那么客户端就读取LMHOSTS文件（和HOSTS文件同一个目录下，写法也一样）</li>
</ol>
<p>如果第八步还没有解析成功，那么这次解析失败，那就无法跟目标计算机进行通信。只要这八步中有一步可以解析成功，那就可以成功和目标计算机进行通信。</p>
<h2 id="二、发起TCP的3次握手"><a href="#二、发起TCP的3次握手" class="headerlink" title="二、发起TCP的3次握手"></a>二、发起TCP的3次握手</h2><p>拿到域名对应的IP地址之后，User-Agent（一般是指浏览器）会以一个随机端口（1024 &lt; 端口 &lt;  65535）向服务器的WEB程序（常用的有tomcat,nginx等）80端口发起TCP的连接请求。这个连接请求（原始的http请求经过TCP/IP4层模型的层层封包）到达服务器端后（这中间通过各种路由设备，局域网内除外），进入到网卡，然后是进入到内核的TCP/IP协议栈（用于识别该连接请求，解封包，一层一层的剥开），还有可能要经过Netfilter防火墙（属于内核的模块）的过滤，最终到达WEB程序，最终建立了TCP/IP的连接。如下图：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu98.png" width="60%">

<p>注：<a href="http://www.cnblogs.com/wupeixuan/p/8639469.html" target="_blank" rel="noopener">TCP三次握手详解</a> </p>
<h2 id="三、建立TCP连接后发起http请求"><a href="#三、建立TCP连接后发起http请求" class="headerlink" title="三、建立TCP连接后发起http请求"></a>三、建立TCP连接后发起http请求</h2><p>​    HTTP请求报文的方法是get方式，如果浏览器存储了该域名下的Cookies，那么会把Cookies放入HTTP请求头里发给服务器。</p>
<p>下面是Chrome发起的http请求报文头部信息:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: www.cnblogs.com</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">62.0</span><span class="number">.3202</span><span class="number">.75</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,image/apng,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Referer: http://www.cnblogs.com/wupeixuan/</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br></pre></td></tr></table></figure>

<h2 id="四、服务器端响应http请求，浏览器得到html代码"><a href="#四、服务器端响应http请求，浏览器得到html代码" class="headerlink" title="四、服务器端响应http请求，浏览器得到html代码"></a>四、服务器端响应http请求，浏览器得到html代码</h2><p>​    服务器端WEB程序接收到http请求以后，就开始处理该请求，处理之后就返回给浏览器html文件。</p>
<p>用Chrome浏览器看到的响应头信息：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Date: Sun, <span class="number">08</span> Apr <span class="number">2018</span> <span class="number">10</span>:<span class="number">51</span>:<span class="number">00</span> GMT</span><br><span class="line">Content-Type: text/html; charset=utf-<span class="number">8</span></span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Cache-Control: <span class="keyword">public</span>, max-age=<span class="number">29</span></span><br><span class="line">Expires: Sun, <span class="number">08</span> Apr <span class="number">2018</span> <span class="number">10</span>:<span class="number">51</span>:<span class="number">29</span> GMT</span><br><span class="line">Last-Modified: Sun, <span class="number">08</span> Apr <span class="number">2018</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">59</span> GMT</span><br><span class="line">X-UA-Compatible: IE=<span class="number">10</span></span><br><span class="line">Content-Encoding: gzip</span><br></pre></td></tr></table></figure>

<h2 id="五、浏览器解析html代码，并请求html代码中的资源"><a href="#五、浏览器解析html代码，并请求html代码中的资源" class="headerlink" title="五、浏览器解析html代码，并请求html代码中的资源"></a>五、浏览器解析html代码，并请求html代码中的资源</h2><p>​    浏览器拿到index.html文件后，就开始解析其中的html代码，遇到js/css/image等静态资源时，就向服务器端去请求下载（会使用多线程下载，每个浏览器的线程数不一样），这个时候就用上keep-alive特性了，建立一次HTTP连接，可以请求多个资源，下载资源的顺序就是按照代码里的顺序，但是由于每个资源大小不一样，而浏览器又多线程请求请求资源，所以从下图看出，这里显示的顺序并不一定是代码里面的顺序。</p>
<p>​    浏览器在请求静态资源时（在未过期的情况下），向服务器端发起一个http请求（询问自从上一次修改时间到现在有没有对资源进行修改），如果服务器端返回304状态码（告诉浏览器服务器端没有修改），那么浏览器会直接读取本地的该资源的缓存文件。</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu99.png" width="60%">

<h2 id="六、浏览器对页面进行渲染呈现给用户"><a href="#六、浏览器对页面进行渲染呈现给用户" class="headerlink" title="六、浏览器对页面进行渲染呈现给用户"></a>六、浏览器对页面进行渲染呈现给用户</h2><p>最后，Chrome浏览器利用自己内部的工作机制，把请求到的静态资源和html代码进行渲染，渲染之后呈现给用户。</p>
<p><strong>注：</strong> <strong>本文转载自</strong> <a href="https://www.cnblogs.com/wupeixuan/p/8747918.html" target="_blank" rel="noopener">https://www.cnblogs.com/wupeixuan/p/8747918.html</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title>Activity（四）流程设计工具创建流程图</title>
    <url>/2020/03/09/Activity-%EF%BC%88%E5%9B%9B%EF%BC%89%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%B7%A5%E5%85%B7%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%9B%BE/</url>
    <content><![CDATA[<h3 id="1、引言"><a href="#1、引言" class="headerlink" title="1、引言"></a>1、引言</h3><p>在前面我们知道了怎么创建流程控制引擎，而<strong>Activiti</strong> 的正常使用还需要进行部署流程，而这就有一个很重要的前提。那就是创建相应的流程图，并让其能被 <strong>service</strong> 所调用从而实现流程的执行。</p>
<h3 id="2、流程图创建工具"><a href="#2、流程图创建工具" class="headerlink" title="2、流程图创建工具"></a>2、流程图创建工具</h3><h4 id="2-1-简述第一种创建方式"><a href="#2-1-简述第一种创建方式" class="headerlink" title="2.1 简述第一种创建方式"></a>2.1 简述第一种创建方式</h4><p><code>在这里说明一点，流程图的创建可以使用两种方式，第一种是XML版本的，案例如下：</code></p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu64.png" width="60%">

<p>我们看到的是一个<a href="https://www.activiti.org/5.x/userguide/#bpmnNoneStartEvent" target="_blank" rel="noopener">无开始事件</a>（左侧的圆圈），后面是两个<a href="https://www.activiti.org/5.x/userguide/#bpmnUserTask" target="_blank" rel="noopener">用户任务</a>：<em>“写每月财务报告”</em>和 <em>“验证每月财务报告”</em>，以一个<a href="https://www.activiti.org/5.x/userguide/#bpmnNoneEndEvent" target="_blank" rel="noopener">无结束事件</a>（右侧带有粗边框的圆圈）结束。 </p>
<ul>
<li>在这里，<strong>start task</strong> 告诉我们什么<em>入口点</em>的过程。</li>
<li>在 <strong>user task</strong> 声明是我们的过程的人工任务的表示。请注意，第一个任务分配给<em>会计</em>组，而第二个任务分配给<em>管理</em>组。有关如何将用户和组分配给用户任务的更多信息，请参见<a href="https://www.activiti.org/5.x/userguide/#bpmnUserTaskAssignment" target="_blank" rel="noopener">用户任务分配部分</a>。</li>
<li>当到达 <strong>end task</strong> 时，该过程结束。</li>
<li>这些元素通过<a href="https://www.activiti.org/5.x/userguide/#bpmnSequenceFlow" target="_blank" rel="noopener">顺序流</a>相互连接。这些顺序流具有<code>source</code>和<code>target</code>，用于定义顺序流的<em>方向</em>。</li>
</ul>
<p>其对应的xml 版本的配置如下：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;definitions</span> <span class="string">id="definitions"</span></span><br><span class="line">  <span class="attr">targetNamespace</span>=<span class="string">"http://activiti.org/bpmn20"</span></span><br><span class="line">  <span class="attr">xmlns</span>:<span class="string">activiti="http://activiti.org/bpmn"</span></span><br><span class="line">  <span class="attr">xmlns</span>=<span class="string">"http://www.omg.org/spec/BPMN/20100524/MODEL"&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">&lt;process</span> <span class="string">id="financialReport" name="Monthly financial report reminder process"&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;startEvent</span> <span class="string">id="theStart" /&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;sequenceFlow</span> <span class="string">id='flow1' sourceRef='theStart' targetRef='writeReportTask' /&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;userTask</span> <span class="string">id="writeReportTask" name="Write monthly financial report" &gt;</span></span><br><span class="line">	    <span class="attr">&lt;documentation&gt;</span></span><br><span class="line">	      <span class="attr">Write</span> <span class="string">monthly financial report for publication to shareholders.</span></span><br><span class="line">	    <span class="attr">&lt;/documentation&gt;</span></span><br><span class="line">	    <span class="attr">&lt;potentialOwner&gt;</span></span><br><span class="line">	      <span class="attr">&lt;resourceAssignmentExpression&gt;</span></span><br><span class="line">	        <span class="attr">&lt;formalExpression&gt;accountancy&lt;/formalExpression&gt;</span></span><br><span class="line">	      <span class="attr">&lt;/resourceAssignmentExpression&gt;</span></span><br><span class="line">	    <span class="attr">&lt;/potentialOwner&gt;</span></span><br><span class="line">	  <span class="attr">&lt;/userTask&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;sequenceFlow</span> <span class="string">id='flow2' sourceRef='writeReportTask' targetRef='verifyReportTask' /&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;userTask</span> <span class="string">id="verifyReportTask" name="Verify monthly financial report" &gt;</span></span><br><span class="line">	    <span class="attr">&lt;documentation&gt;</span></span><br><span class="line">	      <span class="attr">Verify</span> <span class="string">monthly financial report composed by the accountancy department.</span></span><br><span class="line">	      <span class="attr">This</span> <span class="string">financial report is going to be sent to all the company shareholders.</span></span><br><span class="line">	    <span class="attr">&lt;/documentation&gt;</span></span><br><span class="line">	    <span class="attr">&lt;potentialOwner&gt;</span></span><br><span class="line">	      <span class="attr">&lt;resourceAssignmentExpression&gt;</span></span><br><span class="line">	        <span class="attr">&lt;formalExpression&gt;management&lt;/formalExpression&gt;</span></span><br><span class="line">	      <span class="attr">&lt;/resourceAssignmentExpression&gt;</span></span><br><span class="line">	    <span class="attr">&lt;/potentialOwner&gt;</span></span><br><span class="line">	  <span class="attr">&lt;/userTask&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;sequenceFlow</span> <span class="string">id='flow3' sourceRef='verifyReportTask' targetRef='theEnd' /&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="meta">&lt;endEvent</span> <span class="string">id="theEnd" /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&lt;/process&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&lt;/definitions&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-视图模式创建流程图"><a href="#2-2-视图模式创建流程图" class="headerlink" title="2.2 视图模式创建流程图"></a>2.2 视图模式创建流程图</h4><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu65.png" width="60%">

<p><strong>这里我们创建一个简单的流程图作为示范入门。</strong></p>
<p>开发流程 首先要做的，就是要设计好流程图；一个项目可能会包括多个流程图；所以在<strong>src/test/resources</strong>源文件夹下新建一个包<strong>diagrams</strong>，以后所有的流程图文件(bpmn文件和生成的png文件)都放在这个包下； </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu66.png" width="60%">

<p>然后在<strong>diagrams</strong>上右击，<strong>New - &gt; Other</strong> ：创建一个新的流程实例图 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu67.png" width="60%">

<p>选择 <strong>Activiti</strong>下的 <strong>Activiti Diagram</strong> 要开始开发一个<strong>Activiti</strong>流程图表： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu68.png" width="60%">

<p>这里 中间区域，是用来绘制流程图标的。右侧是绘制流程图标的工具箱，下面的Properties是属性视图，目前看到的是整个helloWorld流程图的属性： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu69.png" width="60%">

<p>然后来画流程图，任何流程，都必须有一个开始事件节点和结束事件节点： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu70.png" width="60%">

<p> 在右侧的工具箱里会看到有个<strong>StartEvent</strong> 和<strong>EndEvent</strong>。先点下  然后拖到中间的绘图区域就<strong>OK</strong>了；</p>
<p> 当然每个节点的属性都可以看到，而且可以设置，可以点击选中一个节点，然后在属性视图上看到所以值；</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu71.png" width="60%">

<p> 会看到这里插件都给设置了初识属性值，可以改  ，也可以不改，都行；</p>
<p> 之后在搞一个用户任务节点（开发最常用的节点），拖一个到中间绘图区域</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu72.png" width="60%">

<p> 这里的任务节点，必须要有一个人去处理这个任务，而且在实际开发中，根据实际业务，给这个用户任务节点取个名字，</p>
<p> 当然这里是初识，所以就搞个<strong>myprocess</strong>名字，然后分配给“<strong>小龙</strong>”这个人；</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu73.png" width="60%">

<p>这样就完成了最简单的流程图设计。</p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>计算机网络（一）-深入理解NIO</title>
    <url>/2020/03/09/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3NIO/</url>
    <content><![CDATA[<p><strong>目录概览</strong>：</p>
<ul>
<li>​    NIO 网络编程模型</li>
<li>​    NIO 网络编程详解</li>
<li>​    NIO 网络编程实战</li>
<li>​    NIO 网络编程缺陷</li>
</ul>
<h2 id="一、NIO网络编程模型"><a href="#一、NIO网络编程模型" class="headerlink" title="一、NIO网络编程模型"></a>一、NIO网络编程模型</h2><h3 id="1、编程模型定义"><a href="#1、编程模型定义" class="headerlink" title="1、编程模型定义"></a>1、编程模型定义</h3><p><strong>NIO :</strong>  又叫<strong>Non-blocking I/O</strong>或<strong>New I/O</strong>;全新的输入输出标准库；</p>
<p>​            做为原始<strong>I/O</strong>的补充，为了高性能和高并发的场景使用。</p>
<p><strong>模型：</strong>对事物共性的抽象；</p>
<p><strong>编程模型：</strong>对编程共性的抽象；</p>
<h3 id="2、BIO网络模型"><a href="#2、BIO网络模型" class="headerlink" title="2、BIO网络模型"></a>2、BIO网络模型</h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu74.png" width="60%">

<ul>
<li>服务端启动，开始建立监听客户端的连接请求；</li>
<li>客户端启动，向服务器端发起建立连接请求；</li>
<li>服务器在收到客户端的请求后，将会创建一个新的线程；</li>
<li>服务端新创建的线程会与客户端建立socket连接，用于响应客户端的请求，通知客户端连接建立成功，你随时可以给我发送数据。</li>
<li>服务器端处理完客户端的请求之后，就会处于等待状态，等待客户端再次发起请求</li>
</ul>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu75.png" width="60%">

<p>服务端为每一个客户端建一个线程，一旦客户端请求过多，服务端线程数量也会增多，服务端压力增大。 </p>
<h3 id="3、BIO网络模型缺点"><a href="#3、BIO网络模型缺点" class="headerlink" title="3、BIO网络模型缺点"></a>3、BIO网络模型缺点</h3><ul>
<li><strong>阻塞式I/O模型</strong>，会导致服务器端的业务线程会因阻塞IO的问题一直阻塞等待客户端发起请求，如果客户端不发起请求，服务端的业务线程会一直存在，就会耗费大量系统资源</li>
<li><strong>弹性伸缩能力差</strong>：服务器端的线程数与客户端的个数呈1比1的关系</li>
<li><strong>多线程耗资源</strong> ： 每一个线程都会对CPU的调度资源进行占用，一旦占用而不释放，则会导致资源的紧缺、甚至系统服务的异常宕机</li>
</ul>
<h3 id="4、NIO网络模型猜想"><a href="#4、NIO网络模型猜想" class="headerlink" title="4、NIO网络模型猜想"></a>4、NIO网络模型猜想</h3><p><strong>基于非阻塞 I/O ， 设计应对高并发场景编程模型</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu76.png" width="60%">

<p>图解分析：<strong>NIO架构中，客户端的个数与服务器端的线程数呈M:1的关系</strong> </p>
<h3 id="5、NIO-网络模型"><a href="#5、NIO-网络模型" class="headerlink" title="5、NIO 网络模型"></a>5、NIO 网络模型</h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu77.png" width="60%">

<p><strong>第一步</strong>：注册连接并提供服务：Selector 中初始化注册并建立连接事件，提供给Client建立连接的服务；client通过Selector连接与AcceptorHandler 发送创建客户端的连接，并又AcceptorHandler方法返回响应结果；同时该AcceptorHandler方法向Selector中注册可读事件（Client连接客户端成功后）</p>
<p><strong>第二步</strong>：提供服务：client 发送请求，Selector中对注册状态及客户端可读性验证，正常情况下，已通过第一步，所以直接连接到处理器进行读写操作，根据需求执行业务逻辑，并响应给客户；</p>
<p><strong>第三步</strong> ：客户端连接可读，在向client响应客户端请求后，注册连接可读事件到Selector 中，所注册的是具体执行业务的Handler</p>
<h3 id="6、NIO网络模型优化"><a href="#6、NIO网络模型优化" class="headerlink" title="6、NIO网络模型优化"></a>6、NIO网络模型优化</h3><ol>
<li><strong>非阻塞IO模型</strong>，服务器端提供一个单线程的selector来统一管理所有客户端接入的连接，并负责监听每个连接所关心的事件</li>
<li><strong>弹性伸缩能力加强</strong>，服务器端一个线程处理所有客户端的连接请求，客户端的个数与服务器端的线程数呈M比1的关系</li>
<li><strong>单线程节省资源</strong>,避免了线程的频繁创建和销毁，同时也避免了多个线程之间上下文的切换，提高了执行效率</li>
</ol>
<h2 id="二、NIO网络编程详解"><a href="#二、NIO网络编程详解" class="headerlink" title="二、NIO网络编程详解"></a>二、NIO网络编程详解</h2><p><strong>NIO核心</strong></p>
<ul>
<li><strong>Channel：通道</strong></li>
<li><strong>Buffer ： 缓冲区</strong></li>
<li><strong>Selector : 选择器 或 多路复用器</strong></li>
</ul>
<h3 id="1、NIO核心类之Channel"><a href="#1、NIO核心类之Channel" class="headerlink" title="1、NIO核心类之Channel"></a>1、NIO核心类之Channel</h3><blockquote>
<p><strong>Channel</strong> 具有<strong>双向性、非阻塞性、操作唯一性。</strong></p>
</blockquote>
<p>channel是信息传输的通道，是jdk NIO中对输入输出方法的另一种抽象，类比IO中的流，与流不同之处在于，channel具有双向性，而流是单向传输的，一个流必须是InputStream或OutputStream的子类，而通道可以用于读写或二者同时进行。channel可以工作在非阻塞模式下，构成NIO的基础。在NIO中，操作channel的唯一方式是使用buffer，通过buffer操作channel，实现数据块的传输。</p>
<p><strong>channel的实现：</strong> </p>
<blockquote>
<ol>
<li>文件类：FileChannel，用于对文件的读写</li>
<li>UDP类：DatagramChannel， 用于UDP的数据读写</li>
<li>TCP类：ServerSocketChannel/SocketChannel，用于TCP的数据读写</li>
</ol>
</blockquote>
<p><strong>Socket的使用：</strong> </p>
<p><strong>服务端：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 监听窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8000</span>);</span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="comment">// 2. 接受请求、建立链接</span></span><br><span class="line">			Socket socket = serverSocket.accept();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 3.数据交换</span></span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> BIOServerHandler(socket)).start();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 *  4. 关闭资源</span></span><br><span class="line"><span class="comment">		 * */</span></span><br><span class="line">		serverSocket.close();</span><br></pre></td></tr></table></figure>

<p><strong>客户端：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  1.建立链接</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">Socket socket = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>,<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  获取输入输出流</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">InputStream inputStream = socket.getInputStream();</span><br><span class="line">OutputStream outputStream = socket.getOutputStream();</span><br></pre></td></tr></table></figure>

<p><strong>Channel的使用：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  代码片段1: 服务器端通过服务端socket创建channel</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  代码片段2: 服务器端通绑定端口</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">serverSocketChannel.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8000</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  代码片段3: 服务器端监听客户端链接，建立socketChannel链接</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">SocketChannel socketChannel = serverSocketChannel.accept(<span class="string">"127.0.0.1"</span>,<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  代码片段4: 客户端链接远程主机及端口</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">SocketChannel socketChannel = SocketChannel.open(<span class="keyword">new</span> InetSocketAddress(<span class="string">""</span>))</span><br></pre></td></tr></table></figure>

<h3 id="2、NIO核心类之Buffer"><a href="#2、NIO核心类之Buffer" class="headerlink" title="2、NIO核心类之Buffer"></a>2、NIO核心类之Buffer</h3><p><strong>Buffer</strong>：缓冲区，它提供唯一与channel进行交互的方式，作用是读写channel中的数据。Buffer从本质上说是一块内存区域，它是一块可以写入数据，读取数据的内存。</p>
<p><strong>Buffer的属性</strong></p>
<blockquote>
<p><strong>Capacity</strong>：分配的buffer容量，一旦写入的最大字节数超过这个容量，需要将其清空之后，才能继续往里面写数据</p>
<p><strong>Position</strong>：当前操作的位置，初始值为0，最大值：容量值-1</p>
<p><strong>Limit</strong>：上限，写模式下等于Capacity，读模式下等于最多能读取的数据</p>
<p><strong>Mark</strong>：标记，记录mark的位置，调用reset方法时position会回到mark的位置</p>
</blockquote>
<p><strong>Buffer的使用：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 初始化长度为10的byte类型 buffer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ByteBuffer.allocate(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu78.png" width="60%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 向byteBuffer中写入三个字节</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">byteBuffer.put(<span class="string">"abc"</span>.getBytes(Charset.forName(<span class="string">"UTF-8"</span>)));</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu79.png" width="60%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 将byteBuffer从写模式切换成读模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">byteBuffer.flip():</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu80.png" width="60%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 将b先调用get方法读取下一个字节</span></span><br><span class="line"><span class="comment"> * 再调用reset方法将position重置到mark位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">byteBuffer.get():</span><br><span class="line">byteBuffer.reset();</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu81.png" width="60%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 调用clear方法，将所有属性重置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">byteBuffer.clear();</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu82.png" width="60%">

<h3 id="3、NIO核心类之Selector"><a href="#3、NIO核心类之Selector" class="headerlink" title="3、NIO核心类之Selector"></a>3、NIO核心类之Selector</h3><p><strong>Selector 选择器/多路复用器</strong></p>
<p><strong>作用</strong>：I/O就绪选择</p>
<p><strong>地位</strong>：NIO网络编程的基础</p>
<p><strong>SelectionKey 选择键</strong></p>
<blockquote>
<p>四种就绪状态常量：<strong>连接就绪、接受就绪、读就绪、写就绪</strong></p>
</blockquote>
<p><strong>Selector的使用：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * 代码片段1:创建 Selector </span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"> Selector  selector =  Selector.open();</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 代码片段2：将channel注册到selector上，监听读取就绪事件</span></span><br><span class="line"><span class="comment"> * */</span> </span><br><span class="line"> SelectionKey selectionKey = channel.register(SelectionKey.OP_READ);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 代码片段3：阻塞等待channel有就绪事件发生</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line"> <span class="keyword">int</span> selectNum = selector.select();</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 代码片段4：获取发生就绪事件的channel集合</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line"> Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br></pre></td></tr></table></figure>



<p><strong>最重要的应该就是代码片段3：</strong> 在这一步对就绪事件进行监听，如果一直不通过，就一直阻塞等待，直到有就绪事件发生，并注册通过检测有效，方才放行 </p>
<h3 id="4、NIO编程实现步骤"><a href="#4、NIO编程实现步骤" class="headerlink" title="4、NIO编程实现步骤"></a>4、NIO编程实现步骤</h3><blockquote>
<p>第一步：创建Selector</p>
<p>第二步：创建ServerSocketChannel，并绑定监听端口</p>
<p>第三步：将Channel设置为非阻塞模式</p>
<p>第四步：将Channel注册到Selector上，监听连接事件</p>
<p>第五步：循环调用Selector的select方法，检测就绪情况</p>
<p>第六步：调用selectedKeys方法获取就绪channel集合</p>
<p>第七步：判断就绪事件种类，调用业务处理方法</p>
<p>第八步：根据业务需要决定是否再次注册监听事件，重复执行第三步操作</p>
</blockquote>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo搭建个人博客（一）博客框架搭建</title>
    <url>/2020/03/09/hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%88%E4%B8%80%EF%BC%89%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<p><strong>前言</strong>：作为一个技术宅，怎么能够没有自己的个人Blog呢，自己搭建博客，一来可以用来作为学习的记录，二来将来面试的时候抛出自己满满的博客，那可是加分项呀，三来最次也可以用来装装X嘛</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">实验环境:win10</span><br><span class="line">前期准备：安装好git和node.js（自行百度下载git和nedo.js）</span><br></pre></td></tr></table></figure>

<hr>
<p>好，话不多说，开始动手</p>
<p>终端中输入 node -v 和git 分别出现以下界面，则安装正确（我使用的终端是cmder完整版，可以在win下使用linux的命令）</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu100.png" width="60%">

<p>上面这张图显示的是我安装node的版本 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu101.png" width="80%">

<hr>
<p>上面的步骤完成之后，接下来就可以开始安装hexo了</p>
<p>首先介绍下npm，这是一个包管理器，接下来的安装都和这个命令有关，但由于众所周知的原因，国内速度很慢，所以我们进行一个镜像源更改，改到淘宝的源，利用npm安装一个cnpm包管理器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry&#x3D;https:&#x2F;&#x2F;registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>替换成功之后cnpm就安装完成了，接下来开始正式安装hexo，用以下命令安装</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>hexo安装完成之后可以使用  hexo - v 命令验证下是否安装成功，成功的话就能够得到以下这个界面 </p>
<p><img src="https://img2018.cnblogs.com/blog/1502090/201905/1502090-20190526232835559-905739455.png" alt="img"></p>
<hr>
<p>接下来，选择一个盘新建一个文件夹，取名为blog(如果你和我一样是使用cmder的话，直接可以用mkdir命令)</p>
<p>然后终端进入这个blog文件夹，运行以下命令初始化</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>

<p>完成之后会在blog文件夹下生成一些文件，到这一步，hexo的初始化就已经完成了</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu103.png" width="80%">

<p> 安装依赖</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cnpm install</span><br></pre></td></tr></table></figure>

<p> 这时候我们启动hexo博客，运行以下命令，然后在你的浏览器中输入 localhost:4000</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">这个命令默认的是使用4000端口，如果没有错误的话，你可以使用 localhost:4000 在你的浏览器中预览你的博客</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">但是有些人的电脑4000端口可能被占用什么的，这个时候　你可以使用以下命令</span><br><span class="line">hexo  s -p 5555　　&#x2F;&#x2F;指定5555端口</span><br></pre></td></tr></table></figure>

<p>此时hexo的基本布置完成了</p>
<hr>
<p>接下来要做的就是把博客部署到github上去</p>
<p>首先你要有个github账号，注册账号省略</p>
<p>然后你要创建一个仓库，仓库名字严格要求为 ： 你的用户名.github.io      </p>
<p>接下来打开的你的blog文件夹，推荐使用sublime，编辑 _config.yml 文件 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu104.png" width="80%">

<p> 配置如上图所示，repo 配置为你的github仓库的地址 ，下图中的地址 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu105.png" width="80%">

<p>保存更改，打开终端，进入blog文件夹路径，把博客部署到远端</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>



<p>这个时候可能报错，如：（xxxxx为你的github  ID）</p>
<h2 id="fatal-unable-to-access-‘https-github-com-xxxxxx-xxxxxx-github-io-git"><a href="#fatal-unable-to-access-‘https-github-com-xxxxxx-xxxxxx-github-io-git" class="headerlink" title="fatal: unable to access ‘https://github.com/xxxxxx/xxxxxx.github.io.git"></a>fatal: unable to access ‘<a href="https://github.com/xxxxxx/xxxxxx.github.io.git" target="_blank" rel="noopener">https://github.com/xxxxxx/xxxxxx.github.io.git</a></h2><p>这是因为git没有配置好原因，你可以把上面的 repo 的库地址配置为  </p>
<h2 id="https-用户名：密码-github-com-xxxxxx-xxxxxx-github-io-git"><a href="#https-用户名：密码-github-com-xxxxxx-xxxxxx-github-io-git" class="headerlink" title="https://用户名：密码@github.com/xxxxxx/xxxxxx.github.io.git"></a>https://用户名：密码@github.com/xxxxxx/xxxxxx.github.io.git</h2><p>完成之后刷新你的github仓库，就会发现仓库不是空的了。</p>
<p>然后在浏览器中输入     你的用户名.github.io   就能够访问你的博客了</p>
<hr>
<p>  总结：到此，个人博客就搭建完成了，不过此时的主题是hexo默认的主题，后续可以自己查找资料换主题</p>
<p><strong>注：转载自</strong>：<a href="https://www.cnblogs.com/hztjiayou/p/10928410.html" target="_blank" rel="noopener">https://www.cnblogs.com/hztjiayou/p/10928410.html</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>个人博客搭建</tag>
      </tags>
  </entry>
  <entry>
    <title>Activity-（三）创建流程引擎ProcessEngine</title>
    <url>/2020/03/08/Activity-%EF%BC%88%E4%B8%89%EF%BC%89%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8EProcessEngine/</url>
    <content><![CDATA[<h3 id="1、创建并设置Maven-项目"><a href="#1、创建并设置Maven-项目" class="headerlink" title="1、创建并设置Maven 项目"></a>1、创建并设置Maven 项目</h3><p>创建一个<code>$quickStartJavaProjectName</code>具有以下Maven依赖项的Java项目“ plush-activiti”（以后称为）： </p>
<p>文件：$ mvnProject / pom.xml </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- druid --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- mysql --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.30&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.16.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- logback --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.8&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.8&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.22&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;activiti-engine&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.22.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;pluginManagement&gt;&lt;!-- <span class="function">lock down plugins versions to avoid using Maven <span class="title">defaults</span> <span class="params">(may be moved to parent pom)</span> --&gt;</span></span><br><span class="line"><span class="function">            &lt;plugins&gt;</span></span><br><span class="line"><span class="function">                &lt;plugin&gt;</span></span><br><span class="line"><span class="function">                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="function">                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="function">                    &lt;configuration&gt;</span></span><br><span class="line"><span class="function">                        &lt;source&gt;1.8&lt;/source&gt;</span></span><br><span class="line"><span class="function">                        &lt;target&gt;1.8&lt;/target&gt;</span></span><br><span class="line"><span class="function">                    &lt;/configuration&gt;</span></span><br><span class="line"><span class="function">                &lt;/plugin&gt;</span></span><br><span class="line"><span class="function">            &lt;/plugins&gt;</span></span><br><span class="line"><span class="function">        &lt;/pluginManagement&gt;</span></span><br><span class="line"><span class="function">    &lt;/build&gt;</span></span><br></pre></td></tr></table></figure>

<p>请注意以下依赖性：</p>
<ul>
<li>Activiti（org.activiti）– Activiti的BPM引擎</li>
<li>数据库（mysql）– mysql数据库</li>
<li>日志记录（org.slf4j）– Java的简单日志记录外观</li>
</ul>
<p>当引用构建目录时，假定您的maven项目的标准Maven构建路径： </p>
<table>
<thead>
<tr>
<th>路径</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>$mvnProject</code>/ src / main / java</td>
<td>Java源目录</td>
</tr>
<tr>
<td><code>$mvnProject</code>/ src / main / resources</td>
<td>资源目录</td>
</tr>
<tr>
<td><code>$mvnProject</code>/ src / test / java</td>
<td>Java测试目录</td>
</tr>
<tr>
<td><code>$mvnProject</code>/ src / test / resources</td>
<td>资源测试目录</td>
</tr>
</tbody></table>
<p>您应该能够构建空白项目。在继续之前，请确保总体状态为“ BUILD SUCCESS”。 </p>
<hr>
<p>命令：mvn编译 </p>
<p>基本路径：$ mvnProject </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]                                                                         </span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Building $quickStartJavaProjectName 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ plush-activiti ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ HelloProcess2 ---</span><br><span class="line">[INFO] Nothing to compile - all classes are up to date</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 0.592s</span><br><span class="line">[INFO] Finished at: Sun Nov 27 05:09:59 EST 2020</span><br><span class="line">[INFO] Final Memory: 10M&#x2F;309M</span><br><span class="line">[INFO] -----------------------------</span><br></pre></td></tr></table></figure>

<p>*<em>笔记： *</em></p>
<ul>
<li>您的输出可能看起来有所不同。最值得注意的是，maven可能需要检索项目依赖项。</li>
</ul>
<hr>
<h3 id="2、添加log4j-日志文件"><a href="#2、添加log4j-日志文件" class="headerlink" title="2、添加log4j 日志文件"></a>2、添加log4j 日志文件</h3><p><strong>两种配置内容（效果一致）：</strong></p>
<p>文件：$ mvnProject / src / main / resources / log4j.properties </p>
<p>第一种：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, ACT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.ACT</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.ACT.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.ACT.layout.ConversionPattern</span>= <span class="string">%d&#123;hh:mm:ss,SSS&#125; [%t] %-5p %c %x - %m%n</span></span><br></pre></td></tr></table></figure>

<p>第二种：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml</span> <span class="string">version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;configuration</span> <span class="string">scan="true" scanPeriod="60 seconds"&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;appender</span> <span class="string">name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;</span></span><br><span class="line">        <span class="attr">&lt;encoder&gt;</span></span><br><span class="line">            <span class="meta">&lt;pattern&gt;%d&#123;yyyy-MM-dd</span> <span class="string">HH:mm:ss.SSS&#125; [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;</span></span><br><span class="line">        <span class="attr">&lt;/encoder&gt;</span></span><br><span class="line">    <span class="attr">&lt;/appender&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;!--&lt;appender</span> <span class="string">name="permission" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--&lt;file&gt;$&#123;catalina.home&#125;/logs/permission.log&lt;/file&gt;--&gt;</span></span><br><span class="line">    <span class="meta">&lt;!--&lt;rollingPolicy</span> <span class="string">class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--&lt;FileNamePattern&gt;$&#123;catalina.home&#125;/logs/permission.%d&#123;yyyy-MM-dd&#125;.log.gz&lt;/FileNamePattern&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--&lt;/rollingPolicy&gt;--&gt;</span></span><br><span class="line">    <span class="meta">&lt;!--&lt;layout</span> <span class="string">class="ch.qos.logback.classic.PatternLayout"&gt;--&gt;</span></span><br><span class="line">    <span class="meta">&lt;!--&lt;pattern&gt;%d&#123;yyyy-MM-dd</span> <span class="string">HH:mm:ss.SSS&#125; [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--&lt;/layout&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--&lt;/appender&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!----&gt;</span></span><br><span class="line">    <span class="meta">&lt;!--&lt;logger</span> <span class="string">name="xxx" level="INFO"&gt;--&gt;</span></span><br><span class="line">    <span class="meta">&lt;!--&lt;appender-ref</span> <span class="string">ref="permission"/&gt;--&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--&lt;/logger&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;!--</span> <span class="string">TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR --&gt;</span></span><br><span class="line">    <span class="meta">&lt;root</span> <span class="string">level="INFO"&gt;</span></span><br><span class="line">        <span class="meta">&lt;appender-ref</span> <span class="string">ref="STDOUT"/&gt;</span></span><br><span class="line">    <span class="attr">&lt;/root&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、创建流程引起对象"><a href="#3、创建流程引起对象" class="headerlink" title="3、创建流程引起对象"></a>3、创建流程引起对象</h3><p><code>用空白的main创建一个新的Java类。</code></p>
<hr>
<p><code>文件：$ mvnProject / src / main / java / com / webcode/ activiti_create.java</code></p>
<p><strong>3.1</strong> 添加到主入口点的是流程引擎的创建。如下所示添加到<strong>activiti_create</strong>.java中： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; &#123;</span><br><span class="line">    <span class="comment">// 创建流程引擎配置信息对象</span></span><br><span class="line">    ProcessEngineConfiguration pec = ProcessEngineConfiguration</span><br><span class="line">            .createStandaloneProcessEngineConfiguration();</span><br><span class="line">    <span class="comment">// 设置数据库的类型</span></span><br><span class="line">    pec.setDatabaseType(<span class="string">"mysql"</span>);</span><br><span class="line">    <span class="comment">// 设置创建数据库的方式</span></span><br><span class="line">    pec.setDatabaseSchemaUpdate(<span class="string">"true"</span>);</span><br><span class="line">    <span class="comment">// 设置数据库驱动</span></span><br><span class="line">    pec.setJdbcDriver(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">    <span class="comment">// 设置jdbcURL</span></span><br><span class="line">    pec.setJdbcUrl(<span class="string">"jdbc:mysql://49.234.197.103:3306/activiti-explorer?useUnicode=true&amp;characterEncoding=UTF-8"</span>);</span><br><span class="line">    <span class="comment">// 设置用户名</span></span><br><span class="line">    pec.setJdbcUsername(<span class="string">"root"</span>);</span><br><span class="line">    <span class="comment">// 设置密码</span></span><br><span class="line">    pec.setJdbcPassword(<span class="string">"wushaopei"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建流程引擎对象</span></span><br><span class="line">    ProcessEngine pe = pec.buildProcessEngine(); <span class="comment">// 调用访方法才会创建数据表</span></span><br><span class="line">    </span><br><span class="line">    String pName = pe.getName();</span><br><span class="line">    String ver = ProcessEngine.VERSION;</span><br><span class="line">    System.out.println(<span class="string">"ProcessEngine ["</span> + pName + <span class="string">"] Version: ["</span> + ver + <span class="string">"]"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用close方法时，才会删除</span></span><br><span class="line">    pe.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.2</strong> 也可以通过 引入<strong>Activiti</strong>配置文件<strong>activiti.cfg.xml</strong> 的方式来创建流程引擎实例；</p>
<p>创建<strong>activiti.cfg.xml</strong>配置：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml</span> <span class="string">version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;beans</span> <span class="string">xmlns="http://www.springframework.org/schema/beans"</span></span><br><span class="line">       <span class="attr">xmlns</span>:<span class="string">xsi="http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       <span class="attr">xsi</span>:<span class="string">schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="meta">&lt;bean</span> <span class="string">id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">&lt;property</span> <span class="string">name="jdbcUrl" value="jdbc:mysql://49.234.197.103:3306/activiti-explorer" /&gt;</span></span><br><span class="line">    <span class="meta">&lt;property</span> <span class="string">name="jdbcDriver" value="com.mysql.jdbc.Driver" /&gt;</span></span><br><span class="line">    <span class="meta">&lt;property</span> <span class="string">name="jdbcUsername" value="root" /&gt;</span></span><br><span class="line">    <span class="meta">&lt;property</span> <span class="string">name="jdbcPassword" value="wushaopei" /&gt;</span></span><br><span class="line">    <span class="meta">&lt;property</span> <span class="string">name="databaseSchemaUpdate" value="true" /&gt;</span></span><br><span class="line">  <span class="attr">&lt;/bean&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">&lt;/beans&gt;</span></span><br></pre></td></tr></table></figure>

<p>流程引擎创建实例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用xml配置 简化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;&#123;</span><br><span class="line">    <span class="comment">// 引擎配置</span></span><br><span class="line">    ProcessEngineConfiguration pec=ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">"activiti.cfg.xml"</span>);</span><br><span class="line">    <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">    ProcessEngine processEngine=pec.buildProcessEngine();</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">       String pName = processEngine.getName();</span><br><span class="line">       String ver = ProcessEngine.VERSION;</span><br><span class="line">       System.out.println(<span class="string">"ProcessEngine ["</span> + pName + <span class="string">"] Version: ["</span> + ver + <span class="string">"]"</span>);</span><br><span class="line">       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>使用xml配置会简化很多东西，而且在正规情况下的项目都是使用这种读取.XMl配置文件的方式。 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu63.png" width="60%">

<p>之前生成Activiti25张表是使用Java类生成的，但是在实际的开发中是使用activiti.cfg.xml配置文件生成。</p>
<p>官方文档参考地址：<a href="http://activiti.org/userguide/index.html#configuration" target="_blank" rel="noopener">http://activiti.org/userguide/index.html#configuration</a> （英文看不懂可以用谷歌浏览器翻译功能）</p>
<h3 id="4、打包配置"><a href="#4、打包配置" class="headerlink" title="4、打包配置"></a>4、打包配置</h3><p><code>文件：$ mvnProject / pom.xml</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">...</span><br><span class="line">  &lt;build&gt;</span><br><span class="line">...</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">...</span><br><span class="line">      &lt;!-- Maven Assembly Plugin --&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.4.1&lt;/version&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;!-- get all project dependencies --&gt;</span><br><span class="line">          &lt;descriptorRefs&gt;</span><br><span class="line">            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span><br><span class="line">          &lt;/descriptorRefs&gt;</span><br><span class="line">          &lt;!-- MainClass in mainfest make a executable jar --&gt;</span><br><span class="line">          &lt;archive&gt;</span><br><span class="line">            &lt;manifest&gt;</span><br><span class="line">              &lt;mainClass&gt;com.example.OnboardingRequest&lt;/mainClass&gt;</span><br><span class="line">            &lt;/manifest&gt;</span><br><span class="line">          &lt;/archive&gt;</span><br><span class="line">        &lt;/configuration&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;make-assembly&lt;/id&gt;</span><br><span class="line">            &lt;!-- bind to the packaging phase --&gt;</span><br><span class="line">            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;single&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">...</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">...</span><br><span class="line">  &lt;/build&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>通过运行“ <strong>mvn package</strong>”来打包代码。 </p>
<p>启动 .jar 包命令：  </p>
<blockquote>
<p><strong>命令：java -jar target / ActivitiDeveloperQuickStart-0.0.1-SNAPSHOT-jar-with-dependencies.jar</strong></p>
<p><strong>-要么-</strong></p>
<p><strong>java -jar target / $ quickStartJavaProjectName-0.0.1-SNAPSHOT-jar-with-dependencies.jar</strong></p>
</blockquote>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot基础（五）项目打包</title>
    <url>/2020/03/08/SpringBoot%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%94%EF%BC%89%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E3%80%81%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="1、Spring-Boot-项目打包"><a href="#1、Spring-Boot-项目打包" class="headerlink" title="1、Spring Boot 项目打包"></a>1、Spring Boot 项目打包</h3><p><strong>打包方式：</strong> </p>
<blockquote>
<p>构建 JAR 包</p>
<p>构建 WAR 包</p>
<p>指定 Main-Class</p>
</blockquote>
<p><strong>（1）右击工程名  “copy path” 获取工程路径，到 cmd.exe 命令行中进入该目录下，输入</strong> </p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mvn -Dmaven.test.skip -U clean <span class="keyword">package</span></span><br></pre></td></tr></table></figure>

<p>命令执行打包操作，</p>
<p>此时执行过程会发生报错，因为 在进行多模块拆分后，需要重新为工程指定 main.class ，也就是 springboot 的启动器入口的位置的明确。这是由于在拆分过后，在父工程下找不到main.class 。</p>
<p>解决方法：</p>
<p>将父工程的pom.xml 中的 <build></build>依赖驱动剪切到 web 子模块中 ，然后再到修改后的web子模块的 pom.xml 中的   <build></build> 中的<plugin></plugin>添加一个 <configuration/>,并为其配置一个<mainClass/>，将 springboot入口启动器的 Reference 路径复制并放入到 <mainClass>中，然后执行打包就可以了。</p>
<p>注意： 不要把<build/>放在父工程的pom.xml 下进行打包，那样会有很多错误要进行修正，而且由于主启动器迁移到 了web 中，在父工程下 添加<build/>意义不大</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu61.png" width="60%">

<p><strong>（2）在 cmd 命令行中启动 jar 包 或者 war 包 的方式：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -jar web-<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT.jar</span><br><span class="line">或者</span><br><span class="line">java -jar web-<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT.war</span><br></pre></td></tr></table></figure>

<p>注意： 要在 当前工程打成 war 包，需要在 web 的mian 目录下创建 “webapp” 和  “WEB-INF”两个目录，并在 “WEB-INF” 目录下创建 一个 web.xml 文件 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu62.png" width="60%">

<h3 id="2、Spring-Boot-运行模式"><a href="#2、Spring-Boot-运行模式" class="headerlink" title="2、Spring Boot 运行模式"></a>2、Spring Boot 运行模式</h3><p><strong>Springboot</strong>项目的3种运行模式：</p>
<p><strong>idea</strong>方式，<strong>jar</strong>/<strong>war</strong>方式，<strong>maven</strong>插件方式</p>
<blockquote>
<p>（1）如果是在开发过程中，会使用<strong>idea</strong>方式</p>
<p>（2）如果是在线上的服务器上，会使用<strong>jar/war</strong>方式，作为启动脚本</p>
<p>（3）如果开发环境是Linux环境，会使用<strong>maven</strong>插件方式。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot入门</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot框架（一）整合ApacheShiro权限管理框架</title>
    <url>/2020/03/08/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E4%B8%83%EF%BC%89%E6%95%B4%E5%90%88ApacheShiro%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h3 id="1、Spring-Security-权限管理框架介绍"><a href="#1、Spring-Security-权限管理框架介绍" class="headerlink" title="1、Spring Security 权限管理框架介绍"></a>1、Spring Security 权限管理框架介绍</h3><p><strong>简介</strong>： Spring Security 提供了基于javaEE的企业应有个你软件全面的安全服务。这里特别强调支持使用SPring框架构件的项目，Spring框架是企业软件开发javaEE方案的领导者。 </p>
<blockquote>
<p>Spring Security 的两个目标： <strong>“认证”</strong> 与<strong>“授权”</strong>。 </p>
</blockquote>
<ul>
<li>“<strong>认证</strong>”，是建立一个他声明的主题的过程（一个“主体”一般是指用户，设备或一些可以在你的应用程序中执行动作的其他系统）。</li>
<li>“<strong>授权</strong>” 指确定一个主体是否允许在你的应用程序执行一个动作的过程。为了抵达需要授权的店，主体的身份已经有认证过程建立。这个概念是通用的而不只在Spring Security中。</li>
</ul>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu49d.png" width="60%">

<p>​    在SpringSecurity 中，请求进入后会被拦截器拦截到，并交由认证管理器首先处理；这是在身份验证层，Spring Security  的支持多种认证模式。包括 Basic、Digest、X.509、LDAP、Form（基于表单的认证） 等多种HTTP 认证。 </p>
<p><strong>浅析：</strong></p>
<blockquote>
<p><strong>Basic 认证</strong>：在HTTP1.0提出的认证方法，针对特定的用户和资源，需要提供特定的密码认证后方可访问，其中密码是使用明文传输的；一个请求到来时，浏览器弹出对话框，让用户输入用户名和密码，并用BASE 64 进行编码进行传输，服务器接受并解析这些信息，并认证通过，才会允许继续访问。</p>
</blockquote>
<blockquote>
<p><strong>Digest认证</strong>： 解决Basic 认证的安全问题，当访问时，浏览器依旧弹出对话框，让用户输入用户名和密码，浏览器会对用户名、密码、HTTP请求方法、被请求资源的URI进行组合后进行MD5运算，然后把计算得到的摘要信息发送给服务器；服务器获取报文头部相关认证信息后获取到 username ,同时获取到密码，同样对用户名、密码、HTTP请求方法、被请求资源的URI进行组合后和 response 进行比较，如果相同，才算认证通过。</p>
</blockquote>
<h3 id="2、Spring-Security-常用权限拦截器："><a href="#2、Spring-Security-常用权限拦截器：" class="headerlink" title="2、Spring Security 常用权限拦截器："></a>2、Spring Security 常用权限拦截器：</h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu50.png" width="60%">

<p>主要功能性拦截器有 11 个， FilterChainProxy 对拦截器进行过滤操作并代理执行！ </p>
<h3 id="3、Spring-Security-项目-Demo"><a href="#3、Spring-Security-项目-Demo" class="headerlink" title="3、Spring Security 项目 Demo"></a>3、Spring Security 项目 Demo</h3><p>（1）环境搭建及使用 </p>
<blockquote>
<ol>
<li>基于Spring Boot + Spring Security 环境</li>
<li>常用 Case 实现</li>
</ol>
</blockquote>
<p>（2）创建SpringBoot 工程 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu51.png" width="60%">

<p>（3）整合SpringSecurity 依赖 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">       <span class="comment">&lt;!--springsecurity 主要依赖--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（4）主启动类配置： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>          <span class="comment">//返回响应体为json</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>  <span class="comment">//扫描Bean注入到容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bootstrap</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Bootstrap<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>) <span class="comment">// 测试接口</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">home</span> <span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"hello spring boot"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>) <span class="comment">//测试接口</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span> <span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"hello spring boot"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（5）配置 Servlet 初始化 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> ServletInitializer 告诉程序，项目启动时从 Bootstrap 开始</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/9/19 10:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(Bootstrap<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（6）启动SpringBoot 项目- - run 主启动类： </p>
<blockquote>
<p>启动SpringBoot 项目进行接口访问时，弹出登录界面，说明SpringSecurity生效了 </p>
</blockquote>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu52.png" width="60%">

<h3 id="4、SpringSecurity拦截配置："><a href="#4、SpringSecurity拦截配置：" class="headerlink" title="4、SpringSecurity拦截配置："></a>4、SpringSecurity拦截配置：</h3><p><strong>注意</strong>：在 3  的基础上，对工程进一步配置： </p>
<p>（1）创建 SpringSecurityConfig 类管理 拦截配置： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>     <span class="comment">// 将Bean 放到容器中管理</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span> <span class="comment">// 用于将Security 生成 Bean </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 接口请求拦截</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.authorizeRequests()  <span class="comment">//安全请求策略</span></span><br><span class="line">                .antMatchers(<span class="string">"/"</span>).permitAll() <span class="comment">//可放行请求配置</span></span><br><span class="line">                .anyRequest().authenticated()    <span class="comment">//其他请求进行拦截</span></span><br><span class="line">                .and()</span><br><span class="line">                .logout().permitAll()  <span class="comment">// 注销任意访问</span></span><br><span class="line">                .and()</span><br><span class="line">                .formLogin();</span><br><span class="line">        http.cors().disable();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *  前端拦截</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 忽视 js 、css 、 images 后缀访问</span></span><br><span class="line">        web.ignoring().antMatchers(<span class="string">"/js/**"</span>,<span class="string">"/css/**"</span>,<span class="string">"/images/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该 <strong>SpringSecurityConfig</strong> 继承 <strong>WebSecurityConfigurerAdapter</strong> 类，并重写 <strong>configure(HttpSecurity http)</strong>和 <strong>configure（WebSecurity web）</strong>两个方法，分别针对 接口请求 和 静态页面 资源进行拦截。</p>
<blockquote>
<p><strong>接口请求</strong>： ip:port/  的请求一律通过，主要进入到 Bootstrap 中的 RequestMapping(“/”)接口中；并对 “/”后带有标识地址的请求进行拦截认证； </p>
</blockquote>
<blockquote>
<p><strong>静态资源</strong>： 此处对静态 js 、css、images 三者进行放行。 </p>
</blockquote>
<p>效果截图： </p>
<blockquote>
<p>配置 SpringSecurity 后，默认可以通过 “/” 的接口请求； 而当进行 如“/hello”接口请求时会被拦截进行验证 </p>
</blockquote>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu53.png" width="60%">

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu54.png" width="60%">

<h3 id="5、基于SpringSecurity-权限管理-Case-实操"><a href="#5、基于SpringSecurity-权限管理-Case-实操" class="headerlink" title="5、基于SpringSecurity 权限管理 Case 实操"></a>5、基于SpringSecurity 权限管理 Case 实操</h3><p><strong>权限管理 Case 的需求有两个要求：</strong> </p>
<blockquote>
<ol>
<li><strong>第一点</strong> ：只要能登录即可；</li>
<li><strong>第二点</strong>：有指定的角色，每个角色有指定的权限.</li>
</ol>
</blockquote>
<p>（1）只要能登录即可，功能体现： </p>
<p>在SpringSecurityConfig.java中配置用户信息： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  告诉程序，系统中有个用户 用户名为 admin ,密码为 admin  角色为 ADMIN</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">"admin"</span>).password(<span class="string">"admin"</span>).roles(<span class="string">"ADMIN"</span>);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意 ：</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">在springboot使用spring security 做权限管理 ，使用内存用户验证，会返回无响应报错：</span><br><span class="line">java.lang.IllegalArgumentException: There is no PasswordEncoder mapped for the id &quot;null&quot;</span><br></pre></td></tr></table></figure>

<p><strong>解决方法：</strong> </p>
<blockquote>
<p>这是因为Spring boot 2.0.3引用的security 依赖是 spring security 5.X版本，此版本需要提供一个PasswordEncorder的实例，否则后台汇报错误：</p>
<p>java.lang.IllegalArgumentException: There is no PasswordEncoder mapped for the id “null”<br>并且页面毫无响应。<br>因此，需要创建PasswordEncorder的实现类。</p>
</blockquote>
<p>创建PasswordEncorder 实体类后可通过<strong>两种方式</strong>完成明文验证通过：</p>
<p><strong>第一种</strong>：直接在配置好的 PasswordEncorder 类上添加 @Component 装配 MyPasswordEncoder 为Bean 注入到容器即可；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPasswordEncoder</span> <span class="keyword">implements</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence charSequence)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> charSequence.toString();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence charSequence, String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s.equals(charSequence.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后继续使用 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  *  告诉程序，系统中有个用户 用户名为 admin ,密码为 admin  角色为 ADMIN</span></span><br><span class="line"><span class="comment">  * */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//可以设置内存指定的登录的账号密码,指定角色</span></span><br><span class="line">      <span class="comment">//不加.passwordEncoder(new MyPasswordEncoder())或者注入该类的Bean</span></span><br><span class="line">      <span class="comment">//就不是以明文的方式进行匹配，会报错</span></span><br><span class="line">      auth.inMemoryAuthentication().withUser(<span class="string">"admin"</span>).password(<span class="string">"admin"</span>).roles(<span class="string">"ADMIN"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>进行 密码明文登录，可以成功 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu55.png" width="60%">

<p><strong>第二种</strong>：在auth.inMemoryAuthentication()后面使用<em>.passwordEncoder(new MyPasswordEncoder())**对登录信息进行包装后提交即可；这样也可以成功</em></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这样，页面提交时候，密码以明文的方式进行匹配。</span></span><br><span class="line">auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> MyPasswordEncoder()).withUser(<span class="string">"wsp"</span>).password(<span class="string">"wsp"</span>).roles(<span class="string">"ADMIN"</span>);</span><br></pre></td></tr></table></figure>

<p><strong>推荐</strong>： 最好是使用第一种 装载成 Bean 后注入容器，对于开发效率更高，也更便捷。</p>
<p>（2）有指定的角色，每个角色有指定的权限，功能体现：</p>
<p>① 创建接口 role1() 并对其添加 @PreAuthorize(<strong>“hasRole(‘ROLE_ADMIN’)”</strong>)  以进行角色拦截</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize</span>(<span class="string">"hasRole('ROLE_ADMIN')"</span>) <span class="comment">// 角色拦截校验注解</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/roleAuth"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">role1</span><span class="params">()</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">return</span> <span class="string">"roleAuth"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（2）角色拦截 - -</strong> 功能解析： </p>
<p> @PreAuthorize(<strong>“hasRole(‘ROLE_ADMIN’)”</strong>) 注解说明： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu56.png" width="60%">

<p>②并在 SpringSecurityConfig.java 中创建新用户，以提供测试： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//可以设置内存指定的登录的账号密码,指定角色</span></span><br><span class="line">        <span class="comment">//不加.passwordEncoder(new MyPasswordEncoder())</span></span><br><span class="line">        <span class="comment">//就不是以明文的方式进行匹配，会报错</span></span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">"admin"</span>).password(<span class="string">"admin"</span>).roles(<span class="string">"ADMIN"</span>);</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">"demo"</span>).password(<span class="string">"demo"</span>).roles(<span class="string">"DEMO"</span>);</span><br><span class="line">        .passwordEncoder(<span class="keyword">new</span> MyPasswordEncoder())。</span><br><span class="line">        <span class="comment">//这样，页面提交时候，密码以明文的方式进行匹配。</span></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> MyPasswordEncoder()).withUser(<span class="string">"wsp"</span>).password(<span class="string">"wsp"</span>).roles(<span class="string">"ADMIN"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>③ 创建好接口后，进行登录尝试，发现，使用 用户为 demo ，角色 为 DEMO 依旧可以通过该接口 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu57.png" width="60%">

<p>问题解析：</p>
<p>这是因为还需要再添加一个@EnableGlobalMethodSecurity(prePostEnabled = <strong>true</strong>) 注解到 启动器上，以让 @PreAuthorize(<strong>“hasRole(‘ROLE_ADMIN’)”</strong>) 这个注解生效，完整 启动类代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bootstrap</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Bootstrap<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">home</span> <span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"hello spring boot"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span> <span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"hello spring boot"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@PreAuthorize</span>(<span class="string">"hasRole('ROLE_ADMIN')"</span>)</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/roleAuth"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">role1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"roleAuth"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>添加注解后</strong>：</p>
<p><strong>使用 demo 进行登录：</strong></p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu58.png" width="60%">

<p><strong>使用admin进行登录：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu59.png" width="60%">

<p><strong>（3）数据库管理实现</strong>： </p>
<blockquote>
<p> 通过数据库获取用户信息进行登录认证 </p>
</blockquote>
<p>创建 MyUserService.java类，并装载 Bean 到 容器中，在SpringSecurityConfig.java 中进行配置： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringSecurityConfig.java 中 configure(AuthenticationManagerBuilder auth)方法修改为通过注入MyUserService 的Bean实现数据库查询 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyUserService myUserService;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           auth.userDetailsService(myUserService); <span class="comment">// 通过注入 MyUserService 的方式实现数据库查询用户信息的登录认证</span></span><br><span class="line"> </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>密码的自定义验证：</strong> </p>
<blockquote>
<p>创建 MyPasswordEncoder 类，实现 PasswordEncoder 接口类；重写 encode（CharSequence obj和 matches（CharSequence obj,String str） 方法： </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPasswordEncoder</span> <span class="keyword">implements</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String SALT = <span class="string">"wenmin"</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence charSequence)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> MD5Util.MD5Encode(charSequence.toString(),SALT);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> MD5Util.isPasswordValid(encodedPassword,rawPassword.toString(),SALT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong>第一个是加密的方法，第二个是匹配密码，具体操作是加密方法加密后与原始密码在匹配方法中进行匹配</p>
<p>底层逻辑解析：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">passwordEncoder. isPasswordValid(userDetails.getPassword(), presentedPassword, salt) 这个实现是在接口PasswordEncoder的实现类MessageDigestPasswordEncoder中实现的。 </span><br><span class="line"> </span><br><span class="line">MessageDigestPasswordEncoder类： </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPasswordValid</span><span class="params">(String encPass, String rawPass, Object salt)</span> </span>&#123; </span><br><span class="line">        String pass1 = <span class="string">""</span> + encPass; </span><br><span class="line">        String pass2 = encodePassword(rawPass, salt); </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> pass1.equals(pass2); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">其中 encodePassword(rawPass, salt)方法如下： </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">encodePassword</span><span class="params">(String rawPass, Object salt)</span> </span>&#123; </span><br><span class="line">        String saltedPass = mergePasswordAndSalt(rawPass, salt, <span class="keyword">false</span>); </span><br><span class="line"> </span><br><span class="line">        MessageDigest messageDigest = getMessageDigest(); </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">byte</span>[] digest; </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            digest = messageDigest.digest(saltedPass.getBytes(<span class="string">"UTF-8"</span>)); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123; </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"UTF-8 not supported!"</span>); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">        <span class="comment">// "stretch" the encoded value if configured to do so </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; iterations; i++) &#123; </span><br><span class="line">            digest = messageDigest.digest(digest); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (getEncodeHashAsBase64()) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(Base64.encode(digest)); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(Hex.encode(digest)); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">使用的是MD5加密方法。</span><br></pre></td></tr></table></figure>

<p><strong>引入自定义的登录信息验证器</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">auth.userDetailsService(myUserService).passwordEncoder(<span class="keyword">new</span> MyPasswordEncoder());</span><br></pre></td></tr></table></figure>

<p>相关注解说明： </p>
<table>
<thead>
<tr>
<th>@PreAuthorize(“hasRole(‘ROLE_ADMIN’)”)</th>
<th>方法调用前进行权限检查</th>
</tr>
</thead>
<tbody><tr>
<td><strong>@PostAuthorize(“hasRole(‘’)”)</strong></td>
<td>方法调用后进行权限检查</td>
</tr>
<tr>
<td><strong>@PreFilter(“”)</strong></td>
<td>方法调用前针对集合类参数或返回值进行过滤</td>
</tr>
<tr>
<td><strong>@PostFilter(“”)</strong></td>
<td>方法调用后针对集合类参数或返回值进行过滤</td>
</tr>
</tbody></table>
<h3 id="6、Spring-Security-的优缺点"><a href="#6、Spring-Security-的优缺点" class="headerlink" title="6、Spring Security 的优缺点"></a>6、Spring Security 的优缺点</h3><p><strong>优点：</strong></p>
<blockquote>
<p>提供了一套安全框架，而且这个框架是可以用的；</p>
<p>提供了很多用户认证的功能，实现相关接口即可，节约大量开发工作；</p>
<p>基于spring，易于集成到 spring 项目中，且封装了许多方法。</p>
</blockquote>
<p><strong>缺点：</strong></p>
<blockquote>
<p>配置文件多，角色被“编码”到配置文件盒源文件中，RBAC 不明显；</p>
<p>对于系统中用户、角色、权限之间的关系，没有可操作的界面；</p>
<p>大数据量情况下，几乎不可用。 </p>
</blockquote>
<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/Spring-boot-Security" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot功能（一）集成JavaMail实现邮箱认证</title>
    <url>/2020/03/08/SpringBoot%E5%8A%9F%E8%83%BD%EF%BC%88%E4%B8%80%EF%BC%89%E9%9B%86%E6%88%90JavaMail%E5%AE%9E%E7%8E%B0%E9%82%AE%E7%AE%B1%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<h2 id="一、JavaMail"><a href="#一、JavaMail" class="headerlink" title="一、JavaMail"></a>一、JavaMail</h2><h3 id="1、什么是JavaMail？"><a href="#1、什么是JavaMail？" class="headerlink" title="1、什么是JavaMail？"></a>1、什么是JavaMail？</h3><p><strong>JavaMail</strong> ，顾名思义，提供给开发者处理 电子邮件相关的编程接口。它是<strong>Sun</strong>发布的用来处理<strong>email</strong>的<strong>API</strong>。它可以方便的执行一些常用的邮件传输。我们可以基于<strong>JavaMaiil</strong>开发出类似于 <strong>Microsoft Outlook</strong>的应用程序。 </p>
<h3 id="2、关于要使用JavaMail的原因？"><a href="#2、关于要使用JavaMail的原因？" class="headerlink" title="2、关于要使用JavaMail的原因？"></a>2、关于要使用JavaMail的原因？</h3><p>基于现在WEB开发中对JavaMail的需求，<strong>例如：</strong> </p>
<blockquote>
<p>(1) 用户注册后，网站发送一封激活邮件验证；</p>
</blockquote>
<blockquote>
<p>(2) 用户过生日，系统发送生日祝福邮件；</p>
</blockquote>
<blockquote>
<p>(3) 将最新活动和优惠以邮件的形式告知会员等等……..</p>
</blockquote>
<p>以上的需求都需要通过编程语言实现发送邮件功能，而JavaMail便能满足这一需求。 </p>
<h3 id="3、电子邮箱及邮件服务器"><a href="#3、电子邮箱及邮件服务器" class="headerlink" title="3、电子邮箱及邮件服务器"></a>3、电子邮箱及邮件服务器</h3><p>什么是<strong>电子邮箱</strong>？ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">电子邮箱（E-mail 地址） 需要在邮件服务器上进行申请，确切的说，电子邮箱其实就是用户在邮件服务器上申请的一个账户，用户在邮件服务器上申请了一个账号后，邮件服务器就会为这个账号分配一定的空间，用户从而可以使用这个账号以及空间，发送电子邮件和保存别人发送过来的电子邮件。</span><br></pre></td></tr></table></figure>

<p>什么是<strong>邮箱服务器</strong>？ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">服务器指的是一台电脑安装了一个服务器软件，那么这台电脑就可以称为是WEB服务器，那么同样的一台电脑安装了邮件服务器软件，那么这台电脑称为是邮件服务器。</span><br></pre></td></tr></table></figure>

<p>基于互联网的<strong>电子邮件</strong>功能： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">要在Internet上提供电子邮件功能，必须有专门的电子邮件服务器，例如目前网络上提供邮件服务的厂商：新浪、搜狐、网易等等他们都有自己的邮件服务器。</span><br></pre></td></tr></table></figure>

<h3 id="4、邮件收发协议"><a href="#4、邮件收发协议" class="headerlink" title="4、邮件收发协议"></a>4、邮件收发协议</h3><p>（1）SMTP协议（发送邮件）</p>
<p> <strong>简单邮件传输协议 (Simple Mail Transfer Protocol, SMTP)</strong> 是在<a href="https://baike.baidu.com/item/Internet" target="_blank" rel="noopener">Internet</a>传输<a href="https://baike.baidu.com/item/email" target="_blank" rel="noopener">email</a>的<a href="https://baike.baidu.com/item/%E4%BA%8B%E5%AE%9E%E6%A0%87%E5%87%86" target="_blank" rel="noopener">事实标准</a>。（百度百科）</p>
<blockquote>
<p><strong>SMTP</strong>是一个相对简单的基于文本的<strong>协议</strong>。在其之上指定了一条消息的一个或多个接收者（在大多数情况下被确认是存在的），然后<strong>消息文本</strong>会被传输。可以很简单地通过<strong>telnet</strong>程序来测试一个<strong>SMTP服务器</strong>。SMTP使用TCP端口25。要为一个给定的域名决定一个SMTP服务器，需要使用<strong>MX (Mail eXchange) DNS</strong>。（百度百科）</p>
</blockquote>
<p>用户脸上邮件服务器后，要想给它发送一封电子邮件，需要遵循一定的通讯规则，SMTP协议就是用于定义这种规则的。因此，通常我们也把处理用户SMTP请求（邮件发送请求）的邮件服务器称之为SMTP服务器。 </p>
<p>（2）POP3协议（接收邮件）  </p>
<p><strong>POP3</strong>，全名为“Post Office Protocol - Version 3”，即“<a href="https://baike.baidu.com/item/%E9%82%AE%E5%B1%80%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">邮局协议</a>版本3”。是<a href="https://baike.baidu.com/item/TCP%2FIP" target="_blank" rel="noopener">TCP/IP</a>协议族中的一员，由<a href="https://baike.baidu.com/item/RFC" target="_blank" rel="noopener">RFC</a>1939 定义。本协议主要用于支持使用客户端远程管理在<a href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8/100571" target="_blank" rel="noopener">服务器</a>上的电子邮件。提供了<a href="https://baike.baidu.com/item/SSL" target="_blank" rel="noopener">SSL</a>加密的POP3协议被称为POP3S。（百度百科） </p>
<blockquote>
<p><strong>POP</strong> 协议支持“离线”邮件处理。其具体过程是：<strong>邮件发送到服务器上</strong>，电子邮件客户端调用邮件客户机程序以<strong>连接服务器</strong>，并下载所有未阅读的<strong>电子邮件</strong>。这种<strong>离线访问模式</strong>是一种存储转发服务，将邮件从邮件服务器端送到个人终端机器上，一般是PC机或 MAC。一旦邮件发送到 PC 机或MAC上，邮件服务器上的邮件将会被删除。但目前的<strong>POP3</strong>邮件服务器大都可以“只下载邮件，服务器端并不删除”，也就是改进的<strong>POP3协议</strong>。（百度百科）</p>
</blockquote>
<p>同样，用户若<strong>想从邮件服务器管理的电子邮件中接受一封电子邮件的话，他连上邮件服务器后，也需要遵循一定的通讯格式</strong>，POP3协议用于定义这种通讯格式。 </p>
<p>（3）邮件收发过程的介绍： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu47.png" width="70%">

<blockquote>
<p><strong>邮件的发送、接受，在客户端软件中，由SMTP服务器进行发送操作，接受是由POP3服务器进行接收。</strong></p>
<p>1、 邮件发送协议-SMTP，默认端口号25</p>
<p>​       用于把用户邮件从一个服务器转到下一个服务器</p>
<p>2、 邮件接收协议-POP3，默认端口号110</p>
<p>​       用于支持使用客户端远程管理在服务器上的电子邮件</p>
</blockquote>
<h2 id="二、邮件发送代码实现"><a href="#二、邮件发送代码实现" class="headerlink" title="二、邮件发送代码实现"></a>二、邮件发送代码实现</h2><h3 id="1、环境搭建"><a href="#1、环境搭建" class="headerlink" title="1、环境搭建"></a>1、环境搭建</h3><p>（1）创建数据库和表 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE &#96;NewTable&#96; (</span><br><span class="line">&#96;uid&#96;  int(11) NOT NULL AUTO_INCREMENT ,</span><br><span class="line">&#96;username&#96;  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ,</span><br><span class="line">&#96;password&#96;  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ,</span><br><span class="line">&#96;nickname&#96;  varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ,</span><br><span class="line">&#96;email&#96;  varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ,</span><br><span class="line">&#96;state&#96;  int(11) NULL DEFAULT NULL ,</span><br><span class="line">&#96;code&#96;  varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ,</span><br><span class="line">PRIMARY KEY (&#96;uid&#96;)</span><br><span class="line">)</span><br><span class="line">ENGINE&#x3D;InnoDB</span><br><span class="line">DEFAULT CHARACTER SET&#x3D;utf8 COLLATE&#x3D;utf8_general_ci</span><br><span class="line">AUTO_INCREMENT&#x3D;22</span><br><span class="line">ROW_FORMAT&#x3D;DYNAMIC</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>（2）创建一个springboot工程，创建相应的包，并配置相应的pom.xml依赖 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu48.png" width="60%">

<p>  (3) pom.xml </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--&lt;version&gt;5.1.41&lt;/version&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- lombok 简化 java 代码 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--郵箱發送--&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（4）创建User类并配置application.yml </p>
<p><strong>User类：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span>  Integer uid;</span><br><span class="line">    <span class="keyword">private</span>  String username;</span><br><span class="line">    <span class="keyword">private</span>  String password;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>application.yml</strong> </p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">port</span>: <span class="string">80</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">datasource</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">jdbc:mysql://localhost:3333/regist_web?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;autoReconnect=true&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">root</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">root</span></span><br><span class="line">    <span class="meta">driver-class-name</span>:  <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis</span>:<span class="string"></span></span><br><span class="line">  <span class="meta">mapper-locations</span>: <span class="string">classpath*:/mybatis/mappers/*Mapper.xml</span></span><br><span class="line">  <span class="meta">type-aliases-package</span>: <span class="string">com.entities</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#邮件配置(发件人）</span></span><br><span class="line"><span class="attr">email</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">host</span>: <span class="string">smtp.163.com</span></span><br><span class="line">  <span class="attr">username</span>: <span class="string">1***9746***@163.com</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">1***9746**</span></span><br><span class="line">  <span class="attr">senderName</span>: <span class="string">1***9746***@163.com</span></span><br></pre></td></tr></table></figure>

<p>（5）设计注册页面 </p>
<p><strong>index.html</strong> </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery-1.11.3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户注册的页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/get/getParam/user"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>昵称<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"nickname"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（6）Handler ：创建接口，接收form 表单数据并进行封装，并经过dao 层 添加到对应的数据库表中 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span> (<span class="string">"/get/getParam/user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getParam</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span>String  username,</span></span><br><span class="line"><span class="function">                           @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span>String  password,</span></span><br><span class="line"><span class="function">                           @<span class="title">RequestParam</span><span class="params">(<span class="string">"nickname"</span>)</span>String  nickname,</span></span><br><span class="line"><span class="function">                           @<span class="title">RequestParam</span><span class="params">(<span class="string">"email"</span>)</span>String  email,</span></span><br><span class="line"><span class="function">                           HttpServletRequest request</span></span><br><span class="line"><span class="function">                           )  </span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(username.equals(<span class="string">""</span>) &amp;&amp; password.equals(<span class="string">""</span>) &amp;&amp; nickname.equals(<span class="string">""</span>) &amp;&amp; email.equals(<span class="string">""</span>))&#123;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">return</span>  <span class="string">"请不要留空"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//封装数据</span></span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line">        user.setNickname(nickname);</span><br><span class="line">        user.setEmail(email);</span><br><span class="line">        user.setState(<span class="number">0</span>);<span class="comment">// 0 ： 未激活 1： 已经激活</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//使用 UUID 随机生成激活码</span></span><br><span class="line">        String code = UUIDUtils.getUUID()+ UUIDUtils.getUUID();</span><br><span class="line">        user.setCode(code);</span><br><span class="line"> </span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//调用业务层处理数据</span></span><br><span class="line">        userService.addUser(user);</span><br><span class="line"> </span><br><span class="line">        map.put(<span class="string">"state"</span>,<span class="string">"0"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>, <span class="string">"發送成功"</span>);</span><br><span class="line">        <span class="comment">//页面跳转</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">            map.put(<span class="string">"state"</span>,<span class="string">"1"</span>);</span><br><span class="line">            map.put(<span class="string">"message"</span>, <span class="string">"發送失敗"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>（7）创建一个UUIDUtils 工具类，使用UUID随机生成激活码 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> UUIDUtils  生成随机字符串工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/9/8 13:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UUIDUtils</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUUID</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replace(<span class="string">"-"</span>,<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（8）创建邮箱参数实体EmailConfig.java和发送邮件工具类MailUtils.java</p>
<p><strong>EmailConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.utils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> EmailConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/25 10:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"email"</span>, ignoreUnknownFields = <span class="keyword">false</span>)</span><br><span class="line"><span class="comment">//@PropertySource("classpath:/application.yml")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String senderName;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHost</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSenderName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> senderName;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSenderName</span><span class="params">(String senderName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.senderName = senderName;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"EmailConfig&#123;"</span> +</span><br><span class="line">                <span class="string">"host='"</span> + host + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", senderName='"</span> + senderName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MailUtils.java</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.utils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.mysql.cj.Session;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSenderImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MailUtils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/9/8 14:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailUtils</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmailConfig emailConfig;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MailUtils<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送邮件的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> to :给谁发邮件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> code : 邮件的激活码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> subject ： 主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> text  : 内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">sendMail</span><span class="params">(String toEmail, String code,<span class="keyword">final</span> String subject,<span class="keyword">final</span> String text)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1、创建邮件对象</span></span><br><span class="line">            JavaMailSenderImpl javaMailSender = <span class="keyword">new</span> JavaMailSenderImpl();</span><br><span class="line">            <span class="comment">//2、发邮件人邮箱</span></span><br><span class="line">            javaMailSender.setUsername(emailConfig.getUsername());</span><br><span class="line">            <span class="comment">//3、发邮件人邮箱密码（默认使用客户端的授权码）</span></span><br><span class="line">            javaMailSender.setPassword(emailConfig.getPassword());</span><br><span class="line">            <span class="comment">//4、设置邮件服务器主机名  SMTP服务器地址</span></span><br><span class="line">            javaMailSender.setHost(emailConfig.getHost());</span><br><span class="line">            <span class="comment">//5、SMTP服务器: 默认端口</span></span><br><span class="line">            javaMailSender.setPort(<span class="number">25</span>);</span><br><span class="line">            <span class="comment">//6、//发送邮件协议名称</span></span><br><span class="line">            javaMailSender.setProtocol(<span class="string">"smtp"</span>);</span><br><span class="line">            <span class="comment">//7、编码格式</span></span><br><span class="line">            javaMailSender.setDefaultEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//8、创建连接对象，连接到邮箱服务器</span></span><br><span class="line">            Properties mailProperties = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">//发送服务器需要身份验证,要采用指定用户名密码的方式去认证</span></span><br><span class="line">            mailProperties.put(<span class="string">"mail.smtp.auth"</span>, <span class="keyword">true</span>);</span><br><span class="line">            mailProperties.put(<span class="string">"mail.smtp.starttls.enable"</span>, <span class="keyword">true</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//9、添加连接对象到邮件对象中</span></span><br><span class="line">            javaMailSender.setJavaMailProperties(mailProperties);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">//10、创建</span></span><br><span class="line">            <span class="comment">//可以发送几封邮件:可以这里 for循环多次</span></span><br><span class="line">                MimeMessage mimeMessage = getMimeMessage(toEmail,subject,text, javaMailSender);</span><br><span class="line">                <span class="comment">//11、发送邮件</span></span><br><span class="line">                javaMailSender.send(mimeMessage);</span><br><span class="line">                logger.info(<span class="string">"发送 第"</span>+ count + <span class="string">"封邮件"</span> );</span><br><span class="line">                count ++;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            logger.info(<span class="string">"发往 "</span>+toEmail+<span class="string">" 邮件发送成功"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MessagingException e) &#123;</span><br><span class="line">            logger.error(<span class="string">"发往 "</span>+toEmail+<span class="string">" 邮件发送异常"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//声明一个Message对象(代表一封邮件),从session中创建</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> MimeMessage <span class="title">getMimeMessage</span><span class="params">(String toEmail,String subject,String text, JavaMailSenderImpl javaMailSender)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line"> </span><br><span class="line">        MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="comment">//发件人</span></span><br><span class="line">        mimeMessageHelper.setFrom(emailConfig.getSenderName());</span><br><span class="line">        <span class="comment">//收件人  : 可以发送给多个收件人，该方法有一个重载的 数组形参</span></span><br><span class="line">        mimeMessageHelper.setTo(toEmail);</span><br><span class="line"><span class="comment">//        mimeMessage.setContent();</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//邮件主题</span></span><br><span class="line">        mimeMessageHelper.setSubject(subject);</span><br><span class="line">        <span class="comment">//邮件内容</span></span><br><span class="line">        mimeMessageHelper.setText(text, <span class="keyword">true</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> mimeMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（9）在（5）中的接口接收注册参数并写入数据库后，进行激活邮件的发送 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//调用业务层处理数据</span></span><br><span class="line">userService.addUser(user);</span><br></pre></td></tr></table></figure>

<p><strong>UserServiceimpl.java</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">addUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将数据存入到数据库</span></span><br><span class="line">	Integer integer = userMapper.addUser(user);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//发送一封激活邮件</span></span><br><span class="line">	mailUtils.sendMail(<span class="string">"18620307785@163.com"</span>,user.getCode(),<span class="string">"来自邮箱测试接口邮件"</span>,<span class="string">"&lt;h1&gt;来自wto网站激活邮件，激活请点击以下链接：&lt;/h1&gt;&lt;h3&gt;&lt;a href='http://wj7ei8.natappfree.cc/regist_web/activateServlet?code="</span>+user.getCode()+<span class="string">"'&gt;http://wj7ei8.natappfree.cc/regist_web/activateServlet?code="</span>+user.getCode()+<span class="string">"&lt;/a&gt;&lt;/h3&gt;"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> integer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整 业务层代码：</p>
<p><strong>UserService.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function">Integer <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function">User <span class="title">findByCode</span><span class="params">(String code)</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>UserServiceImpl.java</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MailUtils mailUtils;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userMapper.selectAll();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">addUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">//将数据存入到数据库</span></span><br><span class="line">		Integer integer = userMapper.addUser(user);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">//发送一封激活邮件</span></span><br><span class="line">		mailUtils.sendMail(<span class="string">"18620307785@163.com"</span>,user.getCode(),<span class="string">"来自邮箱测试接口邮件"</span>,<span class="string">"&lt;h1&gt;来自wto网站激活邮件，激活请点击以下链接：&lt;/h1&gt;&lt;h3&gt;&lt;a href='http://wj7ei8.natappfree.cc/regist_web/activateServlet?code="</span>+user.getCode()+<span class="string">"'&gt;http://wj7ei8.natappfree.cc/regist_web/activateServlet?code="</span>+user.getCode()+<span class="string">"&lt;/a&gt;&lt;/h3&gt;"</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">return</span> integer;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findByCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">		<span class="keyword">return</span> userMapper.findByCode(code);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		userMapper.updateUser(user);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（10）UserMapper.java 和 UserMapper.xml </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function">Integer <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function">User <span class="title">findByCode</span><span class="params">(@Param(<span class="string">"code"</span>)</span> String code)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">	select *</span><br><span class="line">	from</span><br><span class="line">	user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.entities.User"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">keyProperty</span>=<span class="string">"id"</span> &gt;</span></span><br><span class="line">	INSERT INTO user (</span><br><span class="line">		username,</span><br><span class="line">		password,</span><br><span class="line">		nickname,</span><br><span class="line">		email,</span><br><span class="line">		state,</span><br><span class="line">		code</span><br><span class="line">	)</span><br><span class="line">	VALUES</span><br><span class="line">		(</span><br><span class="line">			#&#123;username&#125;,</span><br><span class="line">			#&#123;password&#125;,</span><br><span class="line">			#&#123;nickname&#125;,</span><br><span class="line">			#&#123;email&#125;,</span><br><span class="line">			#&#123;state&#125;,</span><br><span class="line">			#&#123;code&#125;</span><br><span class="line">		)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCode"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">resultType</span>=<span class="string">"com.entities.User"</span>&gt;</span></span><br><span class="line">	SELECT</span><br><span class="line">		*</span><br><span class="line">	FROM</span><br><span class="line">		user u</span><br><span class="line">	WHERE</span><br><span class="line">		u. CODE = #&#123;code&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.entities.User"</span>&gt;</span></span><br><span class="line">	UPDATE user</span><br><span class="line">	<span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"set"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span></span><br><span class="line">			username=#&#123;username&#125;,</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></span><br><span class="line">			password=#&#123;password&#125;,</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname != null"</span>&gt;</span></span><br><span class="line">			nickname=#&#123;nickname&#125;,</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email!=null"</span>&gt;</span></span><br><span class="line">			email=#&#123;email&#125;,</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">			state=#&#123;state&#125;,</span><br><span class="line">			code=#&#123;code&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">	WHERE uid=#&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（11）创建用户激活接口： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 用户激活的 接口</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/regist_web/activateServlet"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">activateServlet</span><span class="params">(@RequestParam(<span class="string">"code"</span>)</span>String  code,</span></span><br><span class="line"><span class="function">                           HttpServletRequest request,HttpServletResponse response)  </span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            User user = userService.findByCode(code);</span><br><span class="line">            <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//已经查询到，修改用户的状态</span></span><br><span class="line">                user.setState(<span class="number">1</span>);<span class="comment">//已经激活</span></span><br><span class="line">                user.setCode(<span class="keyword">null</span>);</span><br><span class="line">                <span class="comment">//激活后修改用户的激活码及状态</span></span><br><span class="line">                userService.updateUser(user);</span><br><span class="line">                map.put(<span class="string">"state"</span>,<span class="string">"0"</span>);</span><br><span class="line">                map.put(<span class="string">"message"</span>, <span class="string">"您的激活码已激活!请去登录"</span>);</span><br><span class="line"> </span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//根据激活码没有查询到该用户</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">                map.put(<span class="string">"state"</span>,<span class="string">"0"</span>);</span><br><span class="line">                map.put(<span class="string">"message"</span>, <span class="string">"您的激活码有误!请重新激活"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            map.put(<span class="string">"state"</span>,<span class="string">"1"</span>);</span><br><span class="line">            map.put(<span class="string">"message"</span>, <span class="string">"發送失敗"</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>小结：</strong> </p>
<blockquote>
<p>发送激活邮件正文，正文内容使用 html 的语法进行修饰，用户邮箱POP3接受到邮件后会自动根据标签及样式进行解析。</p>
<p>激活邮件的原理：</p>
<p>发送邮件给用户，用户根据接收到的邮件的连接点击并跳转到对应的controller请求接口执行code验证码查询到用户，并根据当前激活码的作用对用户执行激活账户、业务等操作！！！</p>
</blockquote>
<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/spring-boot-JSP-email" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot功能篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot功能（一）集成JavaMail实现邮箱认证</title>
    <url>/2020/03/08/SpringBoot%E5%8A%9F%E8%83%BD%EF%BC%88%E4%BA%8C%EF%BC%89%E5%AE%9A%E5%88%B6%20starter%20%E5%90%AF%E5%8A%A8%E5%99%A8/</url>
    <content><![CDATA[<p>在实际项目开发中，我们常常会用到各种各样的 starter，这些starter 有的是有 springboot官方提供并已经整合一些基本功能的，如：<strong>spring-boot-starter，</strong>也有一些是由 第三方将框架与<strong>springboot</strong>进行定制整合后提供给我们进行快捷高效开发的，如：<strong>MyBatis-Spring-Boot-Starter。</strong></p>
<p>在日常开发中，由于项目的要求以及高效开发、部署等，我们可以对springboot进行私有定制，生成自己需要的启动器，再引入到实际项目中，提高开发的效率。</p>
<p>举例： 我们在<strong>springboot</strong> 中使用 <strong>redis</strong> 的 <strong>java</strong>控件<strong>jedis</strong> 时，需要 进行创建  <strong>Jedis</strong> 的实例并传入相应参数如  <strong>ip</strong> 、<strong>port</strong> 等，在使用<strong>springboot</strong>后，可以进行定制化<strong>starter</strong>，将<strong>Jedis</strong> 用<strong>ip</strong>、<strong>port</strong> 进行实例化，并将 <strong>Bean</strong> 注入容器由 <strong>SpringBoot</strong> 进行管理，制成启动器。</p>
<p>在需要使用到 <strong>redis</strong> 功能的工程项目中引入该启动器，这样就能够提高开发的效率。</p>
<p>正规的<strong>starter</strong>是一个独立的工程，然后在<strong>maven</strong>中新仓库注册发布，其他开发人员就可以使用你的<strong>starter</strong>了。</p>
<p>以下实现一个针对 <strong>redis</strong> 的 定制器 <strong>starter</strong>。 </p>
<h3 id="一、新建一个maven项目spring-boot-starter-redis-（启动器）"><a href="#一、新建一个maven项目spring-boot-starter-redis-（启动器）" class="headerlink" title="一、新建一个maven项目spring-boot-starter-redis （启动器）"></a>一、新建一个maven项目spring-boot-starter-redis （启动器）</h3><p>引入如下依赖： </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--自动配置依赖--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="二、在此项目中编写-RedisProperties-class-，用以从-application-properties-中读取-redis-的配置信息"><a href="#二、在此项目中编写-RedisProperties-class-，用以从-application-properties-中读取-redis-的配置信息" class="headerlink" title="二、在此项目中编写 RedisProperties.class ，用以从 application.properties 中读取 redis 的配置信息"></a>二、在此项目中编写 RedisProperties.class ，用以从 application.properties 中读取 redis 的配置信息</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> JedisProperties</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/2/2 18:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"jedis"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHost</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPort</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、在此项目中编写RedisAutoConfiguration-class，用以将-Jedis-的bean-装载进-spring-容器中"><a href="#三、在此项目中编写RedisAutoConfiguration-class，用以将-Jedis-的bean-装载进-spring-容器中" class="headerlink" title="三、在此项目中编写RedisAutoConfiguration.class，用以将 Jedis 的bean 装载进 spring 容器中"></a>三、在此项目中编写RedisAutoConfiguration.class，用以将 Jedis 的bean 装载进 spring 容器中</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.autoConfigure;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.example.demo.properties.RedisProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.AutoConfigureAfter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> JedisAutoConfigure</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/2/2 18:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; Jedis<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(</span>&#123;RedisProperties<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123;RedisProperties<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Jedis <span class="title">Jedis</span><span class="params">(RedisProperties redisProperties)</span> </span>&#123;</span><br><span class="line">         <span class="comment">//spring会自动将RedisProperties这个bean注入进来，</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Jedis(redisProperties.getHost(),redisProperties.getPort(),<span class="number">10000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为大家解释一下这些注解的含义</p>
<table>
<thead>
<tr>
<th>@SpringBootConfiguration：</th>
<th>代表这是一个配置类</th>
</tr>
</thead>
<tbody><tr>
<td>@EnableConfigurationProperties (RedisProperties.class)：</td>
<td>将RedisProperties加载到spring容器中。参考Spring-Boot之@Enable*注解的工作原理</td>
</tr>
<tr>
<td>@ConditionalOnClass(Jedis.class)：</td>
<td>当项目引用了Jedis的jar时，才加载此配置类。参考Spring-Boot autoconfigure之Condition</td>
</tr>
</tbody></table>
<h3 id="四、在此项目中resource目录下新建-application-properties-文件"><a href="#四、在此项目中resource目录下新建-application-properties-文件" class="headerlink" title="四、在此项目中resource目录下新建 application.properties 文件"></a>四、在此项目中resource目录下新建 application.properties 文件</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">redis.host=127.0.0.1</span><br><span class="line">redis.port=6379</span><br></pre></td></tr></table></figure>

<h3 id="五、Bean-注入方式："><a href="#五、Bean-注入方式：" class="headerlink" title="五、Bean 注入方式："></a>五、Bean 注入方式：</h3><h4 id="第一种：自动注入，创建-依赖配置-spring-factories"><a href="#第一种：自动注入，创建-依赖配置-spring-factories" class="headerlink" title="第一种：自动注入，创建 依赖配置 spring.factories"></a>第一种：自动注入，创建 依赖配置 spring.factories</h4><p>在resource 目录下新建 META-INF 目录，并在该目录下创建 spring.factories 文件，在文件添加以下数据：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration =com.example.demo.autoConfigure.RedisAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>当前数据用于将加载生成的Bean 交给当前启动器所在的容器进行管理，并在被引入到具体的工程项目时被项目中的容器所扫描到而调用。 </p>
<h4 id="第二种：手动注入，创建EnableRedis类"><a href="#第二种：手动注入，创建EnableRedis类" class="headerlink" title="第二种：手动注入，创建EnableRedis类"></a>第二种：手动注入，创建<strong>EnableRedis</strong>类</h4><p>根据<strong>@Import</strong>注解 的作用进行切面配置，手动添加到 工程项目启动类 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import</span>(RedisAutoConfiguration<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">EnableRedis</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用方式：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableRedis</span><span class="comment">//关键的一步</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogApplication</span> </span>&#123;</span><br><span class="line">......    </span><br><span class="line">                        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="六、新建Blog-工程项目，引入-spring-boot-starter-redis-依赖"><a href="#六、新建Blog-工程项目，引入-spring-boot-starter-redis-依赖" class="headerlink" title="六、新建Blog 工程项目，引入 spring-boot-starter-redis 依赖"></a>六、新建Blog 工程项目，引入 spring-boot-starter-redis 依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="七、在Blog项目中，编写启动类BlogApplication"><a href="#七、在Blog项目中，编写启动类BlogApplication" class="headerlink" title="七、在Blog项目中，编写启动类BlogApplication"></a>七、在Blog项目中，编写启动类BlogApplication</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> BlogApplication</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/2/2 23:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(BlogApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">        Jedis jedis = context.getBean(Jedis<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(jedis);</span><br><span class="line">        <span class="comment">//如果成功连接上了redis，jedis.ping()会返回一个pong</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="八、启动redis"><a href="#八、启动redis" class="headerlink" title="八、启动redis"></a>八、启动redis</h3><p><strong>启动虚拟机或云服务器的redis</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@wsp &#x2F;]# redis-server &#x2F;etc&#x2F;redis.conf </span><br><span class="line">[root@wsp &#x2F;]# redis-cli</span><br></pre></td></tr></table></figure>

<p>先启动 <strong>Spring-boot-starter-redis</strong> 启动器 ，再启动具体的项目工程 <strong>spring-boot-starter-apps</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu60.png" width="60%">

<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/springboot-starter" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot功能篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot整合（六）集成timer 定时任务</title>
    <url>/2020/03/07/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E5%85%AD%EF%BC%89%E9%9B%86%E6%88%90timer-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h3 id="1、创建具体要执行的任务类"><a href="#1、创建具体要执行的任务类" class="headerlink" title="1、创建具体要执行的任务类"></a>1、创建具体要执行的任务类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.timer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MyTimeTask</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 15:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTimeTask</span> <span class="keyword">extends</span> <span class="title">TimerTask</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(MyTimeTask<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTimeTask</span><span class="params">(String inputName)</span></span>&#123;</span><br><span class="line">        name = inputName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//打印当前name 的内容</span></span><br><span class="line">        System.out.println(<span class="string">"Current exec name is "</span> + name);</span><br><span class="line">        logger.info(System.currentTimeMillis()+<span class="string">"111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>run（）</strong>方法中是要执行的任务代码，定时器启动时会执行 <strong>run()</strong> 方法中的业务逻辑 ; </p>
<h3 id="2、创建-timer-的-实例工作类"><a href="#2、创建-timer-的-实例工作类" class="headerlink" title="2、创建 timer 的 实例工作类"></a>2、创建 timer 的 实例工作类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.timer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.Trigger;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.sql.Time;</span><br><span class="line"><span class="keyword">import</span> java.util.Timer;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MyTimer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 15:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTimer</span> </span>&#123;</span><br><span class="line"><span class="comment">//    public static void main(String[] args) &#123;</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuartzTrigger1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建一个timer实例</span></span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();</span><br><span class="line">        <span class="comment">//2.创建一个MyTimerTask实例</span></span><br><span class="line">        MyTimeTask myTimeTask = <span class="keyword">new</span> MyTimeTask(<span class="string">"No.1"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//3.通过timer定时定频率调用myTimerTask的业务逻辑</span></span><br><span class="line">        <span class="comment">// 即 第一次执行是在当前时间的两秒之后，之后每隔一秒钟执行一次\</span></span><br><span class="line">        timer.schedule(myTimeTask,<span class="number">2000L</span>,<span class="number">1000L</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加<strong>@Configuration</strong>  注解，自动注入实例对象，并由<strong>springboot</strong> 启动 定时器，执行任务。</p>
<p>注意： 使用<strong>springboot</strong> 时保证包扫描路径是正确的；</p>
<p><strong>执行效果：</strong></p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu46.png" width="60%">

<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/spring-boot-timer" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot整合（五）集成Lombok 插件</title>
    <url>/2020/03/07/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E9%9B%86%E6%88%90Lombok-%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<h3 id="应用原因："><a href="#应用原因：" class="headerlink" title="应用原因："></a>应用原因：</h3><p><code>为了减少代码量，为当前项目添加 **lombok** 来优雅编码</code></p>
<h3 id="Lombok-插件安装："><a href="#Lombok-插件安装：" class="headerlink" title="Lombok 插件安装："></a>Lombok 插件安装：</h3><h4 id="a-添加依赖"><a href="#a-添加依赖" class="headerlink" title="a . 添加依赖:"></a><strong>a . 添加依赖:</strong></h4><p>在 pom.xml 文件中添加相关依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="b-安装-Lombok-插件"><a href="#b-安装-Lombok-插件" class="headerlink" title="b . 安装 Lombok 插件"></a>b . 安装 Lombok 插件</h4><p><strong>Eclipse:</strong></p>
<pre><code>下载地址：https://projectlombok.org/download
　　将下载的lombok.jar文件，放到eclipse安装路径，该jar包也就是lombok插件的jar文件了
　　打开eclipse.ini文件，添加如下内容：
　　　　-javaagent:lombok.jar
　　　　-Xbootclasspath/a:lombok.jar
 　　　　重启eclipse</code></pre><p><strong>IDEA:</strong></p>
<pre><code>可以在线安装lombok的插件
settings -&gt; plugins -&gt; 在搜索框输入lombok -&gt;  安装</code></pre><p>sts安装Lombok：</p>
<p><a href="https://blog.csdn.net/zhaoxiaohua125/article/details/80211684" target="_blank" rel="noopener">https://blog.csdn.net/zhaoxiaohua125/article/details/80211684</a></p>
<p>Lombok常用注解及原理：</p>
<table>
<thead>
<tr>
<th>@Data</th>
<th>注解在类上</th>
<th>包含了@ToString，@EqualsAndHashCode，@Getter / @Setter和@RequiredArgsConstructor的功能，提供类所有属性的 getter 和 setter 方法，此外还提供了equals、canEqual、hashCode、toString 方法</th>
</tr>
</thead>
<tbody><tr>
<td><strong>@Setter</strong></td>
<td>注解在属性上</td>
<td>为属性提供 setter 方法</td>
</tr>
<tr>
<td><strong>@Getter</strong></td>
<td>注解在属性上</td>
<td>为属性提供 getter 方法</td>
</tr>
<tr>
<td><strong>@ToString</strong></td>
<td>注解在类上</td>
<td>生成toString()方法，默认情况下，它会按顺序（以逗号分隔）打印你的类名称以及每个字段。                 可以这样设置不包含哪些字段<strong>@ToString(exclude = “id”) / @ToString(exclude = {“id”,”name”})</strong>如果继承的有父类的话，可以设置callSuper 让其调用父类的toString()方法，例如：@ToString(callSuper = true)</td>
</tr>
<tr>
<td>@<strong>EqualsAndHashCode</strong></td>
<td>注解在类上</td>
<td>生成hashCode()和equals()方法，默认情况下，它将使用所有非静态，非transient字段。但可以通过在可选的exclude参数中来排除更多字段。或者，通过在parameter参数中命名它们来准确指定希望使用哪些字段。</td>
</tr>
<tr>
<td>@<strong>NonNull</strong></td>
<td>注解在属性上</td>
<td>标识属性是不能为空，为空则抛出异常。</td>
</tr>
<tr>
<td>@<strong>Slf4j</strong></td>
<td>注解在类上</td>
<td>根据用户实际使用的日志框架生成log日志对象。</td>
</tr>
<tr>
<td>@<strong>Log4j</strong></td>
<td>注解在类上</td>
<td>为类提供一个 属性名为log 的 log4j 日志对象</td>
</tr>
</tbody></table>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot整合（四）集成@Scheduled 定时任务</title>
    <url>/2020/03/07/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E9%9B%86%E6%88%90-Scheduled-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h3 id="1、在SpringBoot-项目中使用-Scheduled注解执行定时任务："><a href="#1、在SpringBoot-项目中使用-Scheduled注解执行定时任务：" class="headerlink" title="1、在SpringBoot 项目中使用@Scheduled注解执行定时任务："></a>1、在SpringBoot 项目中使用<strong>@Scheduled</strong>注解执行定时任务：</h3><p>配置pom.xml 依赖：</p>
<p>一般情况下，SpringBoot 的 相关依赖，如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>是有包含对应  <strong>@Scheduled 定时注解启动所需要的jar包的，如下：</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br></pre></td></tr></table></figure>

<h3 id="2、创建定时类"><a href="#2、创建定时类" class="headerlink" title="2、创建定时类"></a>2、创建定时类</h3><p>（1）@Component ： 将当前类实例化注入到容器中</p>
<p>（2）定时器的生效要素：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Scheduled</span>(cron=<span class="string">"0/5 * *  * * ? "</span>)   <span class="comment">//每5秒执行一次</span></span><br></pre></td></tr></table></figure>

<p>在程序启动时，定时器会开始计时，并根据设定时间执行设置好的任务内容,<strong>线程的执行是以单线程进行</strong>； </p>
<p>（3）创建以下定时类 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.quartz;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.example.poiutis.common.SystemLogHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> HandleTimeQuartz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/25 20:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandleTimeQuartz</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 系统日志</span></span><br><span class="line">    <span class="comment">//private static SystemLogHandler systemLogger = SystemLogHandler</span></span><br><span class="line">   <span class="comment">//         .getLogger(HandleTimeQuartz.class);</span></span><br><span class="line"> </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(InvoiceController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Scheduled</span>(cron=<span class="string">"0/5 * *  * * ? "</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userStatusJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"进入测试"</span>);</span><br><span class="line">        logger.info(System.currentTimeMillis()+<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 程序入口处添加注解 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu44.png" width="60%">

<p>直接启动后会自动执行：效果如下： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu45.png" width="60%">

<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/spring-boot-scheduled" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot整合（三）集成Quartz 定时任务</title>
    <url>/2020/03/07/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E9%9B%86%E6%88%90Quartz-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h3 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h3><ul>
<li>将首页所展示的数据存入redis中并且每隔一小时更新一次数据。 </li>
<li>自动结账 ，票务系统或结算系统进行定时拉取票务或消费数据</li>
<li>定时加载POI生成 word、 excel 、PDF等，预先提交申请，定时器定时获取请求信息并后台加载到本地</li>
</ul>
<h3 id="1、在-pom-xml-中-添加-Quartz-所需要-的-依赖"><a href="#1、在-pom-xml-中-添加-Quartz-所需要-的-依赖" class="headerlink" title="1、在 pom.xml 中 添加 Quartz 所需要 的 依赖"></a>1、在 pom.xml 中 添加 Quartz 所需要 的 依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">       <span class="comment">&lt;!--定时器 quartz--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> </p>
<p><code>quartz 只能基于 springboot 的 parent 2.0 以上 版本 才能使用过，低于2.0 的版本无法加载到 quartz 的pom依赖包</code></p>
<h3 id="2、创建要执行的任务类："><a href="#2、创建要执行的任务类：" class="headerlink" title="2、创建要执行的任务类："></a>2、创建要执行的任务类：</h3><p> TestTask1  与  TestTask2 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.quartzHandler;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestTask1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 12:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTask1</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(<span class="string">"TestQuartz01----"</span> + sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.quartzHandler;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestTask2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 12:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTask2</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        System.out.println(<span class="string">"TestQuartz02----"</span> + sdf.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、定时器（执行类）："><a href="#3、定时器（执行类）：" class="headerlink" title="3、定时器（执行类）："></a>3、定时器（执行类）：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.quartzHandler;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> QuartzConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 12:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(QuartzConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//    testTask1使用的固定间隔方式，testTask2使用的是cron表达式方式。</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">testQuartz1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        return JobBuilder.newJob(TestTask1.class).withIdentity("testTask1").storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">testQuartzTrigger1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//5秒执行一次</span></span><br><span class="line">        SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder.simpleSchedule()</span><br><span class="line">                .withIntervalInSeconds(<span class="number">5</span>)</span><br><span class="line">                .repeatForever();</span><br><span class="line">        logger.info(System.currentTimeMillis()+<span class="string">""</span>);</span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(testQuartz1())</span><br><span class="line">                .withIdentity(<span class="string">"testTask1"</span>)</span><br><span class="line">                .withSchedule(scheduleBuilder)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">testQuartz2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        return JobBuilder.newJob(TestTask2.class).withIdentity("testTask2").storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">testQuartzTrigger2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//cron方式，每隔5秒执行一次</span></span><br><span class="line">        logger.info(System.currentTimeMillis()+<span class="string">""</span>);</span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(testQuartz2())</span><br><span class="line">                .withIdentity(<span class="string">"testTask2"</span>)</span><br><span class="line">                .withSchedule(CronScheduleBuilder.cronSchedule(<span class="string">"*/5 * * * * ?"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>执行结果：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu43.png" width="60%">

<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/spring-boot-quartz" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot原理（一）自启动原理</title>
    <url>/2020/03/07/SpringBoot%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89%E8%87%AA%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a><strong>引言</strong></h3><p>​    不论在工作中，亦或是求职面试，Spring Boot 已经成为我们必知必会的技能项。除了比较老旧的政府项目或金融项目依旧使用如 SSM 或 SSH 做单体框架开发项目外，如今的各行各业基于项目的快速开发与发布、迭代更新，都在逐渐替换使用 Spring Boot 框架，而逐步摒弃配置沉重和效率低下的 Spring 启动框架。</p>
<p>​    使用一门新的技术，立足于对它足够了解的基础上，能够让你更加得心应手的去进行应用、开发。SpringBoot 的精髓 “自动配置原理” 不仅仅是在面试过程中才用的上；在工作中如果能深入理解Spring Boot 的自动配置原理，我们就可以根据自己的需求自定义一个 started 满足开发的需求，让开发更加便捷与高效。</p>
<p>​    Spring Boot的出现，得益于“习惯优于配置”的理念，没有繁琐的配置、难以集成的内容（大多数流行第三方技术都被集成），这是基于Spring 4.x提供的按条件配置Bean的能力。</p>
<p><strong>本篇博文主要针对三个方面进行分析、讲解；这三个方面分别是：</strong></p>
<blockquote>
<h5 id="Spring-Boot-与-Spring-的差别与优点？以及与Spring-MVC-的关系？"><a href="#Spring-Boot-与-Spring-的差别与优点？以及与Spring-MVC-的关系？" class="headerlink" title="Spring Boot 与 Spring 的差别与优点？以及与Spring MVC 的关系？"></a>Spring Boot 与 Spring 的差别与优点？以及与Spring MVC 的关系？</h5><p>Spring Boot 主启动类的启动机制<br>Spring Boot 的自动配置原理是怎么实现的？<br>根据自动配置原理自定义一个 个性的 started ？</p>
</blockquote>
<h3 id="1、Spring-Boot-与-Spring-的差别与优点？以及与Spring-MVC-的关系？"><a href="#1、Spring-Boot-与-Spring-的差别与优点？以及与Spring-MVC-的关系？" class="headerlink" title="1、Spring Boot 与 Spring 的差别与优点？以及与Spring MVC 的关系？"></a>1、<strong>Spring Boot</strong> 与 <strong>Spring</strong> 的差别与优点？以及与Spring MVC 的关系？</h3><h4 id="1-1-Spring-Boot-和-Spring-MVC-的关系？"><a href="#1-1-Spring-Boot-和-Spring-MVC-的关系？" class="headerlink" title="1.1 Spring Boot 和 Spring MVC 的关系？"></a>1.1 Spring Boot 和 Spring MVC 的关系？</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Spring MVC 是基于Spring 的MVC框架；</span><br><span class="line"></span><br><span class="line">而Spring Boot 是基于Spring 配置的开发工具框架，使用注解更加简洁和适应快速开发。</span><br></pre></td></tr></table></figure>

<h4 id="1-2-Spring-Boot-的优势"><a href="#1-2-Spring-Boot-的优势" class="headerlink" title="1.2 Spring Boot 的优势"></a>1.2 Spring Boot 的优势</h4><p><strong>简单来说：</strong>Spring boot 简化了使用 Spring 的难度，简省了繁重的配置，提供了各种启动器，开发者能快速上手。</p>
<p><strong>（1）编码更简单</strong></p>
<pre><code>Spring 框架由于超重量级的 XML，annotation 配置，使得系统变得很笨重，难以维护
SpringBoot 采用约点大于配置的方法，直接引入依赖，即可实现代码的开发</code></pre><p><strong>（2）配置更简单</strong></p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu29.png" width="60%">

<p><strong>Xml</strong>文件使用<strong>javaConfig</strong>代替，<strong>XML</strong>中<strong>bean</strong>的创建，使用@<strong>bean</strong>代替后可以直接注入。</p>
<p>配置文件变少很多，只保留 <strong>application</strong>.<strong>yml</strong></p>
<p><strong>（3）部署更简单</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu30.png" width="60%">

<p><strong>（4）监控更简单</strong> </p>
<blockquote>
<ul>
<li>Spring-boot-start-actuator:</li>
<li>可以查看属性配置</li>
<li>线程工作状态</li>
<li>环境变量</li>
<li>JVM性能监控</li>
</ul>
</blockquote>
<h3 id="2、Spring-Boot-主启动类的启动机制"><a href="#2、Spring-Boot-主启动类的启动机制" class="headerlink" title="2、Spring Boot 主启动类的启动机制"></a>2、<strong>Spring Boot</strong> 主启动类的启动机制</h3><p><strong>关于程序的入口问题：</strong></p>
<p>在使用<strong>SSM</strong>或<strong>SSH</strong>以及原生的<strong>Servlet</strong> 作为架构的项目中，项目的入口都不是 <strong>main</strong> 方法，<strong>main</strong> 方法更多的是作为 <strong>HelloWorld</strong> 练习或 测试时使用。其程序的入口基本都是<strong>handler</strong> 中对外暴露的每个接口：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@RequestMapping(value &#x3D; &quot;&#x2F;listarea&quot;,method &#x3D; RequestMethod.GET)</span><br><span class="line">  private Map&lt;String,Object&gt; listArea()&#123;</span><br><span class="line">      HashMap&lt;String, Object&gt; modelMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">      List&lt;Area&gt; list &#x3D; areaService.getAreaList();</span><br><span class="line">      modelMap.put(&quot;areaList&quot;,list);</span><br><span class="line">      ArrayList arrayList &#x3D; new ArrayList();</span><br><span class="line">      return  modelMap;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>外部通过对接口地址的调用，从而实现交互获取数据、进行页面渲染和展示。</p>
<p>但是，在使用了 <strong>Spring Boot</strong> 后， <strong>Main</strong> 方法又成为了程序的入口；</p>
<p>使用过<strong>springBoot</strong>进行项目打包和部署启动的都知道， <strong>SpringBoot</strong> 打包成 <strong>jar</strong> 包后，可以不需要部署到<strong>Tomcat</strong> 上而直接用命令启动，<strong>如下</strong>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -jar xxx.jar</span><br></pre></td></tr></table></figure>

<p>这是因为<strong>Spring Boot</strong> 的<strong>jar</strong> 在启动时，程序经过 主启动类中的<strong>main</strong> 方法进行启动的；<strong>主启动</strong>类代码如下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmall;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(DemoApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里为项目创建一个接口，并分别在接口和主启动类<strong>main</strong>方法上打断点， </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu31.png" width="60%">

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu32.png" width="60%">

<p>在<strong>Spring Boot</strong> 项目中每次调用接口前都会先启动 主启动类，这里对主启动类的 <strong>main</strong> 方法入口进行分析；</p>
<p>在上图中，主启动类启动后会进入<strong>main</strong> 方法中，并在方法中由 <strong>SpringApplication</strong> 调用 <strong>run （）</strong>方法，方法中形参传入当前类的 <strong>class</strong> 对象以及<strong>main</strong> 方法的 <strong>args</strong>  参数。</p>
<p>下一步进入 <strong>run()</strong> 方法中，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Object source, String... args)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> run(<span class="keyword">new</span> Object[]&#123;source&#125;, args);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu33.png" width="60%">

<p>由截图可知，传入的<strong>class</strong> 对象被用来创建 <strong>SpringApplication</strong>实例对象，并由生成的实例调用 <strong>run （args）</strong> 方法做启动操作，方法形参为 <strong>args</strong> 参数。</p>
<p><strong>①创建 SpringApplication 实例，进行初始化对象：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> SpringApplication ( Object... sources)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(Object... sources)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">      <span class="keyword">this</span>.bannerMode = Mode.CONSOLE;</span><br><span class="line">      <span class="keyword">this</span>.logStartupInfo = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.addCommandLineProperties = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.headless = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.registerShutdownHook = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.additionalProfiles = <span class="keyword">new</span> HashSet();</span><br><span class="line">      <span class="keyword">this</span>.initialize(sources);   <span class="comment">// 初始化启动类</span></span><br><span class="line">    </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在 该构造函数的 方法体中，对当前类进行了初始化， </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Object[] sources)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">if</span> (sources != <span class="keyword">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">this</span>.sources.addAll(Arrays.asList(sources));   <span class="comment">// 添加启动类 DemoApplication.class 到 set 集合中，以备后用</span></span><br><span class="line">         </span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">this</span>.webEnvironment = <span class="keyword">this</span>.deduceWebEnvironment();  <span class="comment">// 重点：检测当前是否为 web 环境      </span></span><br><span class="line">                                                     <span class="keyword">this</span>.setInitializers(<span class="keyword">this</span>.getSpringFactoriesInstances(ApplicationContextInitializer<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">  </span><br><span class="line">     <span class="keyword">this</span>.setListeners(<span class="keyword">this</span>.getSpringFactoriesInstances(ApplicationListener<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">this</span>.mainApplicationClass = <span class="keyword">this</span>.deduceMainApplicationClass();</span><br><span class="line">    </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu34.png" width="60%">

<p>上图中的 webEnvironment 用于检测当前环境是否为 web 环境，如果是，则返回true.</p>
<p>具体如何判断当前环境是否为 web 环境，后面再做分析.</p>
<p><strong>获取初始化器：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu35.png" width="60%">

<p>在确定是否为web环境后，会根据 <strong>ApplicationContextInitializer</strong>.<strong>class</strong> 获取<strong>工厂实例参数</strong>从而<strong>设置初始化器的参数</strong>；</p>
<p>随后 用<strong>setListeners</strong> 设置监听器</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu36.png" width="60%">

<p>判断并获取主启动类的类型，通过获取jvm运行时的栈（StackTraceElement[]）中的多个加载的类，判断类中方法是否符合  <strong>main</strong> 方法 的类即为当前启动类，</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu37.png" width="60%">

<p>   到这里，<strong>SpringApplication</strong> 的初始化过程就执行完毕了；此时的<strong>SpringApplication</strong> 实例的启动需要调用<strong>run()</strong> 方法来实现，下一节进行分析；</p>
<p>以下是初始化过程的重要环节的关系图：    </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu38.png" width="60%">

<p>判断当前环境是否为 web 环境： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.webEnvironment = <span class="keyword">this</span>.deduceWebEnvironment();  <span class="comment">// 重点：检测当前是否为 web 环境</span></span><br></pre></td></tr></table></figure>

<p>我们进入 deduceWebEnvironment（）方法去看一看， </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">deduceWebEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    String[] var1 = WEB_ENVIRONMENT_CLASSES;</span><br><span class="line">    <span class="keyword">int</span> var2 = var1.length;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> var3 = <span class="number">0</span>; var3 &lt; var2; ++var3) &#123;</span><br><span class="line">        </span><br><span class="line">        String className = var1[var3];</span><br><span class="line">        <span class="keyword">if</span> (!ClassUtils.isPresent(className, (ClassLoader)<span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由源码可知， deduceWebEnvironment 中对 私有变量 <strong>WEB_ENVIRONMENT_CLASSES</strong>进行了循环，继续查看它所代表的是什么？ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] WEB_ENVIRONMENT_CLASSES = <span class="keyword">new</span> String[]&#123;<span class="string">"javax.servlet.Servlet"</span>, <span class="string">"org.springframework.web.context.ConfigurableWebApplicationContext"</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>该私有变量数组有两个参数构成，第一个参数是 “javax.servlet.Servlet”，第二个参数是  “ConfigurableWebApplicationContext”，这里对“ConfigurableWebApplicationContext”进行分析： </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu39.png" width="60%">

<p>进入ConfigurableWebApplicationContext类中，我们看到该类继承自 WebApplicationContext 和 ConfigurableApplicationContext两个类，再往下看：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu40.png" width="60%">

<p>我们看到 WebApplicationContext 继承自 ApplicationContext 类，而我们知道 ApplicationContext 是可以用来创建IOC 容器的对象的，如： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicatioonContext context = <span class="keyword">new</span> ClasspathXmlApplicationContext();</span><br></pre></td></tr></table></figure>

<p>该ApplicationContext类是所有IOC 容器对象的顶级接口</p>
<p>阶段小结：<strong>ConfigurableWebApplicationContext</strong> 是 <strong>web</strong> 环境下可以配置的IOC 容器。</p>
<p>那么拿到该类的全类名有什么用呢？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ClassUtils.isPresent(className, (ClassLoader)<span class="keyword">null</span>)) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPresent</span><span class="params">(String className, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        </span><br><span class="line">        forName(className, classLoader);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 deduceWebEnvironment 方法中调用了 isPresent 方法，而在isPresent方法中有调用 forName ,将全类名 className 作为形参传入 forName中，此处的 classLoader 是null值。</p>
<p>这里进入 ClassUtils的forName（）方法中，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String name, ClassLoader classLoader) <span class="keyword">throws</span> ClassNotFoundException, LinkageError &#123;</span><br><span class="line">    </span><br><span class="line">        Assert.notNull(name, <span class="string">"Name must not be null"</span>);</span><br><span class="line">    </span><br><span class="line">        Class&lt;?&gt; clazz = resolvePrimitiveClassName(name);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (clazz == <span class="keyword">null</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            clazz = (Class)commonClassCache.get(name);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> clazz;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Class elementClass;</span><br><span class="line">            String elementName;</span><br><span class="line">            <span class="keyword">if</span> (name.endsWith(<span class="string">"[]"</span>)) &#123;</span><br><span class="line">                elementName = name.substring(<span class="number">0</span>, name.length() - <span class="string">"[]"</span>.length());</span><br><span class="line">                elementClass = forName(elementName, classLoader);</span><br><span class="line">                <span class="keyword">return</span> Array.newInstance(elementClass, <span class="number">0</span>).getClass();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.startsWith(<span class="string">"[L"</span>) &amp;&amp; name.endsWith(<span class="string">";"</span>)) &#123;</span><br><span class="line">                elementName = name.substring(<span class="string">"[L"</span>.length(), name.length() - <span class="number">1</span>);</span><br><span class="line">                elementClass = forName(elementName, classLoader);</span><br><span class="line">                <span class="keyword">return</span> Array.newInstance(elementClass, <span class="number">0</span>).getClass();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.startsWith(<span class="string">"["</span>)) &#123;</span><br><span class="line">                elementName = name.substring(<span class="string">"["</span>.length());</span><br><span class="line">                elementClass = forName(elementName, classLoader);</span><br><span class="line">                <span class="keyword">return</span> Array.newInstance(elementClass, <span class="number">0</span>).getClass();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ClassLoader clToUse = classLoader;</span><br><span class="line">                <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    clToUse = getDefaultClassLoader();</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> clToUse != <span class="keyword">null</span> ? clToUse.loadClass(name) : Class.forName(name);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException var9) &#123;</span><br><span class="line">                    <span class="keyword">int</span> lastDotIndex = name.lastIndexOf(<span class="number">46</span>);</span><br><span class="line">                    <span class="keyword">if</span> (lastDotIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">                        String innerClassName = name.substring(<span class="number">0</span>, lastDotIndex) + <span class="string">'$'</span> + name.substring(lastDotIndex + <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> clToUse != <span class="keyword">null</span> ? clToUse.loadClass(innerClassName) : Class.forName(innerClassName);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (ClassNotFoundException var8) &#123;</span><br><span class="line">                            ;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"> </span><br><span class="line">                    <span class="keyword">throw</span> var9;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>其中的   Class&lt;?&gt; clazz = resolvePrimitiveClassName(name); 根据全类名获取class 字节码文件对象；在获取到的class 对象不为null 的情况下，clazz = (Class)commonClassCache.get(name); 获取常用类缓存中是否也存在该class对象；</p>
<p>如果两次获取的 clazz 都不为null是存在的，那么就直接返回：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br></pre></td></tr></table></figure>

<p>由此我们可以知道,<strong>isPresent</strong>()方法的作用，是为了查看当前环境中有没有指定的工程项目的类。</p>
<p>从这里，我们可以做出总结，<strong>deduceWebEnvironment</strong> () 方法中通过判断 “<strong>WEB_ENVIRONMENT_CLASSES</strong>”数组中声明的两个类能否在当前环境中找到，如果能，说明当前环境为web 环境。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] WEB_ENVIRONMENT_CLASSES = <span class="keyword">new</span> String[]&#123;<span class="string">"javax.servlet.Servlet"</span>, <span class="string">"org.springframework.web.context.ConfigurableWebApplicationContext"</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>② <strong>SpringApplication</strong>实例的启动过程：</p>
<p>在获取到SpringApplication的实例并初始化完成后，其启动使用<strong>run()</strong> 方法实现，</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu41.png" width="80%">

<p>进入 run(args）方法中， </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        stopWatch.start();</span><br><span class="line">        ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">        FailureAnalyzers analyzers = <span class="keyword">null</span>;   <span class="comment">// 失败分析器</span></span><br><span class="line">        <span class="keyword">this</span>.configureHeadlessProperty();    <span class="comment">// 读取property 文件</span></span><br><span class="line">        SpringApplicationRunListeners listeners = <span class="keyword">this</span>.getRunListeners(args); <span class="comment">// 加载监听器</span></span><br><span class="line">        listeners.starting();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);       <span class="comment">// 应用参数</span></span><br><span class="line">            ConfigurableEnvironment environment = <span class="keyword">this</span>.prepareEnvironment(listeners, applicationArguments);                   <span class="comment">// 配置文件参数（有默认值，可读取自定义配置文件），用于配置当前环境</span></span><br><span class="line">            Banner printedBanner = <span class="keyword">this</span>.printBanner(environment);   <span class="comment">// banner的自定义机制</span></span><br><span class="line">            context = <span class="keyword">this</span>.createApplicationContext();              <span class="comment">// 创建可配置的 IOC 容器</span></span><br><span class="line">            <span class="keyword">new</span> FailureAnalyzers(context);                          <span class="comment">// 传入配置好的 IOC 容器 创建失败分析器对象</span></span><br><span class="line">            <span class="keyword">this</span>.prepareContext(context, environment, listeners, applicationArguments, printedBanner);                              <span class="comment">// 传入失败分析器，环境参数、监听器、banner 配置等进行刷新</span></span><br><span class="line">            <span class="keyword">this</span>.refreshContext(context);                          <span class="comment">// 根据ioc 刷新上下文容器，并打印日志 ，此时TOMCAT / JETTY 容器会被启动</span></span><br><span class="line">            <span class="keyword">this</span>.afterRefresh(context, applicationArguments);      <span class="comment">// 映射 dispatcherServlet 等</span></span><br><span class="line">            listeners.finished(context, (Throwable)<span class="keyword">null</span>);          <span class="comment">// 监听IOC容器上下文</span></span><br><span class="line">            stopWatch.stop();                                       <span class="comment">// 计时结束</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">                (<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)).logStarted(<span class="keyword">this</span>.getApplicationLog(), stopWatch);</span><br><span class="line">            &#125; <span class="comment">// 停止打印日志</span></span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> context;        <span class="comment">// 返回启动成功的结果，以及返回启动消耗的时间</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var9) &#123;</span><br><span class="line">            <span class="keyword">this</span>.handleRunFailure(context, listeners, (FailureAnalyzers)analyzers, var9);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var9);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里先从  stopWatch 开始说，在run（） 方法中，一开始创建了 StopWatch的对象实例，并调用 start() 进行启动， </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">stopWatch.start();</span><br><span class="line">    </span><br><span class="line">。。。。</span><br><span class="line">stopWatch.stop();</span><br></pre></td></tr></table></figure>

<p>这里的 stopWatch 是一个观察用的表，springboot项目启动后返回的启动花费了多少秒、分的时间就是由 stopWatch() 来提供的。 </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu42.png" width="80%">

<p>总结： 在public ConfigurableApplicationContext run(String… args)方法中，最终返回的是自定义配置的IOC容器。</p>
<p>到这里，SpringBoot 的主启动类 Main 方法的初始化和启动过程就结束了。</p>
<p>③ 包扫描；</p>
<p>我们知道 Spring 中IOC通过 依赖注入和控制反转将被调用者Bean的创建交给<strong>Spring</strong> 代理生成，并注入到IOC容器中；而在<strong>SpringBoot</strong>中， 接口的调用必须基于<strong>SpringBoot</strong> 主启动类的同级包或子包范围内；</p>
<p>规范化的开发中需要指定好 <strong>Handler</strong> 和 <strong>dao</strong> 层的包位置，分别指定的包扫描方式为：</p>
<p><strong>控制器与业务层 :</strong></p>
<p><strong>自动扫描：</strong>  主要针对 <strong>@Controller、@Service</strong> 标注的类，该类所在包必须为主启动类所在包的子包；</p>
<p><strong>手动指定扫描：</strong>在主启动类上使用<strong>@CompomentScan(“com.mmall.handler”)</strong> 注解</p>
<p><strong>持久层：</strong> </p>
<p>方式一：使用@MapperScan</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@MapperScan(&quot;com.mmall.demo.dao&quot;)标记在主启动类上</span><br></pre></td></tr></table></figure>

<p>方式二： 使用@Mapper </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpMapper</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">     ......................</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot原理篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot整合（二）集成SMTP发送邮件</title>
    <url>/2020/03/07/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E9%9B%86%E6%88%90SMTP%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/</url>
    <content><![CDATA[<h3 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h3><blockquote>
<p>可发送邮箱链接进行用户注册认证等</p>
</blockquote>
<h3 id="1、添加SMTP-及-MAIL-的-pom-xml-依赖"><a href="#1、添加SMTP-及-MAIL-的-pom-xml-依赖" class="headerlink" title="1、添加SMTP 及 MAIL 的 pom.xml 依赖"></a>1、添加SMTP 及 MAIL 的 pom.xml 依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">      <span class="comment">&lt;!--郵箱發送--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>  依赖添加后会要求刷新 springBootConguration 的配置信息，可执行也可不理睬</p>
<p><strong>具体操作如下：</strong></p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu22.png" width="80%">

<h3 id="2、配置yml邮箱参数"><a href="#2、配置yml邮箱参数" class="headerlink" title="2、配置yml邮箱参数"></a>2、配置yml邮箱参数</h3><h4 id="2-1-在-application-dev-yml中配置对应的邮箱参数"><a href="#2-1-在-application-dev-yml中配置对应的邮箱参数" class="headerlink" title="2.1 在 application-dev.yml中配置对应的邮箱参数"></a>2.1 在 application-dev.yml中配置对应的邮箱参数</h4><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#邮件配置</span></span><br><span class="line"><span class="attr">email</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">host</span>: <span class="string">smtp.163.com</span></span><br><span class="line">  <span class="attr">username</span>: <span class="string">1598974689@163.com</span></span><br><span class="line">  <span class="attr">password</span>: <span class="string">1598974689wsp</span></span><br><span class="line">  <span class="attr">senderName</span>: <span class="string">1598974689@163.com</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#发送提醒邮件的接收方</span></span><br><span class="line"><span class="attr">sendToMail</span>: <span class="string">1862030785@foxmail.com</span></span><br><span class="line"><span class="attr">sendToPeopleName</span>: <span class="string">wen</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-由于是使用SMTP实现邮箱发送，除了提供必要的邮箱、密码等参数外，还要开启邮箱账号的-SMTP-设置，"><a href="#2-2-由于是使用SMTP实现邮箱发送，除了提供必要的邮箱、密码等参数外，还要开启邮箱账号的-SMTP-设置，" class="headerlink" title="2.2 由于是使用SMTP实现邮箱发送，除了提供必要的邮箱、密码等参数外，还要开启邮箱账号的 SMTP 设置，"></a>2.2 由于是使用SMTP实现邮箱发送，除了提供必要的邮箱、密码等参数外，还要开启邮箱账号的 SMTP 设置，</h4><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu23.png" width="80%">

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu24.png" width="80%">

<blockquote>
<p>打勾选中要设置的服务项，通过校验短信息设置授权码，使用授权码代替  邮箱密码 实现邮件的发送，流程很简单的。 </p>
</blockquote>
<h3 id="3、相关工具类和-实体类的创建"><a href="#3、相关工具类和-实体类的创建" class="headerlink" title="3、相关工具类和 实体类的创建"></a>3、相关工具类和 实体类的创建</h3><h4 id="3-1-邮箱-参数-config"><a href="#3-1-邮箱-参数-config" class="headerlink" title="3.1 邮箱 参数 config"></a>3.1 邮箱 参数 config</h4><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu25.png" width="80%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.model.common;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> EmailConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/25 10:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"email"</span>, ignoreUnknownFields = <span class="keyword">false</span>)</span><br><span class="line"><span class="comment">//@PropertySource("classpath:/application.yml")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String senderName;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHost</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSenderName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> senderName;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSenderName</span><span class="params">(String senderName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.senderName = senderName;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"EmailConfig&#123;"</span> +</span><br><span class="line">                <span class="string">"host='"</span> + host + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", senderName='"</span> + senderName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-Email-发送实现工具类"><a href="#3-2-Email-发送实现工具类" class="headerlink" title="3.2  Email 发送实现工具类"></a>3.2  Email 发送实现工具类</h4><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu26.png" width="50%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.utils.Email;</span><br><span class="line"><span class="keyword">import</span> com.example.poiutis.model.common.EmailConfig;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSenderImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MailSenderFacade</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/25 10:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailSenderFacade</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmailConfig emailConfig;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MailSenderFacade<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMailHtml</span><span class="params">(<span class="keyword">final</span> String toEmail,<span class="keyword">final</span> String subject,<span class="keyword">final</span> String text)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            JavaMailSenderImpl javaMailSender = <span class="keyword">new</span> JavaMailSenderImpl();</span><br><span class="line">            javaMailSender.setUsername(emailConfig.getUsername());</span><br><span class="line">            javaMailSender.setPassword(emailConfig.getPassword());</span><br><span class="line">            javaMailSender.setHost(emailConfig.getHost());</span><br><span class="line">            javaMailSender.setPort(<span class="number">25</span>);</span><br><span class="line">            javaMailSender.setProtocol(<span class="string">"smtp"</span>);</span><br><span class="line">            javaMailSender.setDefaultEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">            Properties mailProperties = <span class="keyword">new</span> Properties();</span><br><span class="line">            mailProperties.put(<span class="string">"mail.smtp.auth"</span>, <span class="keyword">true</span>);</span><br><span class="line">            mailProperties.put(<span class="string">"mail.smtp.starttls.enable"</span>, <span class="keyword">true</span>);</span><br><span class="line">            javaMailSender.setJavaMailProperties(mailProperties);</span><br><span class="line">            MimeMessage mimeMessage = getMimeMessage(toEmail,subject,text, javaMailSender);</span><br><span class="line">            javaMailSender.send(mimeMessage);</span><br><span class="line">            logger.info(<span class="string">"发往 "</span>+toEmail+<span class="string">" 邮件发送成功"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MessagingException e) &#123;</span><br><span class="line">            logger.error(<span class="string">"发往 "</span>+toEmail+<span class="string">" 邮件发送异常"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> MimeMessage <span class="title">getMimeMessage</span><span class="params">(String toEmail,String subject,String text, JavaMailSenderImpl javaMailSender)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">        mimeMessageHelper.setFrom(emailConfig.getSenderName());</span><br><span class="line">        mimeMessageHelper.setTo(toEmail);</span><br><span class="line">        mimeMessageHelper.setSubject(subject);</span><br><span class="line">        mimeMessageHelper.setText(text, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> mimeMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、测试SMTP功能发送一个邮件试试"><a href="#4、测试SMTP功能发送一个邮件试试" class="headerlink" title="4、测试SMTP功能发送一个邮件试试"></a>4、测试SMTP功能发送一个邮件试试</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/please/emailTest"</span>, method = RequestMethod.GET)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">getEmailTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           Map&lt;String,Object&gt; map = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">           mailSenderFacade.sendMailHtml(<span class="string">"18620307785@163.com"</span>, <span class="string">"来自邮箱测试接口邮件"</span>, <span class="string">"来自邮箱测试接口邮件"</span>);</span><br><span class="line">           map.put(<span class="string">"state"</span>,<span class="string">"0"</span>);</span><br><span class="line">           map.put(<span class="string">"message"</span>, <span class="string">"导出成功"</span>);</span><br><span class="line"></span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           map.put(<span class="string">"state"</span>,<span class="string">"1"</span>);</span><br><span class="line">           map.put(<span class="string">"message"</span>, <span class="string">"导出失敗"</span>);</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> map;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>发送成功：</strong> </p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu27.png" width="60%">

<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu28.png" width="60%">

<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/spring-boot-smtp" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot整合（一）集成swagger-ui</title>
    <url>/2020/03/06/SpringBoot%E6%95%B4%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E9%9B%86%E6%88%90swagger-ui/</url>
    <content><![CDATA[<h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a><strong>前言：</strong></h3><p><strong>使用swagger-ui 的原因之一，也是最重要的原因。</strong></p>
<ul>
<li>SwaggerHub充当我们的API开发人员门户，产品所有者，Test QA分析人员，开发人员和架构师可以在其中进行API设计和开发并进行协作。 </li>
<li>SwaggerHub充当协作的集中主机，使该过程非常高效，直观和无缝。 </li>
<li>SwaggerHub旨在为组织和团队提供最佳的体验，以维护和扩展从设计到部署的API开发。  </li>
<li>SwaggerHub的自动生成的API文档使内部和外部用户易于使用您的API。 </li>
</ul>
<p><strong>官网链接地址</strong>：<a href="https://swagger.io/tools/swaggerhub/" target="_blank" rel="noopener">https://swagger.io/tools/swaggerhub/</a> </p>
<h3 id="1、工程创建"><a href="#1、工程创建" class="headerlink" title="1、工程创建"></a>1、工程创建</h3><blockquote>
<p> 创建一个maven 管理的springboot 工程，这里不做赘述</p>
</blockquote>
<h3 id="2、添加依赖"><a href="#2、添加依赖" class="headerlink" title="2、添加依赖"></a>2、添加依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">       <span class="comment">&lt;!--SpringBoot整合Swagger-ui--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、设置配置类"><a href="#3、设置配置类" class="headerlink" title="3、设置配置类"></a>3、设置配置类</h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu17.png" width="60%">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.poiutis.config;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> SwaggerConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> wushaopei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/22 16:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 启动时加载类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 启用Swagger API文档</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">api</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">// 自行修改为自己的包路径</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.example.poiutis.controller"</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"报表管理"</span>)</span><br><span class="line">                .description(<span class="string">"报表管理中心 API 1.0 操作文档"</span>)</span><br><span class="line">                <span class="comment">//服务条款网址</span></span><br><span class="line">                .termsOfServiceUrl(<span class="string">"https://blog.csdn.net/weixin_42405670"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"鮀城小帅"</span>, <span class="string">"https://blog.csdn.net/weixin_42405670"</span>, <span class="string">"15989746839@163.com"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<blockquote>
<p>启动类加上注解<strong>@EnableSwagger</strong></p>
</blockquote>
<p>启动该注解使得用在<strong>controller</strong>中的<strong>swagger</strong>注解生效，覆盖的范围下的所有<strong>controller</strong></p>
</blockquote>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu18.png" width="80%">

<h3 id="4、Controller-类配置"><a href="#4、Controller-类配置" class="headerlink" title="4、Controller 类配置"></a>4、Controller 类配置</h3><p><strong>@Api的使用</strong> </p>
<p><strong>API</strong>作用在<strong>Controller</strong>,作为swagger文档资源,该注解将一个<strong>controller</strong>标注为一个<strong>Swagger</strong>资源(API). 在默认情况下，<strong>Swagger</strong>-<strong>Core</strong> 只会扫描解析具有 @Api 注解的类，而会自动忽略其他类别资源（<strong>JAX-RS endpoints、Servlets</strong> 等）的注解。</p>
<p><strong>@ApiOperation</strong> 的使用</p>
<p><strong>ApiOperation</strong> 定义在方法上，描述方法名、方法解释、返回信息、标记等信息。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发票管理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> issuser</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api</span>(value = <span class="string">"发票"</span>,description = <span class="string">"发票操作 API"</span>, position = <span class="number">100</span>, protocols = <span class="string">"http"</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/webcode"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvoiceController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(InvoiceController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    invoiceOrderService InvoiceOrderService;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@ApiOperation</span>(value = <span class="string">"导出操作日志到xls文件"</span>, notes = <span class="string">"需要登录"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/exporInvoiceOrderXls"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">exporInvoiceOrderXls</span><span class="params">( HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        @RequestParam(value=<span class="string">"invoiceOrders"</span>)</span>@<span class="title">ApiParam</span><span class="params">(value=<span class="string">"invoiceOrders"</span>)</span> List&lt;String&gt;  invoiceOrders) </span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        response.setContentType(<span class="string">"octets/stream"</span>);</span><br><span class="line"> </span><br><span class="line">        Map&lt;String, Object&gt; map2 = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        map2.put(<span class="string">"sheetTitle"</span>, <span class="string">"消费记录"</span>);</span><br><span class="line">        map2.put(<span class="string">"header"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"订单号"</span>, <span class="string">"商店名称"</span>, <span class="string">"发票批次"</span>, <span class="string">"账户名称"</span>, <span class="string">"商店地址"</span>, <span class="string">"刷卡账号"</span>,<span class="string">"商店电话"</span>,<span class="string">"信用卡开户行名称"</span>&#125;);</span><br><span class="line">        map2.put(<span class="string">"fields"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"invoiceOrder"</span>, <span class="string">"companyName"</span>, <span class="string">"taxNumber"</span>, <span class="string">"accountBank"</span>, <span class="string">"companyAddress"</span>,<span class="string">"bankNumber"</span>,<span class="string">"companyTelephone"</span>,<span class="string">"accountName"</span>&#125;);</span><br><span class="line"> </span><br><span class="line">        List&lt;InvoiceOrder&gt; invoiceOrderss = InvoiceOrderService.queryInvoiceLists(invoiceOrders,<span class="number">0</span>,<span class="number">9999</span>);</span><br><span class="line">        map2.put(<span class="string">"data"</span>,invoiceOrderss);</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(map2);</span><br><span class="line"> </span><br><span class="line">        String title = <span class="string">"日常消费刷卡发票记录"</span>;</span><br><span class="line"> </span><br><span class="line">        Map&lt;String, <span class="keyword">short</span>[]&gt; mergedRegion = <span class="keyword">new</span> HashMap&lt;String, <span class="keyword">short</span>[]&gt;();</span><br><span class="line">        mergedRegion.put(<span class="string">"通用标题名称合并"</span>, <span class="keyword">new</span> <span class="keyword">short</span>[] &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>&#125;);</span><br><span class="line"> </span><br><span class="line">        ExportExcel&lt;InvoiceOrder&gt; ex = <span class="keyword">new</span> ExportExcel&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 声明一个工作薄</span></span><br><span class="line">        HSSFWorkbook workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">        <span class="comment">// 生成一个标题样式</span></span><br><span class="line">        HSSFCellStyle headerStyle = ex.cellStyle(workbook);</span><br><span class="line">        <span class="comment">// 生成一个内容样式</span></span><br><span class="line">        HSSFCellStyle textStyle = ex.cellStyle(workbook);</span><br><span class="line">        <span class="comment">// 生成标题字体</span></span><br><span class="line">        ex.setFont(workbook, headerStyle, (<span class="keyword">short</span>) <span class="number">10</span>, HSSFFont.BOLDWEIGHT_NORMAL);</span><br><span class="line">        <span class="comment">// 生成内容字体</span></span><br><span class="line">        ex.setFont(workbook, textStyle, HSSFFont.BOLDWEIGHT_NORMAL);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            OutputStream out = response.getOutputStream();</span><br><span class="line">            <span class="comment">// 导出文件名称添加当前时间</span></span><br><span class="line">            String date = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmss"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="comment">//防止乱码</span></span><br><span class="line"><span class="comment">//            response.addHeader("Access-Control-Expose-Headers", "Content-Type,Content-Disposition");</span></span><br><span class="line"><span class="comment">//            response.addHeader("Content-Disposition",</span></span><br><span class="line"><span class="comment">//                    "attachment;filename=" + URLEncoder.encode(title, "GBK") + date</span></span><br><span class="line"><span class="comment">//                            + ".xls");</span></span><br><span class="line">            response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + <span class="keyword">new</span> String((title+<span class="string">".xls"</span>).getBytes(<span class="string">"GB2312"</span>),<span class="string">"ISO8859-1"</span>));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            list.forEach(m -&gt; &#123;</span><br><span class="line">                ExcelModel excelModel = <span class="keyword">new</span> ExcelModel();</span><br><span class="line">                excelModel.setWorkbook(workbook);</span><br><span class="line">                excelModel.setTitle(title);</span><br><span class="line">                excelModel.setFields((String[]) m.get(<span class="string">"fields"</span>));</span><br><span class="line">                excelModel.setHeader((String[]) m.get(<span class="string">"header"</span>));</span><br><span class="line">                excelModel.setHeaderRow(<span class="number">2</span>);</span><br><span class="line">                excelModel.setMergedRegion(mergedRegion);</span><br><span class="line">                excelModel.setHeaderStyle(headerStyle);</span><br><span class="line">                excelModel.setTextStyle(textStyle);</span><br><span class="line">                excelModel.setTitles((String) m.get(<span class="string">"sheetTitle"</span>));</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// 生成一页表格</span></span><br><span class="line">                HSSFSheet sheet = workbook.createSheet((String) m.get(<span class="string">"sheetTitle"</span>));</span><br><span class="line">                excelModel.setSheet(sheet);</span><br><span class="line">                ex.exportExcel(excelModel, (Collection&lt;InvoiceOrder&gt;) m.get(<span class="string">"data"</span>));</span><br><span class="line">            &#125;);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                workbook.write(out);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            map.put(<span class="string">"state"</span>,<span class="string">"0"</span>);</span><br><span class="line">            map.put(<span class="string">"message"</span>, <span class="string">"导出成功"</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            map.put(<span class="string">"state"</span>, <span class="string">"1"</span>);</span><br><span class="line">            map.put(<span class="string">"message"</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>url 的路径值</td>
</tr>
<tr>
<td>tags</td>
<td>如果设置这个值，value 的值会被覆盖</td>
</tr>
<tr>
<td>description</td>
<td>对 API 资源的描述</td>
</tr>
<tr>
<td>produces</td>
<td>For example, “application/json, application/xml”</td>
</tr>
<tr>
<td>consumes</td>
<td>For example, “application/json, application/xml”</td>
</tr>
<tr>
<td>protocols</td>
<td>Possible values: http, https, ws, wss</td>
</tr>
<tr>
<td>authorizations</td>
<td>高级特性认证时配置</td>
</tr>
<tr>
<td>hidden</td>
<td>配置为 true 将在文档中隐藏</td>
</tr>
<tr>
<td>response</td>
<td>返回的对象</td>
</tr>
<tr>
<td>responseContainer</td>
<td>这些对象是有效的 “List”, “Set” or “Map”，其他无效</td>
</tr>
<tr>
<td>httpMethod</td>
<td>“GET”、”HEAD”、”POST”、”PUT”、”DELETE”、”OPTIONS” and “PATCH”</td>
</tr>
<tr>
<td>code</td>
<td>http 的状态码 默认 200</td>
</tr>
<tr>
<td>extensions</td>
<td>扩展属性</td>
</tr>
</tbody></table>
<p><strong>@ApiImplicitParams</strong> 和 <strong>@ApiImplicitParam</strong> 的使用</p>
<p><strong>@ApiImplicitParams</strong> 用于描述方法的返回信息，和 <strong>@ApiImplicitParam</strong> 注解配合使用；<strong>@ApiImplicitParam</strong> 用来描述具体某一个参数的信息，包括参数的名称、类型、限制等信息。</p>
<hr>
<h3 id="5、启动项目，进入API列表，localhost-swagger-ui-html"><a href="#5、启动项目，进入API列表，localhost-swagger-ui-html" class="headerlink" title="5、启动项目，进入API列表，localhost/swagger-ui.html#"></a>5、启动项目，进入API列表，localhost/swagger-ui.html#</h3><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu19.png" width="80%">

<p>完整<strong>springBoot</strong> 整合 <strong>Swagger</strong> 代码 <strong>GitHub</strong> 链接地址：</p>
<p><strong>注意问题：</strong></p>
<p>出现以下问题时，要检查<strong>SwaggerConfig</strong> 中配置的路径是否正确；</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu20.png" width="80%">

<p>即：</p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu21.png" width="80%">

<h3 id="6、Swagger常用注解"><a href="#6、Swagger常用注解" class="headerlink" title="6、Swagger常用注解"></a>6、Swagger常用注解</h3><table>
<thead>
<tr>
<th>作用范围</th>
<th>API</th>
<th>使用位置</th>
</tr>
</thead>
<tbody><tr>
<td>协议集描述</td>
<td>@Api</td>
<td>用于 Controller 类上</td>
</tr>
<tr>
<td>协议描述</td>
<td>@ApiOperation</td>
<td>用在 Controller 的方法上</td>
</tr>
<tr>
<td>非对象参数集</td>
<td>@ApiImplicitParams</td>
<td>用在 Controller 的方法上</td>
</tr>
<tr>
<td>非对象参数描述</td>
<td>@ApiImplicitParam</td>
<td>用在 @ApiImplicitParams 的方法里边</td>
</tr>
<tr>
<td>响应集</td>
<td>@ApiResponses</td>
<td>用在 Controller 的方法上</td>
</tr>
<tr>
<td>响应信息参数</td>
<td>@ApiResponse</td>
<td>用在 @ApiResponses 里边</td>
</tr>
<tr>
<td>描述返回对象的意义</td>
<td>@ApiModel</td>
<td>用在返回对象类上</td>
</tr>
<tr>
<td>对象属性</td>
<td>@ApiModelProperty</td>
<td>用在出入参数对象的字段上</td>
</tr>
</tbody></table>
<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/springBoot-swaggerui" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot整合篇</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot基础（四）整合 mybatis</title>
    <url>/2020/03/06/SpringBoot%E5%9F%BA%E7%A1%80%EF%BC%88%E5%9B%9B%EF%BC%89%E6%95%B4%E5%90%88-mybatis/</url>
    <content><![CDATA[<h4 id="1、增加持久化层"><a href="#1、增加持久化层" class="headerlink" title="1、增加持久化层"></a>1、增加持久化层</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、实体类及表的创建"><a href="#2、实体类及表的创建" class="headerlink" title="2、实体类及表的创建"></a>2、实体类及表的创建</h3><p>实体类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer empId;</span><br><span class="line">	<span class="keyword">private</span> String empName;</span><br><span class="line">	<span class="keyword">private</span> Integer empAge;</span><br><span class="line">    …… </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`table_emp`</span> (</span><br><span class="line"><span class="string">`emp_id`</span>  <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT ,</span><br><span class="line"><span class="string">`emp_name`</span>  <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="literal">NULL</span> ,</span><br><span class="line"><span class="string">`emp_age`</span>  <span class="built_in">int</span> <span class="literal">NULL</span> ,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`emp_id`</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3、Mapper-及配置文件"><a href="#3、Mapper-及配置文件" class="headerlink" title="3、Mapper 及配置文件"></a>3、Mapper 及配置文件</h3><p>*mapper.java </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpMapper</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;Emp&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>*mapper.xml </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.webcode.springboot.mappers.EmpMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultType</span>=<span class="string">"com.webcode.springboot.bean.Emp"</span>&gt;</span></span><br><span class="line">		select emp_id empId, emp_name empName, emp_age empAge</span><br><span class="line">		from table_emp</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4、Service-业务接口及实现"><a href="#4、Service-业务接口及实现" class="headerlink" title="4、Service 业务接口及实现"></a>4、Service 业务接口及实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;Emp&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empMapper.selectAll();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、handler-接口调用"><a href="#5、handler-接口调用" class="headerlink" title="5、handler 接口调用"></a>5、handler 接口调用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmpService empService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/getAll"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empService.getAll();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、application-yml-配置"><a href="#6、application-yml-配置" class="headerlink" title="6、application.yml 配置"></a>6、application.yml 配置</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">datasource</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">mydb</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">jdbc:mysql://127.0.0.1:3306/sb_db</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">root</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">root</span></span><br><span class="line">    <span class="meta">driver-class-name</span>: <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis</span>:<span class="string"></span></span><br><span class="line">  <span class="meta">mapper-locations</span>: <span class="string">classpath*:/mybatis/*Mapper.xml</span></span><br><span class="line"><span class="comment">    # spring boot集成mybatis的方式打印sql </span></span><br><span class="line">  <span class="attr">configuration</span>:<span class="string"></span></span><br><span class="line">    <span class="meta">log-impl</span>: <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment">   # 开启日志</span></span><br><span class="line"><span class="attr">logging</span>: <span class="string"></span></span><br><span class="line">  <span class="attr">level</span>:<span class="string"></span></span><br><span class="line">    <span class="meta">com.eth.wallet.mapper</span>: <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h3 id="7、在主启动类上使用注解扫描Mapper"><a href="#7、在主启动类上使用注解扫描Mapper" class="headerlink" title="7、在主启动类上使用注解扫描Mapper"></a>7、在主启动类上使用注解扫描Mapper</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.webcode.springboot.mappers"</span>)</span><br></pre></td></tr></table></figure>

<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/SpringBoot_mybatis" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot入门</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot基础（三）包扫描与启动过程</title>
    <url>/2020/03/06/SpringBoot%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%89%EF%BC%89%E5%8C%85%E6%89%AB%E6%8F%8F%E4%B8%8E%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h3 id="一-SpringBoot-的版本与启动过程"><a href="#一-SpringBoot-的版本与启动过程" class="headerlink" title="一. SpringBoot 的版本与启动过程"></a>一. SpringBoot 的版本与启动过程</h3><h5 id="1-SpringBoot都是jar工程"><a href="#1-SpringBoot都是jar工程" class="headerlink" title="1.SpringBoot都是jar工程"></a>1.SpringBoot都是jar工程</h5><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu13.png" width="80%">

<h5 id="2-SpringBoot-版本问题"><a href="#2-SpringBoot-版本问题" class="headerlink" title="2.SpringBoot 版本问题"></a>2.SpringBoot 版本问题</h5><blockquote>
<p>大版本1：内置的Spring是大版本4</p>
<p>​      1.5.8</p>
<p>​      1.5.12</p>
<p>大版本2：内置的Spring是大版本5</p>
</blockquote>
<h5 id="3-SpringBoot启动过程观察"><a href="#3-SpringBoot启动过程观察" class="headerlink" title="3.SpringBoot启动过程观察"></a>3.SpringBoot启动过程观察</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu14.png" alt=""></h5><p><strong>① 核心机制：</strong></p>
<img src="http://q6iswrm4f.bkt.clouddn.com/qiniu15.png" width="80%">

<p><strong>② 重要注解</strong></p>
<table>
<thead>
<tr>
<th>注解名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>@SpringBootApplication</td>
<td>声明一个SpringBoot程序，并使@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan等注解生效</td>
</tr>
<tr>
<td>@SpringBootConfiguration</td>
<td>相当于@Configuration注解的重新定义</td>
</tr>
<tr>
<td>@Configuration</td>
<td>声明一个Spring配置类</td>
</tr>
<tr>
<td>@Bean</td>
<td>在@Configuration注解标记的类中将标记了@Bean的方法返回值对象加入IOC容器，可以对应XML配置文件中的bean标签来理解</td>
</tr>
<tr>
<td>@EnableAutoConfiguration</td>
<td>启用自动配置</td>
</tr>
<tr>
<td>@AutoConfigurationPackage</td>
<td>当前包下包含需要自动扫描的类</td>
</tr>
<tr>
<td>@ComponentScan</td>
<td>指定要扫描的包</td>
</tr>
</tbody></table>
<h3 id="二-扫描包的问题"><a href="#二-扫描包的问题" class="headerlink" title="二. 扫描包的问题"></a>二. 扫描包的问题</h3><h5 id="1-自动扫描"><a href="#1-自动扫描" class="headerlink" title="1.自动扫描"></a>1.<strong>自动扫描</strong></h5><pre><code>需要被扫描的类（@Controller、@Service）所在的包是主启动类所在包的子类。 </code></pre><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu16.png" width="80%">

<h5 id="2-手动指定扫描的包"><a href="#2-手动指定扫描的包" class="headerlink" title="2.手动指定扫描的包"></a>2.手动指定扫描的包</h5><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">在主启动类上使用@ComponeneScan（“com.webcode.spring2boot.handler”）注解</span><br></pre></td></tr></table></figure>

<h5 id="3、-Configuration-注解"><a href="#3、-Configuration-注解" class="headerlink" title="3、@Configuration 注解"></a>3、@Configuration 注解</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;bean id="message" class="com.webcode.springboot.entities.Message"/&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lenovo</span></span><br><span class="line"><span class="comment"> * 当前这个类必须能够被扫描到</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span><span class="comment">//这个方法返回的对象会被加入到IOC容器中</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Message <span class="title">getMessageBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Message();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4、扫描Mapper接口的两种方式"><a href="#4、扫描Mapper接口的两种方式" class="headerlink" title="4、扫描Mapper接口的两种方式"></a>4、扫描Mapper接口的两种方式</h5><ul>
<li>方式一： 使用 @MapperScan </li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.webcode.springboot.mappers"</span>)标记在主启动类上</span><br></pre></td></tr></table></figure>

<ul>
<li><p>方式二：使用@Mapper </p>
<p>标记在Mapper接口上 </p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpMapper</span></span>&#123;</span><br><span class="line"></span><br><span class="line">     ......................</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="5、为Mybatis配置实体类包"><a href="#5、为Mybatis配置实体类包" class="headerlink" title="5、为Mybatis配置实体类包"></a>5、为Mybatis配置实体类包</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">mybatis:</span><br><span class="line">  mapper-locations: classpath*:/mybatis/mappers/*Mapper.xml</span><br><span class="line">  type-aliases-package: com.atguigu.springboot.entities</span><br></pre></td></tr></table></figure>

<h3 id="三、SpringBoot环境下配置文件"><a href="#三、SpringBoot环境下配置文件" class="headerlink" title="三、SpringBoot环境下配置文件"></a>三、SpringBoot环境下配置文件</h3><h5 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h5><blockquote>
<p>SpringBoot环境下常用的配置文件有两种，一种是properties 属性文件，一种是yml文件。二者各有特点，语法也有很大区别，但是最终效果基本一致。 </p>
</blockquote>
<h5 id="2、Properties-文件使用"><a href="#2、Properties-文件使用" class="headerlink" title="2、Properties 文件使用"></a>2、Properties 文件使用</h5><p><strong>文件名： application.properties</strong></p>
<p>语法格式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xxx.xxx.xxx&#x3D;xxx</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">server.port = 8181  //用于指定handler访问的端口号</span><br></pre></td></tr></table></figure>

<h5 id="3、yml文件的使用"><a href="#3、yml文件的使用" class="headerlink" title="3、yml文件的使用"></a>3、yml文件的使用</h5><p>3.1 yml简介 </p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">yml是YAML（YAML Ain't Markup Language）语言的文件，以数据为中心，比json、xml等更适合做配置文件。</span><br></pre></td></tr></table></figure>

<p>3.2 yml 语法</p>
<blockquote>
<ul>
<li>使用缩进表示层级关系</li>
<li>缩进时不允许使用Tab键，只允许使用空格</li>
<li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li>
<li>大小写敏感</li>
</ul>
</blockquote>
<p>3.3 YAML 支持的三种数据结构 </p>
<blockquote>
<ul>
<li><strong>对象： 键值对的集合</strong></li>
<li><strong>数值：一组按次序排列的值</strong></li>
<li><strong>字面量：单个的、不可再分的值</strong></li>
</ul>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">application</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">apple</span></span><br><span class="line">        <span class="attr">//微服务的名字</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">server</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">8181</span></span><br><span class="line">    <span class="meta">context-path</span>: <span class="string">/banana</span></span><br></pre></td></tr></table></figure>

<p>用于指定<strong>handler</strong>访问的路径 </p>
<h3 id="四、主启动类"><a href="#四、主启动类" class="headerlink" title="四、主启动类"></a>四、主启动类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.webcode.springBoot"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootHelloWorld</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		SpringApplication.run(SpringBootHelloWorld<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>application.properties </li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081   #指定访问的端口</span></span><br></pre></td></tr></table></figure>

<ul>
<li>application.yml </li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">application</span> :<span class="string"></span></span><br><span class="line">    <span class="attr">name</span> : <span class="string">applie</span></span><br></pre></td></tr></table></figure>



<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot入门</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot基础（二）helloworld</title>
    <url>/2020/03/05/SpringBoot%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89helloworld/</url>
    <content><![CDATA[<p><strong>操作步骤：</strong></p>
<h4 id="第一种创建SpringBoot的方案："><a href="#第一种创建SpringBoot的方案：" class="headerlink" title="第一种创建SpringBoot的方案："></a><strong>第一种创建SpringBoot的方案：</strong></h4><p><strong>1、</strong>创建Maven工程  </p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu01.png" alt=""></p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu02.png" alt=""></p>
<p><strong>2、</strong>加入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 继承SpringBoot官方指定的父工程 --&gt;</span>	</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 加入Web开发所需要的场景启动器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定groupId和artifactId即可，版本已在父工程中定义 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3、</strong>创建主动启动类</p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu03.png" alt=""></p>
<p><strong>4、</strong>创建HelloHandler </p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu04.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloHandler</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Hello SpringBoot!"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5、</strong>启动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">运行主启动类中的main方法启动SpringBoot程序。</span><br></pre></td></tr></table></figure>

<p><strong>6、</strong>通过网页访问handler方法 </p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu05.png" alt=""></p>
<p><strong>扩展：</strong> 关于包扫描的问题 </p>
<blockquote>
<p>SpringBoot中主启动类会自动扫描该类所在包的子包，相当于xml配置文件中的&lt;mvc:context scan=”包扫描路径”/&gt; </p>
</blockquote>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu06.png" alt=""></p>
<p><strong>注意：</strong> 要进行扫描的包必须处于主启动类的子包中。 </p>
<blockquote>
<ul>
<li><blockquote>
<p>手动扫描包</p>
<p>使用注解进行包</p>
</blockquote>
</li>
</ul>
</blockquote>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu07.png" alt=""></p>
<p><strong>访问结果：</strong> </p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu08.png" alt=""></p>
<h4 id="第二种创建SpringBoot的方案"><a href="#第二种创建SpringBoot的方案" class="headerlink" title="第二种创建SpringBoot的方案"></a>第二种创建SpringBoot的方案</h4><p><strong>1、</strong>通过 Spring 插件创建 SpringBoot工程</p>
<p>限制： 每次创建工程都必须联网：必须借助Spring 插件</p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu09.png" alt=""></p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu10.png" alt=""></p>
<blockquote>
<p><strong>效果</strong> ：自动生成主启动器和application.properties，以及测试类</p>
</blockquote>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/qiniu12.png" alt=""></p>
<p><a href="https://gitee.com/wushaopei/springboot-plus/tree/master/SpringBoot_helloworld" target="_blank" rel="noopener">码云</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot入门</category>
      </categories>
  </entry>
  <entry>
    <title>SpringBoot基础（一） SpringBoot概述与微服务理念</title>
    <url>/2020/03/05/SpringBoot%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%80%EF%BC%89-SpringBoot%E6%A6%82%E8%BF%B0%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%90%86%E5%BF%B5/</url>
    <content><![CDATA[<h4 id="1、前言：-分布式架构及微服务理念"><a href="#1、前言：-分布式架构及微服务理念" class="headerlink" title="1、前言： 分布式架构及微服务理念"></a>1、前言： 分布式架构及微服务理念</h4><h5 id="SOA理念-思想）"><a href="#SOA理念-思想）" class="headerlink" title="SOA理念(思想）"></a>SOA理念(思想）</h5><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">SOA :即 Service Oriented Architecture，面向服务架构</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>主张：</strong> </p>
<p>​    把项目中的各个模块从单一架构中拆分出来，封装成一个一个可以远程调用的服务，从而实现分布式架构。</p>
<pre><code>开发具体的每一个服务时，使用一个interface定义这个服务的功能，这就是我们常说的暴露接口。</code></pre><p>​     当我们实现了interface,将接口暴露到了网络上，可以进行远程调用了，就可以说这个服务开发完成了，这就是我们常说的“写接口”。</p>
<hr>
<p><strong>SOA精髓：</strong><code>通过提供服务和对服务的调用实现分布式架构。</code></p>
<hr>
<h5 id="micro-service-微服务理念"><a href="#micro-service-微服务理念" class="headerlink" title="micro service 微服务理念"></a>micro service 微服务理念</h5><img src="https://img-blog.csdnimg.cn/2019042117295770.png" width="80%" >

<img src="https://img-blog.csdnimg.cn/20190421173021813.png" width="80%" >



<img src="https://img-blog.csdnimg.cn/20190421173049381.png" width="80%" >

<blockquote>
<p>这是对微服务理念的一整套具体实现 </p>
</blockquote>
<blockquote>
<p>SpringBoot在微观上开发具体的一个一个微服务。 </p>
</blockquote>
<blockquote>
<p>SpringCloud在宏观上统一管理、协调各个微服务。为微服务提供各个服务的注册中心、网关、配置中心、负载均衡、熔断机制、服务降级、服务监控、服务细节屏蔽等等。 </p>
</blockquote>
<h4 id="2、SpringBoot概述"><a href="#2、SpringBoot概述" class="headerlink" title="2、SpringBoot概述"></a>2、SpringBoot概述</h4><p>​    Spring Boot是由Pivotal团队提供的全新框架，其设计目的是用来简化新Spring应用的初始搭建以及开发过程。该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。 </p>
<p>① <strong>SpringCloud 和 Dubbo 对比</strong> </p>
<blockquote>
<p> Dubbo:底层RPC 调用</p>
<p>SpringCloud : 底层REST调用（HTTP）</p>
<p>SpringCloud 能够为项目架构直接提供一整套解决方案。</p>
<p>Dubbo只能作为项目架构的核心和基石，完整的项目架构解决方案还需要借助其他技术。</p>
</blockquote>
<h4 id="3、SpringBoot工程的使用"><a href="#3、SpringBoot工程的使用" class="headerlink" title="3、SpringBoot工程的使用"></a>3、SpringBoot工程的使用</h4><ul>
<li>加入需要的场景 starter依赖</li>
<li>配置properties或yml</li>
<li>创建主启动类</li>
<li>通过注解开启相关功能</li>
<li>运行主启动类</li>
</ul>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>springboot入门</category>
      </categories>
  </entry>
  <entry>
    <title>Activity-（二）Activiti-插件安装-（两种方式）</title>
    <url>/2020/03/04/Activity-%EF%BC%88%E4%BA%8C%EF%BC%89Activiti-%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85-%EF%BC%88%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%89/</url>
    <content><![CDATA[<h3 id="1、安装Eclipse插件"><a href="#1、安装Eclipse插件" class="headerlink" title="1、安装Eclipse插件"></a>1、安装Eclipse插件</h3><p>1.1 点击eclipse上方工具栏的<strong>Help</strong>，选择<strong>Install New Software</strong></p>
   <img src="https://img-blog.csdnimg.cn/20200224214620411.png" width="60%" >

<p>1.2 弹出如下窗口，然后填写插件名称和安装地址</p>
<p>Name: <strong>Activiti BPMN 2.0 designer</strong></p>
<p>Location: <strong><a href="http://activiti.org/designer/update/" target="_blank" rel="noopener">http://activiti.org/designer/update/</a></strong></p>
<p>然后便是不停的next和finish了，组图如下：</p>
<img src="https://img-blog.csdnimg.cn/20200224214701568.png" width="60%">



<img src="https://img-blog.csdnimg.cn/20200224214715436.png" width="60%">



<img src="https://img-blog.csdnimg.cn/20200224214736205.png" width="60%">



<p>1.3 安装完成后，我们在new的时候，操作面板中便有activiti的相关文件了。</p>
<img src="https://img-blog.csdnimg.cn/20200224214759466.png" width="60%">



<h3 id="2、使用activiti-designer-5-18-0-zip"><a href="#2、使用activiti-designer-5-18-0-zip" class="headerlink" title="2、使用activiti-designer-5.18.0.zip"></a>2、使用activiti-designer-5.18.0.zip</h3><p>2.1 解压   activiti-designer-5.18.0.zip</p>
<p>2.2 把压缩包中的内容放入eclipse根目录的dropins文件夹下</p>
<p>2.3 重启eclipse，点击新建工程new-&gt;Other…打开面板，如果看到下图内容：</p>
<img src="https://img-blog.csdnimg.cn/20200224214849792.png" width="60%">

<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>Activity （一）工作流简介 ：概念与由来</title>
    <url>/2020/03/01/Activity-%EF%BC%88%E4%B8%80%EF%BC%89%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%AE%80%E4%BB%8B-%EF%BC%9A%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%94%B1%E6%9D%A5/</url>
    <content><![CDATA[<h3 id="1、工作流"><a href="#1、工作流" class="headerlink" title="1、工作流"></a>1、工作流</h3><p>简单的理解就是工作的流程，这里的流程指的是，完成一个企业中具体业务的一系列工作步骤，所有的步骤合在一起就是业务从开始到结束的流转过程。从计算机系统的角度来讲，工作流系统表示：业务过程的部分和整体在计算机应用环境的自动化操作。</p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/p01.png" alt=""></p>
<h2 id="2、工作流三要素"><a href="#2、工作流三要素" class="headerlink" title="2、工作流三要素"></a>2、工作流三要素</h2><p><img src="http://q6iswrm4f.bkt.clouddn.com/p02.png" alt=""></p>
<h2 id="3、工作流示例：请假"><a href="#3、工作流示例：请假" class="headerlink" title="3、工作流示例：请假"></a>3、工作流示例：请假</h2><p><img src="http://q6iswrm4f.bkt.clouddn.com/p03.png" alt=""></p>
<p><img src="http://q6iswrm4f.bkt.clouddn.com/p04.png" alt=""></p>
<h2 id="4、工作流系统的组成"><a href="#4、工作流系统的组成" class="headerlink" title="4、工作流系统的组成"></a>4、工作流系统的组成</h2><p><img src="http://q6iswrm4f.bkt.clouddn.com/p05.png" alt=""></p>
<h2 id="5、工作流的相关概念"><a href="#5、工作流的相关概念" class="headerlink" title="5、工作流的相关概念"></a>5、工作流的相关概念</h2><p><img src="http://q6iswrm4f.bkt.clouddn.com/p06.png" alt=""></p>
<h2 id="6、工作流产品"><a href="#6、工作流产品" class="headerlink" title="6、工作流产品"></a>6、工作流产品</h2><ul>
<li>JBPM</li>
<li>OSWorkFlow</li>
<li>Activiti5</li>
<li>Shark</li>
<li>信雅达</li>
<li>普元工作流</li>
</ul>
<p>##7、Activiti5工作流的由来 </p>
<p><strong>Activiti</strong>的前身是<strong>JBPM</strong>，全称<strong>Java Business Process Management（业务流程管理</strong>）。它是覆盖了<strong>业务流程管理、工作流、服务协作</strong>等领域的一个<strong>开源的、灵活的、易扩展</strong>的<strong>可执行流程</strong>语言框架。</p>
<p><strong>JBPM</strong>是公开源代码项目。<br/><strong>JBPM</strong>在2004年10月18日，发布了2.0版本，并在同一天加入了JBoss ,成为了JBoss企业中间件平台的一个组成部分，它的名称也改成<strong>JBoss jBPM</strong></p>
<p>在<strong>JBPM4</strong>之后，公司内部对于软件的规划发生了分歧，所以当时的项目架构师脱离了原来的公司，加入新的公司后，改了名称<strong>Activiti5</strong>。</p>
<p><strong>JBPM</strong>的持久化层框架是<strong>Hibernate</strong>，而<strong>Activiti</strong>采用了<strong>MyBatis</strong>。</p>
<h2 id="8、Activiti5框架包含的主要组件"><a href="#8、Activiti5框架包含的主要组件" class="headerlink" title="8、Activiti5框架包含的主要组件"></a>8、Activiti5框架包含的主要组件</h2><table>
<thead>
<tr>
<th>组件名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ProcessEngine</td>
<td>Activiti5的核心，所有的服务都需要通过ProcessEngine来创建，线程安全</td>
</tr>
<tr>
<td>repositoryService</td>
<td>持久化服务，与数据库进行交互</td>
</tr>
<tr>
<td>runtimeService</td>
<td>运行时服务，与运行流程有关</td>
</tr>
<tr>
<td>formService</td>
<td>表单服务</td>
</tr>
<tr>
<td>identityService</td>
<td>身份信息</td>
</tr>
<tr>
<td>taskService</td>
<td>任务服务，与流程中的每一个步骤有关</td>
</tr>
<tr>
<td>historyService</td>
<td>历史信息，查看历史的流程步骤</td>
</tr>
<tr>
<td>managementService</td>
<td>管理定时任务，在固定的时间点完成固定的任务</td>
</tr>
</tbody></table>
<h2 id="9、Activiti5-框架表结构"><a href="#9、Activiti5-框架表结构" class="headerlink" title="9、Activiti5 框架表结构"></a>9、Activiti5 框架表结构</h2><p>① 总体介绍 </p>
<table>
<thead>
<tr>
<th>表名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ACT_RE_*</td>
<td>‘RE’表示repository(存储)，RepositoryService接口所操作的表。带此前缀的表包含的是静态信息，如，流程定义，流程的资源（图片，规则等）。</td>
</tr>
<tr>
<td>ACT_RU_*</td>
<td>‘RU’表示runtime。RuntimeService接口所操作的表。存储着流程变量，用户任务，变量，职责（job）等运行时的数据。Activiti只存储实例执行期间的运行时数据，当流程实例结束时，将删除这些记录。这就保证了这些运行时的表小且快。</td>
</tr>
<tr>
<td>ACT_ID_*</td>
<td>‘ID’表示identity (组织机构)，IdentityService接口所操作的表。用户记录，流程中使用到的用户和组。这些表包含标识的信息，如用户，用户组，等等。</td>
</tr>
<tr>
<td>ACT_HI_*</td>
<td>‘HI’表示history，历史数据表，HistoryService。就是这些表包含着流程执行的历史相关数据，如结束的流程实例，变量，任务，等等</td>
</tr>
<tr>
<td>ACT_GE_*</td>
<td>全局通用数据及设置(general)，各种情况都使用的数据</td>
</tr>
</tbody></table>
<p>②详细介绍 </p>
<table>
<thead>
<tr>
<th>表名</th>
<th>标记</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>act_ge_bytearray</td>
<td></td>
<td>二进制数据表</td>
</tr>
<tr>
<td>act_ge_property</td>
<td></td>
<td>属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录，</td>
</tr>
<tr>
<td>act_hi_actinst</td>
<td>√</td>
<td>历史节点表</td>
</tr>
<tr>
<td>act_hi_attachment</td>
<td></td>
<td>历史附件表</td>
</tr>
<tr>
<td>act_hi_comment</td>
<td></td>
<td>历史意见表</td>
</tr>
<tr>
<td>act_hi_identitylink</td>
<td></td>
<td>历史流程人员表</td>
</tr>
<tr>
<td>act_hi_detail</td>
<td></td>
<td>历史详情表，提供历史变量的查询</td>
</tr>
<tr>
<td>act_hi_procinst</td>
<td>√</td>
<td>历史流程实例表</td>
</tr>
<tr>
<td>act_hi_taskinst</td>
<td>√</td>
<td>历史任务实例表</td>
</tr>
<tr>
<td>act_hi_varinst</td>
<td></td>
<td>历史变量表</td>
</tr>
<tr>
<td>act_id_group</td>
<td></td>
<td>用户组信息表</td>
</tr>
<tr>
<td>act_id_info</td>
<td></td>
<td>用户扩展信息表</td>
</tr>
<tr>
<td>act_id_membership</td>
<td></td>
<td>用户与用户组对应信息表</td>
</tr>
<tr>
<td>act_id_user</td>
<td></td>
<td>用户信息表</td>
</tr>
<tr>
<td>act_re_deployment</td>
<td>√</td>
<td>部署信息表</td>
</tr>
<tr>
<td>act_re_model</td>
<td></td>
<td>流程设计模型部署表</td>
</tr>
<tr>
<td>act_re_procdef</td>
<td>√</td>
<td>流程定义数据表</td>
</tr>
<tr>
<td>act_ru_event_subscr、throwEvent、catchEvent</td>
<td></td>
<td>时间监听信息表</td>
</tr>
<tr>
<td>act_ru_execution</td>
<td>√</td>
<td>运行时流程执行实例表</td>
</tr>
<tr>
<td>act_ru_identitylink</td>
<td>√</td>
<td>运行时流程人员表，主要存储任务节点与参与者的相关信息</td>
</tr>
<tr>
<td>act_ru_job</td>
<td></td>
<td>运行时定时任务数据表</td>
</tr>
<tr>
<td>act_ru_task</td>
<td>√</td>
<td>运行时任务节点表</td>
</tr>
<tr>
<td>act_ru_variable</td>
<td>√</td>
<td>运行时流程变量数据表</td>
</tr>
</tbody></table>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>workflower</category>
      </categories>
  </entry>
  <entry>
    <title>面试题： hashset如何保证值不会被重复的</title>
    <url>/2020/02/29/%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9Ahashset%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%80%BC%E4%B8%8D%E4%BC%9A%E8%A2%AB%E9%87%8D%E5%A4%8D%E7%9A%84/</url>
    <content><![CDATA[<p>众所周知，HashSet 的值是不可能被重复的，在业务上经常被用来做数据去重的操作，那么，其内部究竟是怎么保证元素不重复的呢？</p>
<p>这里将对<strong>HashSet</strong> 的源码进行逐步的解析：</p>
<p>当我们对一个<strong>HashSet</strong> 的实例添加一个值时，使用到的是它的 <strong>add</strong> 方法，源码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">218</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line"><span class="number">219</span>        <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line"><span class="number">220</span>    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>由以上的<strong>add</strong> 方法内的实现可知，其维护了一个 <strong>HashMap</strong> 来实现元素的添加；众所周知，<strong>HashMap</strong> 作为双列集合，它的键是不能够重复的，这里的 <strong>PRESENT</strong> 是作为占位符的存在，与值重复判断与否没有意义，不作赘述。</p>
<p>其实，到了这里，我们已经可以知道 <strong>HashSet</strong> 的值作为 <strong>HashMap</strong> 中的 <strong>key</strong>（键）的，可以确定是不会存在重复值存在的情况发生。</p>
<p>但是，我们要了解的是为什么不会重复，继续深究，这里继续了解对该值的一个不可重复的原因.</p>
<p>以下是<strong>HashSet</strong> 引用<strong>HashMap</strong>的具体位置。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5024744406713321676L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dummy value to associate with an Object in the backing Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has</span></span><br><span class="line"><span class="comment">     * default initial capacity (16) and load factor (0.75).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new set containing the elements in the specified</span></span><br><span class="line"><span class="comment">     * collection.  The &lt;tt&gt;HashMap&lt;/tt&gt; is created with default load factor</span></span><br><span class="line"><span class="comment">     * (0.75) and an initial capacity sufficient to contain the elements in</span></span><br><span class="line"><span class="comment">     * the specified collection.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> c the collection whose elements are to be placed into this set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified collection is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/.<span class="number">75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p><strong>HashSet</strong> 其实是在构造器内实例化了一个 <strong>HashMap</strong> 对象，那么可以得知，<strong>HashSet</strong> 的值不可重复是依赖于 <strong>HashMap</strong> 的底层对值不可重复的依赖。</p>
<p>其实</p>
<p>以下我们进入到 <strong>HashMap</strong> 的 <strong>put()</strong>方法中去：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment"> * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment"> * value is replaced.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment"> *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment"> *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>由 <strong>put</strong>  方法的实现可知，该 <strong>put</strong> 方法对传入的 <strong>Map</strong> 的<strong>key - value</strong> 进行了更深一层的 <strong>putVal</strong>（）的处理。</p>
<p>但这个方法不是我们现在需要了解的，稍后再对这里进行了解。</p>
<p>进入 putVal() 方法之前，对传入的 key 进行了hash 运算，获取了一个 hash 值：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取hash 值的规则是 ：当 key == null 时，hash 值为0；若不为null，则说明值有效，会通过 hashCode()</p>
<p><strong>关于 hashCode() 在这里的作用：</strong></p>
<p>hashCode在上面扮演的角色为寻域（寻找某个对象在集合中区域位置）。hashCode可以将集合分成若干个区域，每个对象都可以计算出他们的hash码，可以将hash码分组，每个分组对应着某个存储区域，根据一个对象的hash码就可以确定该对象所存储区域，这样就大大减少查询匹配元素的数量，提高了查询效率。</p>
<p>关于Key 不能够重复，这里可以得出了，相同的值得到的 hash 码大概率上是相同的，所以，key 可以保证不会重复，因为重复的值，一定会被覆盖。具体从后面的源码继续看：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">      Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">      <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">          n = (tab = resize()).length;</span><br><span class="line">      <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">          tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          Node&lt;K,V&gt; e; K k;</span><br><span class="line">          <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">              ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">              e = p;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">              e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                  <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                      p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                      <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                          treeifyBin(tab, hash);</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                      ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  p = e;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">              V oldValue = e.value;</span><br><span class="line">              <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                  e.value = value;</span><br><span class="line">              afterNodeAccess(e);</span><br><span class="line">              <span class="keyword">return</span> oldValue;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++modCount;</span><br><span class="line">      <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">          resize();</span><br><span class="line">      afterNodeInsertion(evict);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>注意 以上方法 中的这一句：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (e.hash == hash &amp; ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                     <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>由此可知，HashMap 的 集合元素 key-value 添加时，这里调用了对象的hashCode和equals方法进行的判断。</p>
<p>但要注意，原生的 hashCode 和 equals 更多的是在引用的位置上进行了去重校验，如要对具体的值或对象本身进行去重，还需进行重写操作。</p>
<p>所以又得出一个结论：<strong>若要将对象存放到HashSet中并保证对象不重复，应根据实际情况将对象的hashCode方法和equals方法进行重写</strong></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>集合容器</category>
      </categories>
      <tags>
        <tag>集合</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/02/29/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h4 id="关注橘长的微信公众号，获取有趣文章"><a href="#关注橘长的微信公众号，获取有趣文章" class="headerlink" title="关注橘长的微信公众号，获取有趣文章"></a>关注橘长的微信公众号，获取有趣文章</h4><p><img src="http://q6iswrm4f.bkt.clouddn.com/weixinbanner.jpg " alt="公共号"></p>]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
</search>
